(()=>{"use strict";var e={640:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objects=t.messages=void 0,t.messages=r(156),t.objects=r(447)},156:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Autoguard=t.RegisterResponse=t.RegisterRequest=t.ErrorMessage=void 0;const s=r(175);t.ErrorMessage=s.guards.Object.of({errors:s.guards.Array.of(s.guards.String)}),t.RegisterRequest=s.guards.Object.of({username:s.guards.String,password:s.guards.String,name:s.guards.String,key_id:s.guards.String}),t.RegisterResponse=s.guards.Object.of({token:s.guards.String}),t.Autoguard={ErrorMessage:t.ErrorMessage,RegisterRequest:t.RegisterRequest,RegisterResponse:t.RegisterResponse}},447:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Autoguard=t.Entity=t.EntityBase=t.Year=t.YearBase=t.Cue=t.CueBase=t.Subtitle=t.SubtitleBase=t.Episode=t.EpisodeBase=t.Season=t.SeasonBase=t.Show=t.ShowBase=t.Movie=t.MovieBase=t.Genre=t.GenreBase=t.PlaylistItem=t.PlaylistItemBase=t.Playlist=t.PlaylistBase=t.User=t.UserBase=t.Track=t.TrackBase=t.Disc=t.DiscBase=t.Album=t.AlbumBase=t.Artist=t.ArtistBase=t.Person=t.PersonBase=void 0;const s=r(302),n=r(302),a=r(302),i=r(302),o=r(175);t.PersonBase=o.guards.Object.of({person_id:o.guards.String,name:o.guards.String}),t.Person=o.guards.Intersection.of(o.guards.Reference.of((()=>t.PersonBase)),o.guards.Object.of({})),t.ArtistBase=o.guards.Object.of({artist_id:o.guards.String,title:o.guards.String}),t.Artist=o.guards.Intersection.of(o.guards.Reference.of((()=>t.ArtistBase)),o.guards.Object.of({albums:o.guards.Array.of(o.guards.Reference.of((()=>t.Album)))})),t.AlbumBase=o.guards.Object.of({album_id:o.guards.String,title:o.guards.String,artwork:o.guards.Array.of(o.guards.Reference.of((()=>n.ImageFile)))}),t.Album=o.guards.Intersection.of(o.guards.Reference.of((()=>t.AlbumBase)),o.guards.Object.of({artists:o.guards.Array.of(o.guards.Reference.of((()=>t.ArtistBase))),discs:o.guards.Array.of(o.guards.Reference.of((()=>t.Disc))),year:o.guards.Union.of(o.guards.Undefined,o.guards.Number)})),t.DiscBase=o.guards.Object.of({disc_id:o.guards.String,album:o.guards.Reference.of((()=>t.AlbumBase)),number:o.guards.Number}),t.Disc=o.guards.Intersection.of(o.guards.Reference.of((()=>t.DiscBase)),o.guards.Object.of({tracks:o.guards.Array.of(o.guards.Reference.of((()=>t.Track)))})),t.TrackBase=o.guards.Object.of({track_id:o.guards.String,title:o.guards.String,disc:o.guards.Reference.of((()=>t.DiscBase)),number:o.guards.Number}),t.Track=o.guards.Intersection.of(o.guards.Reference.of((()=>t.TrackBase)),o.guards.Object.of({artists:o.guards.Array.of(o.guards.Reference.of((()=>t.ArtistBase))),last_stream_date:o.guards.Union.of(o.guards.Undefined,o.guards.Number),media:o.guards.Reference.of((()=>s.AudioFile))})),t.UserBase=o.guards.Object.of({user_id:o.guards.String,name:o.guards.String,username:o.guards.String}),t.User=o.guards.Intersection.of(o.guards.Reference.of((()=>t.UserBase)),o.guards.Object.of({})),t.PlaylistBase=o.guards.Object.of({playlist_id:o.guards.String,title:o.guards.String,description:o.guards.String,user:o.guards.Reference.of((()=>t.UserBase))}),t.Playlist=o.guards.Intersection.of(o.guards.Reference.of((()=>t.PlaylistBase)),o.guards.Object.of({items:o.guards.Array.of(o.guards.Reference.of((()=>t.PlaylistItem)))})),t.PlaylistItemBase=o.guards.Object.of({playlist_item_id:o.guards.String,number:o.guards.Number,playlist:o.guards.Reference.of((()=>t.PlaylistBase)),track:o.guards.Reference.of((()=>t.Track))}),t.PlaylistItem=o.guards.Intersection.of(o.guards.Reference.of((()=>t.PlaylistItemBase)),o.guards.Object.of({})),t.GenreBase=o.guards.Object.of({genre_id:o.guards.String,title:o.guards.String}),t.Genre=o.guards.Intersection.of(o.guards.Reference.of((()=>t.GenreBase)),o.guards.Object.of({})),t.MovieBase=o.guards.Object.of({movie_id:o.guards.String,title:o.guards.String,artwork:o.guards.Array.of(o.guards.Reference.of((()=>n.ImageFile)))}),t.Movie=o.guards.Intersection.of(o.guards.Reference.of((()=>t.MovieBase)),o.guards.Object.of({year:o.guards.Union.of(o.guards.Undefined,o.guards.Number),summary:o.guards.Union.of(o.guards.Undefined,o.guards.String),genres:o.guards.Array.of(o.guards.Reference.of((()=>t.Genre))),actors:o.guards.Array.of(o.guards.Reference.of((()=>t.Person))),last_stream_date:o.guards.Union.of(o.guards.Undefined,o.guards.Number),media:o.guards.Reference.of((()=>i.VideoFile)),subtitles:o.guards.Array.of(o.guards.Reference.of((()=>a.SubtitleFile)))})),t.ShowBase=o.guards.Object.of({show_id:o.guards.String,title:o.guards.String,artwork:o.guards.Array.of(o.guards.Reference.of((()=>n.ImageFile)))}),t.Show=o.guards.Intersection.of(o.guards.Reference.of((()=>t.ShowBase)),o.guards.Object.of({summary:o.guards.Union.of(o.guards.Undefined,o.guards.String),genres:o.guards.Array.of(o.guards.Reference.of((()=>t.Genre))),actors:o.guards.Array.of(o.guards.Reference.of((()=>t.Person))),seasons:o.guards.Array.of(o.guards.Reference.of((()=>t.Season)))})),t.SeasonBase=o.guards.Object.of({season_id:o.guards.String,number:o.guards.Number,show:o.guards.Reference.of((()=>t.ShowBase))}),t.Season=o.guards.Intersection.of(o.guards.Reference.of((()=>t.SeasonBase)),o.guards.Object.of({episodes:o.guards.Array.of(o.guards.Reference.of((()=>t.Episode)))})),t.EpisodeBase=o.guards.Object.of({episode_id:o.guards.String,title:o.guards.String,number:o.guards.Number,season:o.guards.Reference.of((()=>t.SeasonBase))}),t.Episode=o.guards.Intersection.of(o.guards.Reference.of((()=>t.EpisodeBase)),o.guards.Object.of({year:o.guards.Union.of(o.guards.Undefined,o.guards.Number),summary:o.guards.Union.of(o.guards.Undefined,o.guards.String),last_stream_date:o.guards.Union.of(o.guards.Undefined,o.guards.Number),media:o.guards.Reference.of((()=>i.VideoFile)),subtitles:o.guards.Array.of(o.guards.Reference.of((()=>a.SubtitleFile)))})),t.SubtitleBase=o.guards.Object.of({subtitle_id:o.guards.String,subtitle:o.guards.Reference.of((()=>a.SubtitleFile))}),t.Subtitle=o.guards.Intersection.of(o.guards.Reference.of((()=>t.SubtitleBase)),o.guards.Object.of({cues:o.guards.Array.of(o.guards.Reference.of((()=>t.Cue)))})),t.CueBase=o.guards.Object.of({cue_id:o.guards.String,subtitle:o.guards.Reference.of((()=>t.SubtitleBase)),start_ms:o.guards.Number,duration_ms:o.guards.Number,lines:o.guards.Array.of(o.guards.String)}),t.Cue=o.guards.Intersection.of(o.guards.Reference.of((()=>t.CueBase)),o.guards.Object.of({media:o.guards.Union.of(o.guards.Reference.of((()=>t.Episode)),o.guards.Reference.of((()=>t.Movie)))})),t.YearBase=o.guards.Object.of({year_id:o.guards.String,year:o.guards.Number}),t.Year=o.guards.Intersection.of(o.guards.Reference.of((()=>t.YearBase)),o.guards.Object.of({})),t.EntityBase=o.guards.Union.of(o.guards.Reference.of((()=>t.AlbumBase)),o.guards.Reference.of((()=>t.ArtistBase)),o.guards.Reference.of((()=>t.CueBase)),o.guards.Reference.of((()=>t.DiscBase)),o.guards.Reference.of((()=>t.EpisodeBase)),o.guards.Reference.of((()=>t.GenreBase)),o.guards.Reference.of((()=>t.MovieBase)),o.guards.Reference.of((()=>t.PersonBase)),o.guards.Reference.of((()=>t.PlaylistBase)),o.guards.Reference.of((()=>t.SeasonBase)),o.guards.Reference.of((()=>t.ShowBase)),o.guards.Reference.of((()=>t.TrackBase)),o.guards.Reference.of((()=>t.UserBase)),o.guards.Reference.of((()=>t.YearBase))),t.Entity=o.guards.Union.of(o.guards.Reference.of((()=>t.Album)),o.guards.Reference.of((()=>t.Artist)),o.guards.Reference.of((()=>t.Cue)),o.guards.Reference.of((()=>t.Disc)),o.guards.Reference.of((()=>t.Episode)),o.guards.Reference.of((()=>t.Genre)),o.guards.Reference.of((()=>t.Movie)),o.guards.Reference.of((()=>t.Person)),o.guards.Reference.of((()=>t.Playlist)),o.guards.Reference.of((()=>t.Season)),o.guards.Reference.of((()=>t.Show)),o.guards.Reference.of((()=>t.Track)),o.guards.Reference.of((()=>t.User)),o.guards.Reference.of((()=>t.Year))),t.Autoguard={PersonBase:t.PersonBase,Person:t.Person,ArtistBase:t.ArtistBase,Artist:t.Artist,AlbumBase:t.AlbumBase,Album:t.Album,DiscBase:t.DiscBase,Disc:t.Disc,TrackBase:t.TrackBase,Track:t.Track,UserBase:t.UserBase,User:t.User,PlaylistBase:t.PlaylistBase,Playlist:t.Playlist,PlaylistItemBase:t.PlaylistItemBase,PlaylistItem:t.PlaylistItem,GenreBase:t.GenreBase,Genre:t.Genre,MovieBase:t.MovieBase,Movie:t.Movie,ShowBase:t.ShowBase,Show:t.Show,SeasonBase:t.SeasonBase,Season:t.Season,EpisodeBase:t.EpisodeBase,Episode:t.Episode,SubtitleBase:t.SubtitleBase,Subtitle:t.Subtitle,CueBase:t.CueBase,Cue:t.Cue,YearBase:t.YearBase,Year:t.Year,EntityBase:t.EntityBase,Entity:t.Entity}},183:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setHandlers=t.setMetadata=void 0,t.setMetadata=function(e){navigator.mediaSession&&(navigator.mediaSession.metadata=new globalThis.MediaMetadata(e))},t.setHandlers=function(e){if(navigator.mediaSession)for(let t in e)navigator.mediaSession.setActionHandler(t,e[t])}},224:function(e,t,r){var s,n=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{d(s.next(e))}catch(e){a(e)}}function o(e){try{d(s.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=r(618),i=r(183),o=r(440),d=r(676),l=r(565),u=r(447),c=r(78),p=r(640),h=r(36),f=r(403),g=r(410),m=r(972),y=r(994),b=r(786),v=r(458),x=r(387),S=r(587),k=r(748),w=r(756);function _(e){let t="/sockets/"+e;return`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}${t}`}let C=new d.ContextClient(_("context/?type=browser&name=Orbit")),O=new w.PlaylistsClient(_("playlists/"));window.addEventListener("focus",(()=>{C.isOnline.getState()||C.reconnect(),O.isOnline()||O.reconnect(),J("/discover",{},(()=>{}))})),window.addEventListener("keydown",(e=>{if("Space"===e.code){if(e.target instanceof HTMLInputElement)return;e.preventDefault(),e.stopPropagation(),C.toggle()}else"Escape"===e.code&&(e.preventDefault(),e.stopPropagation(),Z.updateState(!1),M.updateState(!1))}));let P=document.createElement("video"),T=document.createElement("video"),E=document.createElement("video");T.addEventListener("ended",(()=>{C.next()}));let A=new o.ObservableClass(!0);T.addEventListener("loadeddata",(()=>{A.updateState(!1)})),T.addEventListener("playing",(()=>{C.isCurrentEntryVideo.updateState(T.videoWidth>0&&T.videoHeight>0)}));{let e=()=>n(void 0,void 0,void 0,(function*(){var e;A.getState()||(T.currentTime=null!==(e=C.progress.getState())&&void 0!==e?e:0)}));C.progress.addObserver(e),A.addObserver(e)}{let e=()=>n(void 0,void 0,void 0,(function*(){if(!A.getState())if(C.playback.getState())try{yield T.play()}catch(e){}else T.pause()}));C.playback.addObserver(e),A.addObserver(e)}{let e=()=>{let e=C.canPlayLast.getState(),t=C.canPlayCurrent.getState(),r=C.canPlayNext.getState();i.setHandlers({play:t?C.resume.bind(C):void 0,pause:t?C.pause.bind(C):void 0,previoustrack:e?C.last.bind(C):void 0,nexttrack:r?C.next.bind(C):void 0})};C.canPlayLast.addObserver(e),C.canPlayCurrent.addObserver(e),C.canPlayNext.addObserver(e)}let j=new o.ObservableClass(""),I=new o.ObservableClass("");C.currentEntry.addObserver((e=>{if(l.present(e))if(u.Episode.is(e)){let t=e,r=t.season.show;j.updateState(t.title),I.updateState(r.title),i.setMetadata({title:t.title})}else if(u.Movie.is(e)){let t=e;j.updateState(t.title),I.updateState(""),i.setMetadata({title:t.title,artwork:t.artwork.map((e=>({src:`/files/${e.file_id}/?token=${re}`,sizes:`${e.width}x${e.height}`,type:e.mime})))})}else{if(!u.Track.is(e))throw"Expected code to be unreachable!";{let t=e,r=t.disc.album;j.updateState(t.title),I.updateState(t.artists.map((e=>e.title)).join(" · ")),i.setMetadata({title:t.title,artist:t.artists.map((e=>e.title)).join(" · "),album:r.title,artwork:r.artwork.map((e=>({src:`/files/${e.file_id}/?token=${re}`,sizes:`${e.width}x${e.height}`,type:e.mime})))})}}else j.updateState(""),I.updateState(""),i.setMetadata({})}));{let e=()=>{let e=C.lastLocalEntry.getState(),t=C.token.getState();l.absent(e)||l.absent(t)?P.src="":P.src=`/files/${e.media.file_id}/?token=${t}`};C.lastLocalEntry.addObserver(e),C.token.addObserver(e)}{let e=()=>{var e,t;A.updateState(!0);let r=C.currentLocalEntry.getState(),s=C.token.getState();if(l.absent(r)||l.absent(s))T.src="";else{for(T.src=`/files/${r.media.file_id}/?token=${s}`,T.load();null!=T.lastChild;)T.removeChild(T.lastChild);if(u.Movie.is(r)||u.Episode.is(r)){let n=r.subtitles,i=null!==(t=null!==(e=n.find((e=>"swe"===e.language)))&&void 0!==e?e:n.find((e=>"eng"===e.language)))&&void 0!==t?t:n.find((e=>!0));for(let e of n){let t=document.createElement("track");if(t.src=`/files/${e.file_id}/?token=${s}`,l.present(e.language)){let r=a.db[e.language];l.present(r)&&(t.label=r.title,t.srclang=r.iso639_1,t.kind="subtitles")}e===i&&t.setAttribute("default",""),T.appendChild(t)}}}};C.currentLocalEntry.addObserver(e),C.token.addObserver(e)}{let e=()=>{let e=C.nextLocalEntry.getState(),t=C.token.getState();l.absent(e)||l.absent(t)?P.src="":P.src=`/files/${e.media.file_id}/?token=${t}`};C.nextLocalEntry.addObserver(e),C.token.addObserver(e)}const R=new o.ObservableClass(null!==(s=localStorage.getItem("token"))&&void 0!==s?s:void 0),B=new o.ObservableClass(void 0),M=new o.ObservableClass(!1),L=new o.ArrayObservable(new Array);B.addObserver((e=>{if(p.objects.Track.is(e)){let t=new o.ObservableClass(""),r=o.computed((e=>""!==e),t),s=()=>n(void 0,void 0,void 0,(function*(){if(r.getState()){let r=yield O.createPlaylist({playlist:{title:t.getState(),description:""}});if(r.errors.length>0)return;if((yield O.createPlaylistItem({playlist_item:{playlist_id:r.playlist_id,track_id:e.track_id}})).errors.length>0)return;M.updateState(!1)}}));L.update([c.element("div").set("style","align-items: center; display: grid; gap: 16px; grid-template-columns: 1fr min-content;").add(Ee(c.text("Add to playlist"))).add(W().on("click",(()=>{M.updateState(!1)})).add(D.makeCross())),V.forTrack(e),c.element("div").set("style","display: grid; gap: 16px;").add(c.element("div").set("style","position: relative;").add(c.element("input").bind2("value",t).set("type","text").set("spellcheck","false").set("placeholder","Playlist title").on("keyup",(e=>n(void 0,void 0,void 0,(function*(){"Enter"===e.code&&(yield s())}))))).add(D.makeStar().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);"))).add(c.element("button").bind2("data-enabled",o.computed((e=>""+e),r)).add(c.text("New playlist")).on("click",(()=>n(void 0,void 0,void 0,(function*(){yield s()}))))),c.element("div").set("style","display: grid; gap: 16px;").bind("data-hide",O.playlists.compute((e=>0===e.length))).repeat(O.playlists,(t=>c.element("div").set("style","align-items: center; cursor: pointer; display: grid; fill: rgb(255, 255, 255); gap: 16px; grid-template-columns: min-content 1fr;").on("click",(()=>n(void 0,void 0,void 0,(function*(){(yield O.createPlaylistItem({playlist_item:{playlist_id:t.getState().playlist_id,track_id:e.track_id}})).errors.length>0||M.updateState(!1)})))).add(D.makeChevron()).add(Ee(c.text(t.getState().title)))))]),M.updateState(!0)}else M.updateState(!1)}));const F=new f.GridFactory;document.head.appendChild(f.GridFactory.makeStyle().render());const D=new m.IconFactory;document.head.appendChild(m.IconFactory.makeStyle().render());const N=new g.CarouselFactory(D);document.head.appendChild(g.CarouselFactory.makeStyle().render());const $=new S.PlaybackButtonFactory(C,D);document.head.appendChild(S.PlaybackButtonFactory.makeStyle().render());const U=new y.ImageBoxFactory(R);document.head.appendChild(y.ImageBoxFactory.makeStyle().render());const z=new b.EntityLinkFactory(Be,B);document.head.appendChild(b.EntityLinkFactory.makeStyle().render());const G=new h.EntityTitleFactory(z);document.head.appendChild(h.EntityTitleFactory.makeStyle().render());const q=new v.EntityCardFactory(G,z,U,$);document.head.appendChild(v.EntityCardFactory.makeStyle().render());const V=new x.EntityRowFactory(G,z,U,$);document.head.appendChild(x.EntityRowFactory.makeStyle().render());const K=new k.EntityNavLinkFactory(D,z);document.head.appendChild(k.EntityNavLinkFactory.makeStyle().render());const H="rgb(223, 79, 127)";let Y=document.createElement("style");function X(e,t,r){return c.element("div.icon-link").add(c.element("div.icon-link__content").add(e.set("class","icon-link__icon").set("width","24px").set("height","24px")).add(c.element("div.icon-link__title").add(c.text(t)))).on("click",(()=>Be(r)))}Y.innerText=`\n\t::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\theight: 8px;\n\t\twidth: 8px;\n\t}\n\n\t::-webkit-scrollbar-corner {\n\t\tbackground-color: transparent;\n\t}\n\n\t::-webkit-scrollbar-thumb {\n\t\tbackground-color: rgba(255, 255, 255, 0.125);\n\t\tborder-radius: 4px;\n\t}\n\n\t* {\n\t\tborder: none;\n\t\tfont-size: 0px;\n\t\tmargin: 0px;\n\t\tline-height: 1;\n\t\toutline: none;\n\t\tpadding: 0px;\n\t}\n\n\ta,\n\tspan {\n\t\tcolor: inherit;\n\t\tfont-size: inherit;\n\t}\n\n\ta {\n\t\ttext-decoration: none;\n\t\ttransition: color 0.125s;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\ta:hover {\n\t\t\tcolor: rgb(255, 255, 255);\n\t\t}\n\t}\n\n\thtml {\n\t\theight: 100%;\n\t}\n\n\tbody {\n\t\theight: 100%;\n\t}\n\n\t.page-header {\n\t\tbackground-color: ${H};\n\t}\n\n\t.page-header__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tcursor: pointer;\n\t\tfont-family: "Pacifico", cursive;\n\t\tfont-size: 32px;\n\t\ttransform-origin: left;\n\t\ttransition: transform 0.125s;\n\t\twhite-space: nowrap;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\t.page-header__title:hover {\n\t\t\ttransform: scale(1.25);\n\t\t}\n\t}\n\n\t[data-hide="true"] {\n\t\tdisplay: none !important;\n\t}\n\n\tbody {\n\t\tbackground-color: ${H};\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-family: "Nunito", sans-serif;\n\t\toverflow: hidden;\n\t\ttouch-callout: none;\n\t\t\t-webkit-touch-callout: none;\n\t\t\t-moz-touch-callout: none;\n\t\t\t-ms-touch-callout: none;\n\t\t\t-o-touch-callout: none;\n\t\tuser-select: none;\n\t\t\t-webkit-user-select: none;\n\t\t\t-moz-user-select: none;\n\t\t\t-ms-user-select: none;\n\t\t\t-o-user-select: none;\n\t}\n\n\tbody ::selection {\n\t\tbackground-color: ${H};\n\t\tcolor: rgb(255, 255, 255);\n\t}\n\n\tbutton {\n\t\tbackground-color: ${H};\n\t\tborder-radius: 64px;\n\t\tcolor: rgb(255, 255, 255);\n\t\tcursor: pointer;\n\t\tfont-size: 16px;\n\t\tpadding: 8px 16px;\n\t\ttransition: background-color 0.125s, color 0.125s;\n\t}\n\n\tbutton[data-enabled="false"] {\n\t\tbackground-color: rgb(79, 79, 79);\n\t\tcolor: rgb(159, 159, 159);\n\t\tcursor: default;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\tbutton:not([data-enabled="false"]):hover {\n\t\t\tbackground-color: rgb(255, 255, 255);\n\t\t\tcolor: rgb(31, 31, 31);\n\t\t}\n\n\t\tbutton:active {\n\t\t\ttransform: none;\n\t\t}\n\t}\n\n\tinput {\n\t\tbackground-color: rgb(47, 47, 47);\n\t\tborder-radius: 64px;\n\t\tbox-sizing: border-box;\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t\tpadding: 8px 16px 8px 32px;\n\t\twidth: 100%;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t.slider-widget {\n\t\tpadding: 4px;\n\t}\n\n\t.slider-widget__indicator {\n\t\tpadding: 4px;\n\t\tborder-radius: 4px;\n\t\tbackground-color: rgb(31, 31, 31);\n\t}\n\n\t.slider-widget__knob-wrapper {\n\t\tposition: relative;\n\t}\n\n\t.slider-widget__knob {\n\t\tbox-shadow: 0px 0px 8px 0px rgba(0, 0, 0, 0.5);\n\t\twidth: 16px;\n\t\theight: 16px;\n\t\tborder-radius: 50%;\n\t\tbackground-color: rgb(255, 255, 255);\n\t\tposition: absolute;\n\t\ttop: 0%;\n\t\tleft: 0%;\n\t\tmargin-top: -8px;\n\t\tmargin-left: -8px;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t.content {\n\t\tbox-sizing: border-box;\n\t\tdisplay: grid;\n\t\tgap: 24px;\n\t\tmargin: 0px auto;\n\t\tmax-width: 960px;\n\t\tpadding: 24px;\n\t}\n\n\t.content--narrow {\n\t\tmax-width: 480px;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\t.text-header {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 20px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.text-paragraph {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 16px;\n\t\tline-height: 1.25;\n\t\tword-break: break-word;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t.login-modal {\n\t\tdisplay: grid;\n\t\tgap: 64px;\n\t}\n\n\t.login-modal__form {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t}\n\n\n\n\n\n\n\n\n\t.modal-container {\n\t\tbackground-color: rgb(31, 31, 31);\n\t\theight: 100%;\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\tz-index: 1;\n\t}\n\n\n\n\n\n\n\n\n\n\n\t.device-selector {\n\t\tdisplay: grid;\n\t\tgap: 64px;\n\t}\n\n\t.device-selector__devices {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t}\n\n\t.device-selector__device {\n\t\talign-items: center;\n\t\tcursor: pointer;\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-template-columns: min-content 1fr;\n\t}\n\n\t.device-selector__device-info {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\t.device-selector__device-name {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.device-selector__device-type {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t.media-player {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t}\n\n\t.media-player__top {\n\t\talign-items: center;\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-template-columns: 1fr min-content;\n\t}\n\n\t.media-player__metadata {\n\t\tcursor: pointer;\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\t.media-player__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t\theight: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.media-player__subtitle {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 16px;\n\t\theight: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.media-player__controls {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-columns: minmax(auto, min-content);\n\t\tgrid-auto-flow: column;\n\t}\n\n\t.media-player__bottom {\n\n\t}\n\n\t.media-player__progress {\n\t\tcursor: pointer;\n\t\tpadding: 8px 0px;\n\t}\n\n\t.media-player__progress-container {\n\t\tbackground-color: rgb(31, 31, 31);\n\t\tborder-radius: 4px;\n\t\theight: 8px;\n\t\toverflow: hidden;\n\t\tposition: relative;\n\t\tz-index: 1;\n\t}\n\n\t@keyframes progress {\n\t\t0% {\n\t\t\ttransform: translate(-100%, 0%);\n\t\t}\n\t\t100% {\n\t\t\ttransform: translate(0%, 0%);\n\t\t}\n\t}\n\n\t.media-player__progress-track {\n\t\tanimation-delay: 0s;\n\t\tanimation-duration: 0s;\n\t\tanimation-name: progress;\n\t\tanimation-play-state: paused;\n\t\tanimation-timing-function: linear;\n\t\tbackground-color: ${H};\n\t\theight: 100%;\n\t\twidth: 100%;\n\t\ttransform: translate(-100%, 0%);\n\t\tposition: absolute;\n\t\tz-index: 0;\n\t}\n\n\n\n\n\n\n\t.icon-button {\n\t\tbackground-color: rgb(255, 255, 255);\n\t\tborder-radius: 50%;\n\t\tbox-shadow: 0px 0px 8px 4px rgba(0, 0, 0, 0.25);\n\t\tcursor: pointer;\n\t\tfill: rgb(31, 31, 31);\n\t\tmax-width: fit-content;\n\t\tpadding: 8px;\n\t\ttransition: background-color 0.125s, transform 0.125s;\n\t}\n\n\t.icon-button[data-enabled="false"] {\n\t\tbackground-color: rgb(79, 79, 79);\n\t\tcursor: default;\n\t}\n\n\t.icon-button[data-active="true"] {\n\t\tbackground-color: ${H};\n\t\tfill: rgb(255, 255, 255);\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\t.icon-button:not([data-enabled="false"]):hover {\n\t\t\ttransform: scale(1.25);\n\t\t}\n\n\t\t.icon-button:active {\n\t\t\ttransform: none;\n\t\t}\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\t.app {\n\t\tdisplay: grid;\n\t\theight: 100%;\n\t\tposition: relative;\n\t}\n\n\t.app__header {\n\t\tbackground-color: ${H};\n\t\tbox-shadow: 0px 0px 8px 4px rgba(0, 0, 0, 0.25);\n\t\tposition: absolute;\n\t\t\ttop: 0px;\n\t\t\tleft: 0px;\n\t\t\tright: 0px;\n\t\ttransition: transform 0.25s;\n\t\tz-index: 1;\n\t}\n\n\t.app__header[data-hide=true] {\n\t\tdisplay: initial!important;\n\t\ttransform: translate(0%, -100%);\n\t}\n\n\t.app__content {\n\t\tbackground-color: rgb(31, 31, 31);\n\t\toverflow: hidden;\n\t\tpadding: 64px 0px 112px 0px;\n\t\tposition: relative;\n\t\tz-index: 0;\n\t}\n\n\t.app__navigation {\n\t\tbackground-color: rgb(47, 47, 47);\n\t\tbox-shadow: 0px 0px 8px 4px rgba(0, 0, 0, 0.25);\n\t\tposition: absolute;\n\t\t\tbottom: 0px;\n\t\t\tleft: 0px;\n\t\t\tright: 0px;\n\t\ttransition: transform 0.25s;\n\t\tz-index: 1;\n\t}\n\n\t.app__navigation[data-hide=true] {\n\t\tdisplay: initial!important;\n\t\ttransform: translate(0%, 100%);\n\t}\n\n\t.app__message-bar {\n\t\tbackground-color: ${H};\n\t}\n\n\t.app__video {\n\t\tbackground-color: rgb(0, 0, 0);\n\t\theight: 100%;\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t}\n\n\t.offline-indicator {\n\t\tmargin: 0px auto;\n\t\tmax-width: 960px;\n\t\tpadding: 8px;\n\t}\n\n\t.offline-indicator__content {\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\n\n\n\n\t.scroll-container {\n\t\theight: 100%;\n\t\toverflow-y: scroll;\n\t\toverflow-x: auto;\n\t\twidth: 100%;\n\t}\n\n\n\n\n\n\n\n\n\t.access-token {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\t.access-token__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-family: "Space Mono", monospace;\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.access-token__subtitle {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 12px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\n\n\n\n\n\n\t.icon-link {\n\t\tbackground-color: rgb(47, 47, 47);\n\t\tborder-radius: 2px;\n\t\tcursor: pointer;\n\t\tpadding-bottom: 100%;\n\t\tposition: relative;\n\t}\n\n\t.icon-link__content {\n\t\theight: 100%;\n\t\tposition: absolute;\n\t\t\ttop: 0%;\n\t\t\tleft: 0%;\n\t\twidth: 100%;\n\t\tdisplay: grid;\n\t\tgap: 12px;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tjustify-items: center;\n\t\talign-content: center;\n\t}\n\n\t.icon-link__icon {\n\t\tfill: rgb(255, 255, 255);\n\t\ttransition: fill 0.125s;\n\t}\n\n\t.icon-link__title {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\ttransition: color 0.125s;\n\t\twhite-space: nowrap;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\t.icon-link:hover .icon-link__title {\n\t\t\tcolor: rgb(255, 255, 255)\n\t\t}\n\t}\n`,document.head.appendChild(Y);const W=()=>c.element("div.icon-button");let J=(e,t,r)=>{let s=new XMLHttpRequest;s.addEventListener("readystatechange",(()=>{s.readyState===XMLHttpRequest.DONE&&r(s.status,JSON.parse(s.responseText))})),s.open("POST",e,!0),s.send(JSON.stringify(t))};function Q(e,t){return new Promise(((r,s)=>{J(e,t,((e,t)=>e>=200&&e<300?r(t):s()))}))}const Z=new o.ObservableClass(!1);C.devices.addObserver({onappend:()=>{C.devices.getState().length<2&&Z.updateState(!1)},onsplice:()=>{C.devices.getState().length<2&&Z.updateState(!1)}});const ee=new o.ObservableClass(!1);{let e=()=>{let e=C.isDeviceLocal.getState(),t=C.isCurrentEntryVideo.getState(),r=C.localPlayback.getState();ee.updateState(e&&t&&r)};C.isDeviceLocal.addObserver(e),C.isCurrentEntryVideo.addObserver(e),C.localPlayback.addObserver(e)}const te=o.computed(((e,t,r)=>l.absent(e)?"login":t?"context":r?"devices":void 0),R,M,Z);let re;function se(e,t){return n(this,void 0,void 0,(function*(){return new Promise(((r,s)=>{J("/api/auth/",{username:e,password:t},((e,t)=>{R.updateState(t.token),r(re)}))}))}))}R.addObserver((e=>{l.present(e)?localStorage.setItem("token",e):localStorage.removeItem("token"),re=e,C.authenticate(re),O.authenticate(re)})),function(){return n(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{J("/api/auth/?token="+re,{},((t,r)=>{R.updateState(r.token),e(re)}))}))}))}().catch((()=>{}));let ne=document.createElement("div"),ae=new o.ObservableClass(!0),ie=c.element("div.app").render();document.body.appendChild(ie);let oe=c.element("div.app__header").bind("data-hide",ae.addObserver((e=>!e))).add(c.element("div.content").set("style","padding: 16px").add(c.element("div.page-header__title").add(c.text("Orbit")).on("click",(()=>{Be("/")})))).render();ie.appendChild(oe),ne.setAttribute("class","app__content"),ie.appendChild(ne);let de=new o.ArrayObservable([]);{let e=()=>{let e=C.devices.getState(),t=C.device.getState(),r=C.localDevice.getState();de.update(e.map((e=>Object.assign(Object.assign({},e),{active:(null==t?void 0:t.id)===e.id,local:(null==r?void 0:r.id)===e.id}))))};C.devices.addObserver({onappend:e,onsplice:e}),C.device.addObserver(e),C.localDevice.addObserver(e)}let le=new o.ObservableClass(""),ue=new o.ObservableClass(""),ce=o.computed(((e,t)=>""!==e&&""!==t),le,ue),pe=new o.ObservableClass(""),he=new o.ObservableClass(""),fe=new o.ObservableClass(""),ge=new o.ArrayObservable(new Array),me=o.computed(((e,t,r,s,n)=>""!==e&&""!==t&&""!==r&&""!==s&&""!==n&&t===r),le,ue,pe,he,fe);function ye(){return n(this,void 0,void 0,(function*(){if(ce.getState()){ge.update([]);let e=yield se(le.getState(),ue.getState());l.present(e)?ge.update([]):ge.update(["The login was unsuccessful! Please check your credentials and try again."])}}))}function be(){return n(this,void 0,void 0,(function*(){me.getState()&&(ge.update([]),J("/api/register/",{username:le.getState(),password:ue.getState(),name:he.getState(),key_id:fe.getState()},((e,t)=>{p.messages.ErrorMessage.is(t)?ge.update(t.errors):(ge.update([]),R.updateState(t.token))})))}))}let ve=c.element("div.modal-container").bind("data-hide",te.addObserver(l.absent)).add(c.element("div.scroll-container").bind("data-hide",te.addObserver((e=>"devices"!==e))).add(c.element("div.content.content--narrow").add(c.element("div.device-selector").add(c.element("div").set("style","align-items: center; display: grid; gap: 16px; grid-template-columns: 1fr min-content;").add(Ee(c.text("Select playback device"))).add(W().on("click",(()=>{Z.updateState(!1)})).add(D.makeCross()))).add(c.element("div.device-selector__devices").repeat(de,(e=>c.element("div.device-selector__device").add(W().set("data-active",""+e.active).add(D.makeBroadcast())).add(c.element("div.device-selector__device-info").add(c.element("div.device-selector__device-name").add(c.text(e.name))).add(c.element("div.device-selector__device-type").add(c.text(e.local?"Local device":"Remote device")))).on("click",(()=>{C.transfer({id:e.id,protocol:e.protocol,name:e.name,type:e.type}),Z.updateState(!1)})))))))).add(c.element("div.scroll-container").bind("data-hide",te.addObserver((e=>"login"!==e))).add(c.element("div.content.content--narrow").add(c.element("div.login-modal").add(c.element("div").set("style","display: grid; gap: 16px;").add(c.element("div").set("style","position: relative;").add(c.element("input.login-modal__username").bind2("value",le).set("type","text").set("spellcheck","false").set("placeholder","Username")).add(D.makePerson().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);"))).add(c.element("div").set("style","position: relative;").add(c.element("input.login-modal__password").bind2("value",ue).set("type","password").set("spellcheck","false").set("placeholder","Password").on("keyup",(e=>n(void 0,void 0,void 0,(function*(){"Enter"===e.code&&(yield ye())}))))).add(D.makeLock().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);"))).add(c.element("div").set("style","position: relative;").add(c.element("input.login-modal__password").bind2("value",pe).set("type","password").set("spellcheck","false").set("placeholder","Repeat password")).add(D.makeLock().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);"))).add(c.element("div").set("style","position: relative;").add(c.element("input.login-modal__name").bind2("value",he).set("type","text").set("spellcheck","false").set("placeholder","Display name")).add(D.makePerson().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);"))).add(c.element("div").set("style","position: relative;").add(c.element("input.login-modal__key").bind2("value",fe).set("type","text").set("spellcheck","false").set("placeholder","Registration key").on("keyup",(e=>n(void 0,void 0,void 0,(function*(){"Enter"===e.code&&(yield be())}))))).add(D.makeLock().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);")))).add(c.element("div").set("style","display: grid; gap: 16px;").bind("data-hide",ge.compute((e=>0===e.length))).repeat(ge,(e=>{return t=c.text(e),c.element("div.text-paragraph").add(t);var t}))).add(c.element("div").set("style","display: grid; gap: 16px;").add(c.element("button").bind2("data-enabled",o.computed((e=>""+e),me)).add(c.text("Register")).on("click",(()=>n(void 0,void 0,void 0,(function*(){yield be()}))))).add(c.element("button").bind2("data-enabled",o.computed((e=>""+e),ce)).add(c.text("Login")).on("click",(()=>n(void 0,void 0,void 0,(function*(){yield ye()}))))))))).add(c.element("div.scroll-container").bind("data-hide",te.addObserver((e=>"context"!==e))).add(c.element("div.content.content--narrow").repeat(L,(e=>e))));ne.appendChild(ve.render());let xe=c.element("div.scroll-container").bind("data-hide",ee.addObserver((e=>e))).render();ne.appendChild(xe);let Se=c.element("div.app__navigation").bind("data-hide",ae.addObserver((e=>!e))).add(c.element("div.app__message-bar").bind("data-hide",C.isOnline.addObserver((e=>e))).add(c.element("div.offline-indicator").add(c.element("div.offline-indicator__content").add(c.text("The application is currently offline."))))).render(),ke=c.element("div.media-player__progress"),we=c.element("div.media-player__progress-container"),_e=c.element("div.media-player__progress-track");function Ce(e){return n(this,void 0,void 0,(function*(){let t=yield we.ref(),r=e-t.offsetLeft,s=t.offsetWidth,n=Math.max(0,Math.min(r/s,1)),a=C.currentEntry.getState();if(l.present(a)){let e=n*a.media.duration_ms/1e3;C.seek(e)}}))}C.progress.addObserver((e=>n(void 0,void 0,void 0,(function*(){let t=yield _e.ref();t.style.setProperty("animation-name","none"),window.requestAnimationFrame((()=>{window.requestAnimationFrame((()=>{t.style.setProperty("animation-delay",`-${null!=e?e:0}s`),t.style.setProperty("animation-name","progress")}))}))})))),C.playback.addObserver((e=>n(void 0,void 0,void 0,(function*(){let t=yield _e.ref(),r=e?"running":"paused";t.style.setProperty("animation-play-state",r)})))),C.currentEntry.addObserver((e=>n(void 0,void 0,void 0,(function*(){var t;let r=yield _e.ref(),s=null!==(t=null==e?void 0:e.media.duration_ms)&&void 0!==t?t:1;r.style.setProperty("animation-name","none"),window.requestAnimationFrame((()=>{window.requestAnimationFrame((()=>{r.style.setProperty("animation-duration",s+"ms"),r.style.setProperty("animation-name","progress")}))}))}))));let Oe=!1;document.body.addEventListener("pointermove",(e=>n(void 0,void 0,void 0,(function*(){Oe&&(yield Ce(e.pageX))})))),document.body.addEventListener("pointerup",(e=>n(void 0,void 0,void 0,(function*(){Oe=!1})))),document.body.addEventListener("pointerleave",(e=>n(void 0,void 0,void 0,(function*(){Oe=!1})))),ke.on("pointerdown",(e=>n(void 0,void 0,void 0,(function*(){Oe=!0,yield Ce(e.pageX)})))).add(we.add(_e));let Pe=c.element("div.content").set("style","padding: 16px;").add(c.element("div.media-player").add(c.element("div.media-player__top").add(c.element("div.media-player__metadata").add(c.element("div.media-player__title").add(c.text(j))).add(c.element("div.media-player__subtitle").add(c.text(I))).on("click",(()=>{let e=C.context.getState();if(l.present(e))if(u.Album.is(e))Be(`audio/albums/${e.album_id}/`);else if(u.Artist.is(e))Be(`audio/artists/${e.artist_id}/`);else if(u.Disc.is(e))Be(`audio/discs/${e.disc_id}/`);else if(u.Episode.is(e))Be(`video/episodes/${e.episode_id}/`);else if(u.Movie.is(e))Be(`video/movies/${e.movie_id}/`);else if(u.Playlist.is(e))Be(`audio/playlists/${e.playlist_id}/`);else if(u.Season.is(e))Be(`video/seasons/${e.season_id}/`);else if(u.Show.is(e))Be(`video/shows/${e.show_id}/`);else{if(!u.Track.is(e))throw"Expected code to be unreachable!";Be(`audio/tracks/${e.track_id}/`)}}))).add(c.element("div.media-player__controls").add(W().bind("data-hide",C.devices.compute((e=>e.length<2))).add(D.makeBroadcast()).on("click",(()=>{Z.updateState(!Z.getState())}))).add(W().bind("data-enabled",C.canPlayLast.addObserver((e=>e))).add(D.makeLast()).on("click",(()=>{C.last()}))).add(W().bind("data-enabled",C.canPlayCurrent.addObserver((e=>e))).add(D.makePlay().bind("data-hide",C.playback.addObserver((e=>!0===e)))).add(D.makePause().bind("data-hide",C.playback.addObserver((e=>!1===e)))).on("click",(()=>{C.toggle()}))).add(W().bind("data-enabled",C.canPlayNext.addObserver((e=>e))).add(D.makeNext()).on("click",(()=>{C.next()}))))).add(c.element("div.media-player__bottom").add(ke))).render();ie.appendChild(Se),Se.appendChild(Pe),T.setAttribute("playsinline",""),T.setAttribute("preload","auto"),T.style.setProperty("height","100%"),T.style.setProperty("width","100%"),P.setAttribute("preload","auto"),P.style.setProperty("display","none"),E.setAttribute("preload","auto"),E.style.setProperty("display","none"),T.addEventListener("click",(()=>{C.pause()})),ee.addObserver((e=>{e?ae.updateState(!1):ae.updateState(!0)}));let Te=c.element("div.app__video").bind("data-hide",ee.addObserver((e=>!e))).render();function Ee(e){return c.element("div.text-header").add(e)}function Ae(e,t){return e.ref().then((e=>{new IntersectionObserver((r=>n(this,void 0,void 0,(function*(){for(let s of r)s.target===e&&s.isIntersecting&&(yield t())})))).observe(e)})),e}ie.appendChild(Te),Te.appendChild(T),Te.appendChild(P),Te.appendChild(E);let je,Ie=e=>{let t;if(null!==(t=/^audio[/]tracks[/]([0-9a-f]{16})[/]/.exec(e))){let e=t[1],s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/audio/tracks/${e}/playlists/?offset=${s}&token=${re}`,{});for(let e of t.playlists)d.append(e);s+=t.playlists.length,0===t.playlists.length&&a.updateState(!0),i.updateState(!1)}}))}J(`/api/audio/tracks/${t[1]}/?token=${re}`,{},((e,t)=>{let s=t.track,n=t.last,a=t.next;xe.appendChild(c.element("div").add(c.element("div.content").add(q.forTrack(s,{compactDescription:!1}))).add(c.element("div.content").add(K.forTrack(n,a))).add(c.element("div.content").set("style","display: grid; gap: 24px;").add(Ee(c.text("Appearances"))).bind("data-hide",d.compute((e=>0===e.length))).add(F.make().repeat(d,(e=>q.forPlaylist(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}))}else if(null!==(t=/^audio[/]tracks[/]([^/?]*)/.exec(e))){let e=t[1],s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/audio/tracks/${encodeURIComponent(e)}?offset=${s}&token=${re}`,{});for(let e of t.tracks)d.append(e);s+=t.tracks.length,0===t.tracks.length&&a.updateState(!0),i.updateState(!1)}}))}xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Tracks")))).add(c.element("div.content").add(F.make().repeat(d,(e=>q.forTrack(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^video[/]seasons[/]([0-9a-f]{16})[/]/.exec(e)))J(`/api/video/seasons/${t[1]}/?token=${re}`,{},((e,t)=>{let r=t.season,s=t.last,n=t.next;xe.appendChild(c.element("div").add(c.element("div.content").add(q.forSeason(r,{compactDescription:!1}))).add(c.element("div.content").set("style","display: grid; gap: 24px;").add(...r.episodes.map(((e,t)=>q.forEpisode(e,{playbackButton:$.forSeason(r,t)}))))).add(c.element("div.content").add(K.forSeason(s,n))).render())}));else if(null!==(t=/^video[/]seasons[/]([^/?]*)/.exec(e))){let e=t[1],s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/video/seasons/${encodeURIComponent(e)}?offset=${s}&token=${re}`,{});for(let e of t.seasons)d.append(e);s+=t.seasons.length,0===t.seasons.length&&a.updateState(!0),i.updateState(!1)}}))}xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Seasons")))).add(c.element("div.content").add(F.make().repeat(d,(e=>V.forSeason(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^audio[/]discs[/]([0-9a-f]{16})[/]/.exec(e)))J(`/api/audio/discs/${t[1]}/?token=${re}`,{},((e,t)=>{let r=t.disc,s=t.last,n=t.next;xe.appendChild(c.element("div").add(c.element("div.content").add(q.forDisc(r,{compactDescription:!1}))).add(c.element("div.content").set("style","display: grid; gap: 16px;").add(...r.tracks.map(((e,t)=>V.forTrack(e,$.forDisc(r,t)))))).add(c.element("div.content").add(K.forDisc(s,n))).render())}));else if(null!==(t=/^audio[/]discs[/]([^/?]*)/.exec(e))){let e=t[1],s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/audio/discs/${encodeURIComponent(e)}?offset=${s}&token=${re}`,{});for(let e of t.discs)d.append(e);s+=t.discs.length,0===t.discs.length&&a.updateState(!0),i.updateState(!1)}}))}xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Discs")))).add(c.element("div.content").add(F.make().repeat(d,(e=>V.forDisc(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^users[/]([0-9a-f]{16})[/]/.exec(e)))J(`/api/users/${t[1]}/?token=${re}`,{},((e,t)=>{let r=t.user,s=t.playlists;xe.appendChild(c.element("div.content").set("style","display: grid; gap: 64px;").add(Ee(c.text(r.name))).add(c.element("div").set("data-hide",""+(0===s.length)).set("style","display: grid; gap: 24px;").add(F.make().add(...s.map((e=>q.forPlaylist(e)))))).render())}));else if(null!==(t=/^users[/]([^/?]*)/.exec(e))){let e=t[1],s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/users/${encodeURIComponent(e)}?offset=${s}&token=${re}`,{});for(let e of t.users)d.append(e);s+=t.users.length,0===t.users.length&&a.updateState(!0),i.updateState(!1)}}))}xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Users")))).add(c.element("div.content").add(F.make().repeat(d,(e=>V.forUser(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^persons[/]([0-9a-f]{16})[/]/.exec(e))){let e=t[1];J(`/api/persons/${e}/?token=${re}`,{},((t,r)=>{let s=r.person;J(`/api/persons/${e}/shows/?token=${re}`,{},((t,r)=>{let n=r.shows;J(`/api/persons/${e}/movies/?token=${re}`,{},((e,t)=>{let r=t.movies;xe.appendChild(c.element("div.content").set("style","display: grid; gap: 64px;").add(Ee(c.text(s.name))).add(c.element("div").set("style","display: grid; gap: 24px;").set("data-hide",""+(0===n.length)).add(Ee(c.text("Shows"))).add(N.make(...n.map((e=>q.forShow(e)))))).add(c.element("div").set("style","display: grid; gap: 24px;").set("data-hide",""+(0===r.length)).add(Ee(c.text("Movies"))).add(F.make().add(...r.map((e=>q.forMovie(e)))))).render())}))}))}))}else if(null!==(t=/^persons[/]([^/?]*)/.exec(e))){let e=t[1],s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/persons/${encodeURIComponent(e)}?offset=${s}&token=${re}`,{});for(let e of t.persons)d.append(e);s+=t.persons.length,0===t.persons.length&&a.updateState(!0),i.updateState(!1)}}))}xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Persons")))).add(c.element("div.content").add(F.make().repeat(d,(e=>V.forPerson(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^audio[/]albums[/]([0-9a-f]{16})[/]/.exec(e)))J(`/api/audio/albums/${t[1]}/?token=${re}`,{},((e,t)=>{let r=t.album;xe.appendChild(c.element("div").add(c.element("div.content").add(q.forAlbum(r,{compactDescription:!1}))).add(...r.discs.map(((e,t)=>c.element("div.content").set("style","display: grid; gap: 16px;").add(Ee(c.text("Disc "+e.number))).add(...e.tracks.map(((e,s)=>V.forTrack(e,$.forAlbum(r,t,s)))))))).render())}));else if(null!==(t=/^audio[/]albums[/]([^/?]*)/.exec(e))){let e=0,t=new o.ObservableClass(!1),s=new o.ObservableClass(!1),a=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!t.getState()&&!s.getState()){s.updateState(!0);let r=yield Q(`/api/audio/albums/?offset=${e}&token=${re}`,{});for(let e of r.albums)a.append(e);e+=r.albums.length,0===r.albums.length&&t.updateState(!0),s.updateState(!1)}}))}xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Albums")))).add(c.element("div.content").add(F.make().repeat(a,(e=>q.forAlbum(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^audio[/]artists[/]([0-9a-f]{16})[/]/.exec(e)))J(`/api/audio/artists/${t[1]}/?token=${re}`,{},((e,t)=>{let r=t.artist,s=t.tracks,n=t.appearances;xe.appendChild(c.element("div").add(c.element("div.content").add(q.forArtist(r,{compactDescription:!1}))).add(0===s.length?void 0:c.element("div.content").set("style","display: grid; gap: 24px;").add(Ee(c.text("Popular tracks"))).add(c.element("div").set("style","display: grid; gap: 16px;").add(...s.map((e=>V.forTrack(e)))))).add(0===r.albums.length?void 0:c.element("div.content").set("style","display: grid; gap: 24px;").add(Ee(c.text("Discography"))).add(F.make().add(...r.albums.map(((e,t)=>q.forAlbum(e,{playbackButton:$.forArtist(r,t)})))))).add(0===n.length?void 0:c.element("div.content").set("style","display: grid; gap: 24px;").add(Ee(c.text("Appearances"))).add(F.make().add(...n.map((e=>q.forAlbum(e)))))).render())}));else if(null!==(t=/^audio[/]artists[/]([^/?]*)/.exec(e))){let e=0,t=new o.ObservableClass(!1),s=new o.ObservableClass(!1),a=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!t.getState()&&!s.getState()){s.updateState(!0);let r=yield Q(`/api/audio/artists/?offset=${e}&token=${re}`,{});for(let e of r.artists)a.append(e);e+=r.artists.length,0===r.artists.length&&t.updateState(!0),s.updateState(!1)}}))}xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Artists")))).add(c.element("div.content").add(F.make().repeat(a,(e=>q.forArtist(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^audio[/]playlists[/]([0-9a-f]{16})[/]/.exec(e))){let r=t[1];J(`/api/audio/playlists/${r}/?token=${re}`,{},((t,s)=>n(void 0,void 0,void 0,(function*(){let t=s.playlist,a="write"===(yield O.getPermissions({playlist:{playlist_id:r}})).permissions,i=new o.ObservableClass(t.title),d=new o.ObservableClass(t.description),l=o.computed((e=>""!==e),i);xe.appendChild(c.element("div").add(c.element("div.content").add(q.forPlaylist(t,{compactDescription:!1}))).add(c.element("div.content.content--compact").set("style","display: grid; gap: 16px;").set("data-hide",""+!a).add(c.element("div").set("style","position: relative;").add(c.element("input").bind2("value",i).set("type","text").set("spellcheck","false").set("placeholder","Playlist title")).add(D.makeStar().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);"))).add(c.element("div").set("style","position: relative;").add(c.element("input").bind2("value",d).set("type","text").set("spellcheck","false").set("placeholder","Playlist description")).add(D.makeStar().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);"))).add(c.element("button").bind2("data-enabled",o.computed((e=>""+e),l)).add(c.text("Update playlist")).on("click",(()=>n(void 0,void 0,void 0,(function*(){yield n(void 0,void 0,void 0,(function*(){if(l.getState()){if((yield O.updatePlaylist({playlist:{playlist_id:r,title:i.getState(),description:d.getState()}})).errors.length>0)return;Be(e)}}))})))))).add(0===t.items.length?void 0:c.element("div.content").set("style","display: grid; gap: 16px;").add(...t.items.map(((r,s)=>c.element("div").set("style","align-items: center; display: grid; grid-template-columns: 1fr min-content; gap: 16px;").add(V.forTrack(r.track,$.forPlaylist(t,s))).add(W().set("data-hide",""+!a).on("click",(()=>n(void 0,void 0,void 0,(function*(){if(l.getState()){if((yield O.deletePlaylistItem({playlist_item:{playlist_item_id:r.playlist_item_id}})).errors.length>0)return;Be(e)}})))).add(D.makeMinus())))))).add(c.element("div.content.content--compact").set("style","display: grid; gap: 16px;").set("data-hide",""+!a).add(c.element("button").bind2("data-enabled",o.computed((e=>""+e),l)).add(c.text("Delete playlist")).on("click",(()=>n(void 0,void 0,void 0,(function*(){if(l.getState()){if((yield O.deletePlaylist({playlist:{playlist_id:r}})).errors.length>0)return;Be("")}})))))).render())}))))}else if(null!==(t=/^audio[/]playlists[/]([^/?]*)/.exec(e)))J("/api/audio/playlists/?token="+re,{},((e,t)=>{let r=t.playlists;xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Playlists")))).add(c.element("div.content").add(F.make().add(...r.map((e=>q.forPlaylist(e)))))).render())}));else if(null!==(t=/^audio[/]/.exec(e)))xe.appendChild(c.element("div").add(c.element("div.content").add(c.element("div").set("style","display: grid; gap: 24px; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));").add(X(D.makeDisc(),"Albums","audio/albums/")).add(X(D.makePersonLine(),"Artists","audio/artists/")).add(X(D.makeList(),"Playlists","audio/playlists/")))).render());else if(null!==(t=/^video[/]shows[/]([0-9a-f]{16})[/]/.exec(e))){let e=t[1];J(`/api/video/shows/${e}/?token=${re}`,{},((e,t)=>{const r=t.show,s=function(e){let t;return e.seasons.forEach(((r,s)=>{r.episodes.forEach(((r,n)=>{var a;if(l.present(r.last_stream_date)){if(l.present(t)&&r.last_stream_date<(null!==(a=e.seasons[t.seasonIndex].episodes[t.episodeIndex].last_stream_date)&&void 0!==a?a:0))return;t={seasonIndex:s,episodeIndex:n}}}))})),l.present(t)?(t.episodeIndex+=1,t.episodeIndex===e.seasons[t.seasonIndex].episodes.length&&(t.episodeIndex=0,t.seasonIndex+=1,t.seasonIndex===e.seasons.length&&(t.seasonIndex=0))):e.seasons.length>0&&e.seasons[0].episodes.length>0&&(t={seasonIndex:0,episodeIndex:0}),t}(r);xe.appendChild(c.element("div").add(c.element("div.content").add(q.forShow(r,{compactDescription:!1}))).add(c.element("div.content").set("data-hide",""+(0===r.actors.length)).set("style","display: grid; gap: 16px;").add(...r.actors.map((e=>V.forPerson(e))))).add(l.absent(s)?void 0:c.element("div.content").set("style","display: grid; gap: 24px;").add(Ee(c.text("Suggested episode"))).add(q.forEpisode(r.seasons[s.seasonIndex].episodes[s.episodeIndex],{playbackButton:$.forShow(r,s.seasonIndex,s.episodeIndex)}))).add(c.element("div.content").add(F.make().add(...r.seasons.map(((e,t)=>q.forSeason(e,{playbackButton:$.forShow(r,t)})))))).render())}))}else if(null!==(t=/^video[/]shows[/]([^/?]*)/.exec(e)))J("/api/video/shows/?token="+re,{},((e,t)=>{let r=t.shows;xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Shows")))).add(c.element("div.content").add(F.make().add(...r.map((e=>q.forShow(e)))))).render())}));else if(null!==(t=/^video[/]episodes[/]([0-9a-f]{16})[/]/.exec(e))){let e=t[1];J(`/api/video/episodes/${e}/?token=${re}`,{},((e,t)=>{let r=t.episode,s=t.last,n=t.next;xe.appendChild(c.element("div").add(c.element("div.content").add(q.forEpisode(r,{compactDescription:!1}))).add(c.element("div.content").add(K.forEpisode(s,n))).render())}))}else if(null!==(t=/^video[/]episodes[/]([^/?]*)/.exec(e))){let e=t[1],s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/video/episodes/${encodeURIComponent(e)}?offset=${s}&token=${re}`,{});for(let e of t.episodes)d.append(e);s+=t.episodes.length,0===t.episodes.length&&a.updateState(!0),i.updateState(!1)}}))}xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Episodes")))).add(c.element("div.content").add(F.make().repeat(d,(e=>V.forEpisode(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^video[/]movies[/]([0-9a-f]{16})[/]/.exec(e))){let e=t[1];J(`/api/video/movies/${e}/?token=${re}`,{},((t,r)=>{let s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]),l=r.movie;xe.appendChild(c.element("div").add(c.element("div.content").add(q.forMovie(l,{compactDescription:!1}))).add(c.element("div.content").set("data-hide",""+(0===l.actors.length)).set("style","display: grid; gap: 16px;").add(...l.actors.map((e=>V.forPerson(e))))).add(c.element("div.content").bind("data-hide",d.compute((e=>0===e.length))).set("style","display: grid; gap: 16px;").add(Ee(c.text("Suggested movies"))).add(F.make().repeat(d,(e=>q.forMovie(e))))).add(Ae(c.element("div").set("style","height: 1px;"),(function(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/video/movies/${e}/suggestions/movies/?offset=${s}&token=${re}`,{});for(let e of t.movies)d.append(e);s+=t.movies.length,0===t.movies.length&&a.updateState(!0),i.updateState(!1)}}))}))).render())}))}else if(null!==(t=/^video[/]movies[/]([^/?]*)/.exec(e))){let e=0,t=new o.ObservableClass(!1),s=new o.ObservableClass(!1),a=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!t.getState()&&!s.getState()){s.updateState(!0);let r=yield Q(`/api/video/movies/?offset=${e}&token=${re}`,{});for(let e of r.movies)a.append(e);e+=r.movies.length,0===r.movies.length&&t.updateState(!0),s.updateState(!1)}}))}xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text("Movies")))).add(c.element("div.content").add(F.make().repeat(a,(e=>q.forMovie(e))))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^video[/]cues[/]([^/?]*)/.exec(e))){let e=new o.ObservableClass(decodeURIComponent(t[1])),s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/video/cues/${encodeURIComponent(e.getState())}?offset=${s}&token=${re}`,{});for(let e of t.cues)d.append(e);s+=t.cues.length,0===t.cues.length&&a.updateState(!0),i.updateState(!1)}}))}xe.appendChild(c.element("div.content").set("style","display: grid; gap: 32px;").add(c.element("div").set("style","position: relative;").add(c.element("input").set("type","text").set("spellcheck","false").set("placeholder","Search query").bind2("value",e).on("keyup",(t=>{"Enter"===t.code&&Be("video/cues/"+encodeURIComponent(e.getState()))}))).add(D.makeMagnifyingGlass().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);"))).add(c.element("div").set("style","display: grid; gap: 16px;").repeat(d,(e=>{let t=e.media;if(u.Episode.is(t)){let e=t;return V.forEpisode(e,$.forEpisode(e))}if(u.Movie.is(t)){let e=t;return V.forMovie(e,$.forMovie(e))}throw"Expected code to be unreachable!"}))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^video[/]genres[/]([0-9a-f]{16})[/]/.exec(e))){let e=t[1];J(`/api/video/genres/${e}/?token=${re}`,{},((t,r)=>{let s=r.genre;J(`/api/video/genres/${e}/shows/?token=${re}`,{},((t,r)=>{let a=r.shows,i=0,d=new o.ObservableClass(!1),l=new o.ObservableClass(!1),u=new o.ArrayObservable([]);xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text(s.title)))).add(0===a.length?void 0:c.element("div.content").set("style","display: grid; gap: 24px;").add(Ee(c.text("Shows"))).add(N.make(...a.map((e=>q.forShow(e)))))).add(c.element("div.content").bind("data-hide",u.compute((e=>0===e.length))).set("style","display: grid; gap: 24px;").add(Ee(c.text("Movies"))).add(F.make().repeat(u,(e=>q.forMovie(e))))).add(Ae(c.element("div").set("style","height: 1px;"),(function(){return n(this,void 0,void 0,(function*(){if(!d.getState()&&!l.getState()){l.updateState(!0);let t=yield Q(`/api/video/genres/${e}/movies/?offset=${i}&token=${re}`,{});for(let e of t.movies)u.append(e);i+=t.movies.length,0===t.movies.length&&d.updateState(!0),l.updateState(!1)}}))}))).render())}))}))}else if(null!==(t=/^video[/]genres[/]([^/?]*)/.exec(e)))J("/api/video/genres/?token="+re,{},((e,t)=>{let r=t.genres;xe.appendChild(c.element("div").add(c.element("div.content").add(c.element("div").set("style","display: grid; gap: 24px; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));").add(...r.map((e=>X(D.makePieChart(),e.title,`video/genres/${e.genre_id}/`)))))).render())}));else if(null!==(t=/^video[/]/.exec(e)))xe.appendChild(c.element("div").add(c.element("div.content").add(c.element("div").set("style","display: grid; gap: 24px; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));").add(X(D.makeStarLine(),"Movies","video/movies/")).add(X(D.makeMonitor(),"Shows","video/shows/")).add(X(D.makePieChart(),"Genres","video/genres/")))).render());else if(null!==(t=/^search[/]([^/]*)/.exec(e))){let e=new o.ObservableClass(decodeURIComponent(t[1])),s=0,a=new o.ObservableClass(!1),i=new o.ObservableClass(!1),d=new o.ArrayObservable([]);function r(){return n(this,void 0,void 0,(function*(){if(!a.getState()&&!i.getState()){i.updateState(!0);let t=yield Q(`/api/search/${encodeURIComponent(e.getState())}?offset=${s}&token=${re}`,{});for(let e of t.entities)d.append(e);s+=t.entities.length,0===t.entities.length&&a.updateState(!0),i.updateState(!1)}}))}let u=new o.ArrayObservable([]),p=new o.ArrayObservable([]);d.addObserver({onappend(e){0===u.getState().length?u.append(e):p.append(e)}}),xe.appendChild(c.element("div.content").set("style","display: grid; gap: 48px;").add(c.element("div").set("style","position: relative;").add(c.element("input").set("type","text").set("spellcheck","false").set("placeholder","Search query").bind2("value",e).on("keyup",(t=>{"Enter"===t.code&&Be("search/"+encodeURIComponent(e.getState()))}))).add(D.makeMagnifyingGlass().set("style","fill: rgb(255, 255, 255); position: absolute; left: 0px; top: 50%; transform: translate(100%, -50%);"))).add(c.element("div").set("style","display: grid; gap: 24px;").bind("data-hide",u.compute(l.absent)).repeat(u,(e=>q.forEntity(e,{compactDescription:!1})))).add(c.element("div").set("style","display: grid; gap: 16px;").bind("data-hide",p.compute(l.absent)).repeat(p,(e=>V.forEntity(e)))).add(Ae(c.element("div").set("style","height: 1px;"),r)).render())}else if(null!==(t=/^years[/]([0-9a-f]{16})[/]/.exec(e)))Q(`/api/years/${t[1]}/?token=${re}`,{}).then((e=>{let t=e.year,r=e.movies,s=e.albums;xe.appendChild(c.element("div").add(c.element("div.content").add(Ee(c.text(""+t.year))).add(c.element("div").set("style","display: grid; gap: 24px;").set("data-hide",""+(0===r.length)).add(Ee(c.text("Movies"))).add(N.make(...r.map((e=>q.forMovie(e)))))).add(c.element("div").set("style","display: grid; gap: 24px;").set("data-hide",""+(0===s.length)).add(Ee(c.text("Albums"))).add(F.make().add(...s.map((e=>q.forAlbum(e))))))).render())}));else if(null!==(t=/^years[/]([^/]*)/.exec(e))){let e=decodeURIComponent(t[1]);Q(`/api/years/${encodeURIComponent(e)}?length=100&token=${re}`,{}).then((e=>{let t=e.years;xe.appendChild(c.element("div").add(c.element("div.content").add(c.element("div").set("style","display: grid; gap: 24px; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));").add(...t.map((e=>X(D.makeCalendar(),""+e.year,`years/${e.year_id}/`)))))).render())}))}else xe.appendChild(c.element("div").add(c.element("div.content").add(c.element("div").set("style","display: grid; gap: 24px; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));").add(X(D.makeMonitor(),"Watch","video/")).add(X(D.makeSpeaker(),"Listen","audio/")).add(X(D.makeMagnifyingGlassLine(),"Search","search/")).add(X(D.makeCalendar(),"Revisit","years/")))).render())},Re=new Array;function Be(e,t=!1){if(l.present(je)){let e=Re.find((e=>e.uri===je));l.present(e)?(Re.splice(Re.indexOf(e),1),e.x=xe.scrollLeft,e.y=xe.scrollTop):e={uri:je,element:xe.firstChild,x:xe.scrollLeft,y:xe.scrollTop},Re.unshift(e)}for(Re=Re.slice(0,10);l.present(xe.lastChild);)xe.lastChild.remove();let r=Re.find((t=>t.uri===e));l.present(r)?(xe.appendChild(r.element),t?(xe.scrollLeft=r.x,xe.scrollTop=r.y):(xe.scrollLeft=0,xe.scrollTop=0)):Ie(e),l.absent(window.history.state)?window.history.replaceState({uri:e},"",e):e!==window.history.state.uri&&window.history.pushState({uri:e},"",e),je=e}window.addEventListener("popstate",(e=>{Be(e.state.uri,!0)})),Be(((e=window.location.pathname,t=(()=>{let e=document.head.querySelector("base[href]");if(null!==e){let t=e.getAttribute("href");if(null!==t)return t}return"/"})())=>{let r=e.split("/"),s=t.split("/"),n=0;for(;n<r.length&&n<s.length&&r[n]===s[n];)n++;return r.slice(n).join("/")})())},302:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Autoguard=t.Year=t.PlaylistItem=t.Playlist=t.Stream=t.Token=t.Key=t.User=t.Cue=t.Subtitle=t.ShowGenre=t.MovieGenre=t.Genre=t.ShowPerson=t.MoviePerson=t.Person=t.MovieFile=t.Movie=t.EpisodeFile=t.Episode=t.Season=t.ShowFile=t.Show=t.TrackArtist=t.AlbumArtist=t.TrackFile=t.Track=t.Disc=t.AlbumFile=t.Album=t.Artist=t.VideoSubtitle=t.VideoFile=t.SubtitleFile=t.MetadataFile=t.ImageFile=t.AudioFile=t.File=t.Directory=void 0;const s=r(175);t.Directory=s.guards.Object.of({directory_id:s.guards.String,name:s.guards.String,parent_directory_id:s.guards.Union.of(s.guards.Undefined,s.guards.String)}),t.File=s.guards.Object.of({file_id:s.guards.String,name:s.guards.String,parent_directory_id:s.guards.Union.of(s.guards.Undefined,s.guards.String),index_timestamp:s.guards.Union.of(s.guards.Undefined,s.guards.Number)}),t.AudioFile=s.guards.Object.of({file_id:s.guards.String,mime:s.guards.Union.of(s.guards.StringLiteral.of("audio/mp4"),s.guards.StringLiteral.of("audio/mp3")),duration_ms:s.guards.Number}),t.ImageFile=s.guards.Object.of({file_id:s.guards.String,mime:s.guards.StringLiteral.of("image/jpeg"),width:s.guards.Number,height:s.guards.Number}),t.MetadataFile=s.guards.Object.of({file_id:s.guards.String,mime:s.guards.StringLiteral.of("application/json")}),t.SubtitleFile=s.guards.Object.of({file_id:s.guards.String,mime:s.guards.StringLiteral.of("text/vtt"),duration_ms:s.guards.Number,language:s.guards.Union.of(s.guards.Undefined,s.guards.String)}),t.VideoFile=s.guards.Object.of({file_id:s.guards.String,mime:s.guards.StringLiteral.of("video/mp4"),duration_ms:s.guards.Number,width:s.guards.Number,height:s.guards.Number}),t.VideoSubtitle=s.guards.Object.of({video_file_id:s.guards.String,subtitle_file_id:s.guards.String}),t.Artist=s.guards.Object.of({artist_id:s.guards.String,name:s.guards.String}),t.Album=s.guards.Object.of({album_id:s.guards.String,title:s.guards.String,year:s.guards.Union.of(s.guards.Undefined,s.guards.Number)}),t.AlbumFile=s.guards.Object.of({album_id:s.guards.String,file_id:s.guards.String}),t.Disc=s.guards.Object.of({disc_id:s.guards.String,album_id:s.guards.String,number:s.guards.Number}),t.Track=s.guards.Object.of({track_id:s.guards.String,disc_id:s.guards.String,title:s.guards.String,number:s.guards.Number}),t.TrackFile=s.guards.Object.of({track_id:s.guards.String,file_id:s.guards.String}),t.AlbumArtist=s.guards.Object.of({album_id:s.guards.String,artist_id:s.guards.String,order:s.guards.Number}),t.TrackArtist=s.guards.Object.of({track_id:s.guards.String,artist_id:s.guards.String,order:s.guards.Number}),t.Show=s.guards.Object.of({show_id:s.guards.String,name:s.guards.String,summary:s.guards.Union.of(s.guards.Undefined,s.guards.String)}),t.ShowFile=s.guards.Object.of({show_id:s.guards.String,file_id:s.guards.String}),t.Season=s.guards.Object.of({season_id:s.guards.String,show_id:s.guards.String,number:s.guards.Number}),t.Episode=s.guards.Object.of({episode_id:s.guards.String,season_id:s.guards.String,title:s.guards.String,number:s.guards.Number,year:s.guards.Union.of(s.guards.Undefined,s.guards.Number),summary:s.guards.Union.of(s.guards.Undefined,s.guards.String)}),t.EpisodeFile=s.guards.Object.of({episode_id:s.guards.String,file_id:s.guards.String}),t.Movie=s.guards.Object.of({movie_id:s.guards.String,title:s.guards.String,year:s.guards.Union.of(s.guards.Undefined,s.guards.Number),summary:s.guards.Union.of(s.guards.Undefined,s.guards.String)}),t.MovieFile=s.guards.Object.of({movie_id:s.guards.String,file_id:s.guards.String}),t.Person=s.guards.Object.of({person_id:s.guards.String,name:s.guards.String}),t.MoviePerson=s.guards.Object.of({movie_id:s.guards.String,person_id:s.guards.String,order:s.guards.Number}),t.ShowPerson=s.guards.Object.of({show_id:s.guards.String,person_id:s.guards.String,order:s.guards.Number}),t.Genre=s.guards.Object.of({genre_id:s.guards.String,name:s.guards.String}),t.MovieGenre=s.guards.Object.of({movie_id:s.guards.String,genre_id:s.guards.String,order:s.guards.Number}),t.ShowGenre=s.guards.Object.of({show_id:s.guards.String,genre_id:s.guards.String,order:s.guards.Number}),t.Subtitle=s.guards.Object.of({subtitle_id:s.guards.String,file_id:s.guards.String}),t.Cue=s.guards.Object.of({cue_id:s.guards.String,subtitle_id:s.guards.String,start_ms:s.guards.Number,duration_ms:s.guards.Number,lines:s.guards.String}),t.User=s.guards.Object.of({user_id:s.guards.String,name:s.guards.String,username:s.guards.String,password:s.guards.String}),t.Key=s.guards.Object.of({key_id:s.guards.String,user_id:s.guards.Union.of(s.guards.Undefined,s.guards.String)}),t.Token=s.guards.Object.of({token_id:s.guards.String,user_id:s.guards.String,hash:s.guards.String,expires_ms:s.guards.Number}),t.Stream=s.guards.Object.of({stream_id:s.guards.String,user_id:s.guards.String,file_id:s.guards.String,timestamp_ms:s.guards.Number}),t.Playlist=s.guards.Object.of({playlist_id:s.guards.String,title:s.guards.String,description:s.guards.String,user_id:s.guards.String}),t.PlaylistItem=s.guards.Object.of({playlist_item_id:s.guards.String,playlist_id:s.guards.String,track_id:s.guards.String,number:s.guards.Number,added_ms:s.guards.Number}),t.Year=s.guards.Object.of({year_id:s.guards.String,year:s.guards.Number}),t.Autoguard={Directory:t.Directory,File:t.File,AudioFile:t.AudioFile,ImageFile:t.ImageFile,MetadataFile:t.MetadataFile,SubtitleFile:t.SubtitleFile,VideoFile:t.VideoFile,VideoSubtitle:t.VideoSubtitle,Artist:t.Artist,Album:t.Album,AlbumFile:t.AlbumFile,Disc:t.Disc,Track:t.Track,TrackFile:t.TrackFile,AlbumArtist:t.AlbumArtist,TrackArtist:t.TrackArtist,Show:t.Show,ShowFile:t.ShowFile,Season:t.Season,Episode:t.Episode,EpisodeFile:t.EpisodeFile,Movie:t.Movie,MovieFile:t.MovieFile,Person:t.Person,MoviePerson:t.MoviePerson,ShowPerson:t.ShowPerson,Genre:t.Genre,MovieGenre:t.MovieGenre,ShowGenre:t.ShowGenre,Subtitle:t.Subtitle,Cue:t.Cue,User:t.User,Key:t.Key,Token:t.Token,Stream:t.Stream,Playlist:t.Playlist,PlaylistItem:t.PlaylistItem,Year:t.Year}},565:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.present=t.absent=void 0,t.absent=function(e){return null==e},t.present=function(e){return null!=e}},298:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NumericSort=t.LexicalSort=t.CustomSort=t.CombinedSort=t.SearchIndex=t.RecordIndex=t.CollectionIndex=t.sorters=t.indices=void 0,t.indices=r(546),t.sorters=r(693);var s=r(546);Object.defineProperty(t,"CollectionIndex",{enumerable:!0,get:function(){return s.CollectionIndex}});var n=r(546);Object.defineProperty(t,"RecordIndex",{enumerable:!0,get:function(){return n.RecordIndex}});var a=r(546);Object.defineProperty(t,"SearchIndex",{enumerable:!0,get:function(){return a.SearchIndex}});var i=r(693);Object.defineProperty(t,"CombinedSort",{enumerable:!0,get:function(){return i.CombinedSort}});var o=r(693);Object.defineProperty(t,"CustomSort",{enumerable:!0,get:function(){return o.CustomSort}});var d=r(693);Object.defineProperty(t,"LexicalSort",{enumerable:!0,get:function(){return d.LexicalSort}});var l=r(693);Object.defineProperty(t,"NumericSort",{enumerable:!0,get:function(){return l.NumericSort}})},546:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SearchIndex=t.getTokens=t.RecordIndex=t.CollectionIndex=void 0;const s=r(978),n=r(565),a=r(693);class i{constructor(e,t,r){this.getPrimaryKeysFromIndexedValue=new Map,this.lookupRecord=e,this.getPrimaryKey=t,this.getIndexedValue=r}insert(e){let t=this.getIndexedValue(e),r=this.getPrimaryKeysFromIndexedValue.get(t);n.absent(r)&&(r=new Set,this.getPrimaryKeysFromIndexedValue.set(t,r));let s=this.getPrimaryKey(e);r.add(s)}lookup(e){let t=this.getPrimaryKeysFromIndexedValue.get(e);return n.present(t)?Array.from(t).map(this.lookupRecord):new Array}remove(e){let t=this.getIndexedValue(e),r=this.getPrimaryKeysFromIndexedValue.get(t);if(n.present(r)){let s=this.getPrimaryKey(e);r.delete(s),0===r.size&&this.getPrimaryKeysFromIndexedValue.delete(t)}}update(e,t){this.remove(e),this.insert(t)}static fromIndex(e,t,r){let s=new i((e=>t.lookup(e)),(e=>t.keyof(e)),r);return t.on("insert",(e=>{s.insert(e.next)})),t.on("remove",(e=>{s.remove(e.last)})),t.on("update",(e=>{s.update(e.last,e.next)})),e.on("remove",(r=>{let n=e.keyof(r.last);for(let e of s.lookup(n))t.remove(e)})),s}static fromTable(e,t,r){let s=new i((e=>t.lookup(e)),(e=>t.keyof(e)),r);return t.on("insert",(e=>{s.insert(e.next)})),t.on("remove",(e=>{s.remove(e.last)})),t.on("update",(e=>{s.update(e.last,e.next)})),e.on("remove",(r=>{let n=e.keyof(r.last);for(let e of s.lookup(n))t.remove(e)})),s}}t.CollectionIndex=i;class o{constructor(e){this.getRecordFromKey=new Map,this.getKey=e,this.router=new s.routing.MessageRouter}insertOrUpdate(e,t="replace"){let r=this.getKey(e),s=this.getRecordFromKey.get(r);if(n.present(s)){if("combine"===t)for(let t in s){let r=s[t],a=e[t];n.present(r)&&n.absent(a)&&(e[t]=s[t])}this.getRecordFromKey.set(r,e),this.router.route("update",{last:s,next:e}),this.router.route("*",{})}else this.getRecordFromKey.set(r,e),this.router.route("insert",{next:e}),this.router.route("*",{})}[Symbol.iterator](){return this.getRecordFromKey.values()}insert(e,t="replace"){this.insertOrUpdate(e,t)}keyof(e){return this.getKey(e)}length(){return this.getRecordFromKey.size}lookup(e){let t=this.getRecordFromKey.get(e);if(n.absent(t))throw`Expected "${e}" to match a record!`;return t}on(e,t){if(this.router.addObserver(e,t),"insert"===e)for(let e of this.getRecordFromKey.values())t({next:e})}off(e,t){this.router.addObserver(e,t)}remove(e){let t=this.getKey(e);this.getRecordFromKey.has(t)&&(this.getRecordFromKey.delete(t),this.router.route("remove",{last:e}),this.router.route("*",{}))}update(e,t="replace"){this.insertOrUpdate(e,t)}static from(e,t){let r=new o(t);for(let t of e)r.insert(t);return r}}function d(e){var t;let r=e;return r=r.toLowerCase(),r=r.normalize("NFKD"),r=r.replace(/[\p{M}]/gu,""),Array.from(null!==(t=r.match(/(\p{L}+|\p{N}+)/gu))&&void 0!==t?t:[])}t.RecordIndex=o,t.getTokens=d;class l{constructor(e,t,r,s){this.getPrimaryKeysFromToken=new Map,this.lookupRecord=e,this.getPrimaryKey=t,this.getIndexedValues=r,this.useDict=s}insert(e){for(let t of this.getIndexedValues(e)){let r=d(t);this.useDict&&(r=r.filter((e=>e.length>=4)));for(let t of r){let r=this.getPrimaryKeysFromToken.get(t);n.absent(r)&&(r=new Set,this.getPrimaryKeysFromToken.set(t,r));let s=this.getPrimaryKey(e);r.add(s)}}}lookup(e){var t;let r=d(e),s=r.map((e=>this.getPrimaryKeysFromToken.get(e))).filter(n.present),i=new Map;for(let e of s)for(let s of e){let e=null!==(t=i.get(s))&&void 0!==t?t:0-r.length;i.set(s,e+2)}return Array.from(i.entries()).filter((e=>e[1]>=0)).sort(a.NumericSort.increasing((e=>e[1]))).map((e=>({id:e[0],rank:e[1]})))}remove(e){for(let t of this.getIndexedValues(e)){let r=d(t);for(let t of r){let r=this.getPrimaryKeysFromToken.get(t);if(n.present(r)){let s=this.getPrimaryKey(e);r.delete(s),0===r.size&&this.getPrimaryKeysFromToken.delete(t)}}}}update(e,t){this.remove(e),this.insert(t)}static fromIndex(e,t,r=!1){let s=new l((t=>e.lookup(t)),(t=>e.keyof(t)),t,r);return e.on("insert",(e=>{s.insert(e.next)})),e.on("remove",(e=>{s.remove(e.last)})),e.on("update",(e=>{s.update(e.last,e.next)})),s}static fromTable(e,t,r=!1){let s=new l((t=>e.lookup(t)),(t=>e.keyof(t)),t,r);return e.on("insert",(e=>{s.insert(e.next)})),e.on("remove",(e=>{s.remove(e.last)})),e.on("update",(e=>{s.update(e.last,e.next)})),s}}t.SearchIndex=l},693:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NumericSort=t.LexicalSort=t.CustomSort=t.CombinedSort=void 0;const s=r(565);t.CombinedSort={of:(...e)=>(t,r)=>{for(let s of e){let e=s(t,r);if(0!==e)return e}return 0}},t.CustomSort={decreasing:e=>(t,r)=>{let n=e(t),a=e(r);return s.absent(n)?s.absent(a)?0:-1:s.absent(a)?s.absent(n)?0:1:(a?1:0)-(n?1:0)},increasing:e=>(t,r)=>{let n=e(t),a=e(r);return s.absent(n)?s.absent(a)?0:1:s.absent(a)?s.absent(n)?0:-1:(n?1:0)-(a?1:0)}},t.LexicalSort={decreasing:e=>(t,r)=>{let n=e(t),a=e(r);return s.absent(n)?s.absent(a)?0:-1:s.absent(a)?s.absent(n)?0:1:a.localeCompare(n)},increasing:e=>(t,r)=>{let n=e(t),a=e(r);return s.absent(n)?s.absent(a)?0:1:s.absent(a)?s.absent(n)?0:-1:n.localeCompare(a)}},t.NumericSort={decreasing:e=>(t,r)=>{let n=e(t),a=e(r);return s.absent(n)?s.absent(a)?0:-1:s.absent(a)?s.absent(n)?0:1:a-n},increasing:e=>(t,r)=>{let n=e(t),a=e(r);return s.absent(n)?s.absent(a)?0:1:s.absent(a)?s.absent(n)?0:-1:n-a}}},618:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pref=t.db=void 0,t.db={eng:{title:"English",iso639_1:"en",iso3166_1:"US"},swe:{title:"Swedish",iso639_1:"sv",iso3166_1:"SE"},jpn:{title:"Japanese",iso639_1:"ja",iso3166_1:"JP"}},t.pref=["swe","eng","jpn"]},440:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ArrayObservable=t.computed=t.ObservableClass=void 0;class r{constructor(e){this.state=e,this.observers=new Array}addObserver(e){let t=new r(e(this.state));return this.observers.push((r=>{t.updateState(e(r))})),t.addObserver.bind(t)}getState(){return this.state}updateState(e){if(e!==this.state){this.state=e;for(let e of this.observers)e(this.state)}}}t.ObservableClass=r,t.computed=function(e,...t){let s=new r(e(...t.map((e=>e.getState())))),n=()=>{s.updateState(e(...t.map((e=>e.getState()))))};for(let e of t)e.addObserver(n);return s},t.ArrayObservable=class{constructor(e){this.state=e,this.observers=new Array}addObserver(e){var t;this.observers.push(e);for(let r of this.state)null===(t=e.onappend)||void 0===t||t.call(e,r)}compute(e){let t=new r(e(this.state));return this.observers.push({onappend:r=>{t.updateState(e(this.state))},onsplice:(r,s)=>{t.updateState(e(this.state))}}),t.addObserver.bind(t)}getState(){return this.state}append(e){var t;this.state.push(e);for(let r of this.observers)null===(t=r.onappend)||void 0===t||t.call(r,e)}splice(e){var t;if(e<0||e>=this.state.length)throw`Expected an index of at most ${this.state.length}, got ${e}!`;let r=this.state[e];this.state.splice(e,1);for(let s of this.observers)null===(t=s.onsplice)||void 0===t||t.call(s,r,e)}update(e){for(let e=this.state.length-1;e>=0;e--)this.splice(e);for(let t of e)this.append(t)}}},676:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextClient=void 0;const s=r(565),n=r(440),a=r(14),i=r(578);t.ContextClient=class{constructor(e,t=(e=>new WebSocket(e))){this.estimatedProgress=new n.ObservableClass(void 0),this.estimatedProgressTimestamp=new n.ObservableClass(void 0),this.token=new n.ObservableClass(void 0),this.localDevice=new n.ObservableClass(void 0),this.devices=new n.ArrayObservable(new Array),this.device=new n.ObservableClass(void 0),this.isDeviceLocal=new n.ObservableClass(!1),this.isDeviceRemote=new n.ObservableClass(!1),this.context=new n.ObservableClass(void 0),this.contextPath=new n.ObservableClass(void 0),this.flattenedContext=new n.ObservableClass(void 0),this.lastIndex=new n.ObservableClass(void 0),this.lastEntry=new n.ObservableClass(void 0),this.lastLocalEntry=new n.ObservableClass(void 0),this.currentIndex=new n.ObservableClass(void 0),this.currentEntry=new n.ObservableClass(void 0),this.currentLocalEntry=new n.ObservableClass(void 0),this.nextIndex=new n.ObservableClass(void 0),this.nextEntry=new n.ObservableClass(void 0),this.nextLocalEntry=new n.ObservableClass(void 0),this.playback=new n.ObservableClass(!1),this.progress=new n.ObservableClass(void 0),this.localPlayback=new n.ObservableClass(!1),this.canPlayLast=new n.ObservableClass(!1),this.canPlayCurrent=new n.ObservableClass(!1),this.canPlayNext=new n.ObservableClass(!1),this.isCurrentEntryVideo=new n.ObservableClass(!1),this.isOnline=new n.ObservableClass(!1),this.tsc=new i.TypeSocketClient(e,t,a.messages.Autoguard),this.tsc.addEventListener("sys","connect",(()=>{this.isOnline.updateState(!0)})),this.tsc.addEventListener("sys","disconnect",(()=>{this.isOnline.updateState(!1)})),this.context.addObserver((e=>{if(s.present(e))if(a.objects.ContextAlbum.is(e)){let t=[],r=e;for(let e of r.discs)t.push(...e.tracks);this.flattenedContext.updateState(t)}else if(a.objects.ContextArtist.is(e)){let t=[],r=e;for(let e of r.albums)for(let r of e.discs)t.push(...r.tracks);this.flattenedContext.updateState(t)}else if(a.objects.ContextEpisode.is(e)){let t=[],r=e;t.push(r),this.flattenedContext.updateState(t)}else if(a.objects.ContextMovie.is(e)){let t=[],r=e;t.push(r),this.flattenedContext.updateState(t)}else if(a.objects.ContextPlaylist.is(e)){let t=[],r=e;for(let e of r.items)t.push(e.track);this.flattenedContext.updateState(t)}else if(a.objects.ContextSeason.is(e)){let t=[],r=e;t.push(...r.episodes),this.flattenedContext.updateState(t)}else if(a.objects.ContextShow.is(e)){let t=[],r=e;for(let e of r.seasons)t.push(...e.episodes);this.flattenedContext.updateState(t)}else{if(!a.objects.ContextTrack.is(e))throw"Expected code to be unreachable!";{let t=[],r=e;t.push(r),this.flattenedContext.updateState(t)}}}));{let e=()=>{let e=this.context.getState(),t=this.currentIndex.getState();if(s.present(e)&&s.present(t)){if(a.objects.ContextAlbum.is(e)){let r=0,s=t,n=e.discs;for(let e=0;e<n.length;e++){let t=n[e].tracks.length;if(!(s>=t))break;r+=1,s-=t}return this.contextPath.updateState([e.album_id,e.discs[r].disc_id,e.discs[r].tracks[s].track_id])}if(a.objects.ContextArtist.is(e)){let r=0,s=0,n=t,a=e.albums;e:for(let e=0;e<a.length;e++){let t=a[e].discs;for(let e=0;e<t.length;e++){let r=t[e].tracks.length;if(!(n>=r))break e;s+=1,n-=r}r+=1,s=0}return this.contextPath.updateState([e.artist_id,e.albums[r].album_id,e.albums[r].discs[s].disc_id,e.albums[r].discs[s].tracks[n].track_id])}if(a.objects.ContextEpisode.is(e))return this.contextPath.updateState([e.episode_id]);if(a.objects.ContextMovie.is(e))return this.contextPath.updateState([e.movie_id]);if(a.objects.ContextPlaylist.is(e)){let r=t;return this.contextPath.updateState([e.playlist_id,e.items[r].track.track_id])}if(a.objects.ContextShow.is(e)){let r=0,s=t,n=e.seasons;for(let e=0;e<n.length;e++){let t=n[e].episodes.length;if(!(s>=t))break;r+=1,s-=t}return this.contextPath.updateState([e.show_id,e.seasons[r].season_id,e.seasons[r].episodes[s].episode_id])}if(a.objects.ContextSeason.is(e)){let r=t;return this.contextPath.updateState([e.season_id,e.episodes[r].episode_id])}if(a.objects.ContextTrack.is(e))return this.contextPath.updateState([e.track_id]);throw"Expected code to be unreachable!"}this.contextPath.updateState(void 0)};this.context.addObserver(e),this.currentIndex.addObserver(e)}this.lastEntry.addObserver((e=>{this.canPlayLast.updateState(s.present(e))})),this.currentEntry.addObserver((e=>{this.canPlayCurrent.updateState(s.present(e))})),this.nextEntry.addObserver((e=>{this.canPlayNext.updateState(s.present(e))})),this.progress.addObserver((e=>{this.estimatedProgress.updateState(e),this.estimatedProgressTimestamp.updateState(Date.now())})),this.playback.addObserver((e=>{let t=this.estimatedProgress.getState(),r=this.estimatedProgressTimestamp.getState(),n=Date.now();e||s.present(t)&&s.present(r)&&this.estimatedProgress.updateState(t+(n-r)/1e3),this.estimatedProgressTimestamp.updateState(n)})),this.estimatedProgress.addObserver((e=>{console.log("Estimated progress to "+(null!=e?e:0))}));{let e=()=>{let e=this.playback.getState(),t=this.isDeviceLocal.getState();this.localPlayback.updateState(t&&e)};this.playback.addObserver(e),this.isDeviceLocal.addObserver(e)}{let e=()=>{let e=this.lastEntry.getState(),t=this.isDeviceLocal.getState();this.lastLocalEntry.updateState(t?e:void 0)};this.lastEntry.addObserver(e),this.isDeviceLocal.addObserver(e)}{let e=()=>{let e=this.currentEntry.getState(),t=this.isDeviceLocal.getState();this.currentLocalEntry.updateState(t?e:void 0)};this.currentEntry.addObserver(e),this.isDeviceLocal.addObserver(e)}{let e=()=>{let e=this.nextEntry.getState(),t=this.isDeviceLocal.getState();this.nextLocalEntry.updateState(t?e:void 0)};this.nextEntry.addObserver(e),this.isDeviceLocal.addObserver(e)}{let e=()=>{let e=this.localDevice.getState(),t=this.device.getState();return s.present(e)&&s.present(t)&&e.id===t.id?this.isDeviceLocal.updateState(!0):this.isDeviceLocal.updateState(!1)};this.localDevice.addObserver(e),this.device.addObserver(e)}{let e=()=>{let e=this.localDevice.getState(),t=this.device.getState();return s.present(e)&&s.present(t)&&e.id!==t.id?this.isDeviceRemote.updateState(!0):this.isDeviceRemote.updateState(!1)};this.localDevice.addObserver(e),this.device.addObserver(e)}{let e=()=>{let e=this.flattenedContext.getState(),t=this.currentIndex.getState();if(s.present(e)&&s.present(t)){let r=t-1;if(r>=0&&r<e.length)return this.lastIndex.updateState(r)}return this.lastIndex.updateState(void 0)};this.flattenedContext.addObserver(e),this.currentIndex.addObserver(e)}{let e=()=>{let e=this.flattenedContext.getState(),t=this.currentIndex.getState();if(s.present(e)&&s.present(t)){let r=t+1;if(r>=0&&r<e.length)return this.nextIndex.updateState(r)}return this.nextIndex.updateState(void 0)};this.flattenedContext.addObserver(e),this.currentIndex.addObserver(e)}{let e=()=>{let e=this.flattenedContext.getState(),t=this.lastIndex.getState();return s.present(e)&&s.present(t)?this.lastEntry.updateState(e[t]):this.lastEntry.updateState(void 0)};this.flattenedContext.addObserver(e),this.lastIndex.addObserver(e)}{let e=()=>{let e=this.flattenedContext.getState(),t=this.currentIndex.getState();return s.present(e)&&s.present(t)&&t>=0&&t+0<e.length?this.currentEntry.updateState(e[t+0]):this.currentEntry.updateState(void 0)};this.flattenedContext.addObserver(e),this.currentIndex.addObserver(e)}{let e=()=>{let e=this.flattenedContext.getState(),t=this.nextIndex.getState();return s.present(e)&&s.present(t)?this.nextEntry.updateState(e[t]):this.nextEntry.updateState(void 0)};this.flattenedContext.addObserver(e),this.nextIndex.addObserver(e)}this.tsc.addEventListener("app","SetLocalDevice",(e=>{this.localDevice.updateState(e.device)})),this.tsc.addEventListener("app","SetDevices",(e=>{this.devices.update(e.devices)})),this.tsc.addEventListener("app","SetContext",(e=>{this.context.updateState(e.context)})),this.tsc.addEventListener("app","SetDevice",(e=>{this.device.updateState(e.device)})),this.tsc.addEventListener("app","SetIndex",(e=>{this.currentIndex.updateState(e.index)})),this.tsc.addEventListener("app","SetPlayback",(e=>{this.playback.updateState(e.playback)})),this.tsc.addEventListener("app","SetProgress",(e=>{this.progress.updateState(e.progress)})),this.tsc.addEventListener("app","SetToken",(e=>{this.token.updateState(e.token)})),this.isOnline.addObserver((e=>{e||(this.context.updateState(void 0),this.currentIndex.updateState(void 0),this.playback.updateState(!1),this.progress.updateState(void 0))})),n.computed(((e,t)=>{e&&this.tsc.send("SetToken",{token:t})}),this.isOnline,this.token)}play(e,t){this.isCurrentEntryVideo.updateState(!1),this.tsc.send("SetContext",{context:e}),this.tsc.send("SetIndex",{index:t}),this.tsc.send("SetPlayback",{playback:!0})}authenticate(e){this.token.updateState(e)}close(){this.tsc.close()}last(){let e=this.lastIndex.getState();s.present(e)?(this.currentIndex.updateState(e),this.tsc.send("SetIndex",{index:e})):this.pause()}next(){let e=this.nextIndex.getState();s.present(e)?(this.currentIndex.updateState(e),this.tsc.send("SetIndex",{index:e})):this.pause()}pause(){this.playback.updateState(!1),this.tsc.send("SetPlayback",{playback:!1})}playAlbum(e,t,r){let n=0;if(s.present(t)){let a=e.discs;if(t<0||t>=a.length)throw`Expected ${t} to be a number between 0 and ${a.length}!`;if(n+=a.slice(0,t).reduce(((e,t)=>e+t.tracks.length),0),s.present(r)){let e=a[t].tracks;if(r<0||r>=e.length)throw`Expected ${r} to be a number between 0 and ${e.length}!`;n+=r}}return this.play(e,n)}playArtist(e,t,r,n){let a=0;if(s.present(t)){let i=e.albums;if(t<0||t>=i.length)throw`Expected ${t} to be a number between 0 and ${i.length}!`;if(a+=i.slice(0,t).reduce(((e,t)=>e+t.discs.reduce(((e,t)=>e+t.tracks.length),0)),0),s.present(r)){let e=i[t].discs;if(r<0||r>=e.length)throw`Expected ${r} to be a number between 0 and ${e.length}!`;if(a+=e.slice(0,r).reduce(((e,t)=>e+t.tracks.length),0),s.present(n)){let t=e[r].tracks;if(n<0||n>=t.length)throw`Expected ${n} to be a number between 0 and ${t.length}!`;a+=n}}}return this.play(e,a)}playDisc(e,t){let r=0;if(s.present(t)){let s=e.tracks;if(t<0||t>=s.length)throw`Expected ${t} to be a number between 0 and ${s.length}!`;r+=t}return this.play(e,r)}playEpisode(e){this.play(e,0)}playMovie(e){this.play(e,0)}playPlaylist(e,t){let r=0;if(s.present(t)){let s=e.items;if(t<0||t>=s.length)throw`Expected ${t} to be a number between 0 and ${s.length}!`;r+=t}return this.play(e,r)}playSeason(e,t){let r=0;if(s.present(t)){let s=e.episodes;if(t<0||t>=s.length)throw`Expected ${t} to be a number between 0 and ${s.length}!`;r+=t}return this.play(e,r)}playShow(e,t,r){let n=0;if(s.present(t)){let a=e.seasons;if(t<0||t>=a.length)throw`Expected ${t} to be a number between 0 and ${a.length}!`;if(n+=a.slice(0,t).reduce(((e,t)=>e+t.episodes.length),0),s.present(r)){let e=a[t].episodes;if(r<0||r>=e.length)throw`Expected ${r} to be a number between 0 and ${e.length}!`;n+=r}}return this.play(e,n)}playTrack(e){this.play(e,0)}reconnect(){this.tsc.reconnect()}resume(){this.canPlayCurrent.getState()&&(this.playback.updateState(!0),this.tsc.send("SetPlayback",{playback:!0}))}seek(e){this.progress.updateState(e),this.tsc.send("SetProgress",{progress:e})}toggle(){this.playback.getState()?this.pause():this.resume()}transfer(e){this.tsc.send("SetDevice",{device:e})}}},14:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objects=t.messages=void 0,t.messages=r(139),t.objects=r(234)},139:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Autoguard=t.SetToken=t.SetProgress=t.SetPlayback=t.SetLocalDevice=t.SetIndex=t.SetDevices=t.SetDevice=t.SetContext=void 0;const s=r(234),n=r(234),a=r(175);t.SetContext=a.guards.Object.of({context:a.guards.Union.of(a.guards.Undefined,a.guards.Reference.of((()=>s.Context)))}),t.SetDevice=a.guards.Object.of({device:a.guards.Union.of(a.guards.Undefined,a.guards.Reference.of((()=>n.Device)))}),t.SetDevices=a.guards.Object.of({devices:a.guards.Array.of(a.guards.Reference.of((()=>n.Device)))}),t.SetIndex=a.guards.Object.of({index:a.guards.Union.of(a.guards.Undefined,a.guards.Number)}),t.SetLocalDevice=a.guards.Object.of({device:a.guards.Reference.of((()=>n.Device))}),t.SetPlayback=a.guards.Object.of({playback:a.guards.Boolean}),t.SetProgress=a.guards.Object.of({progress:a.guards.Union.of(a.guards.Undefined,a.guards.Number)}),t.SetToken=a.guards.Object.of({token:a.guards.Union.of(a.guards.Undefined,a.guards.String)}),t.Autoguard={SetContext:t.SetContext,SetDevice:t.SetDevice,SetDevices:t.SetDevices,SetIndex:t.SetIndex,SetLocalDevice:t.SetLocalDevice,SetPlayback:t.SetPlayback,SetProgress:t.SetProgress,SetToken:t.SetToken}},234:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Autoguard=t.Session=t.Device=t.ContextItem=t.Context=t.ContextEpisode=t.ContextSeason=t.ContextShow=t.ContextMovie=t.ContextPlaylist=t.ContextTrack=t.ContextDisc=t.ContextArtist=t.ContextAlbum=void 0;const s=r(447),n=r(447),a=r(447),i=r(447),o=r(447),d=r(447),l=r(447),u=r(447),c=r(447),p=r(175);t.ContextAlbum=p.guards.Reference.of((()=>s.Album)),t.ContextArtist=p.guards.Reference.of((()=>n.Artist)),t.ContextDisc=p.guards.Reference.of((()=>a.Disc)),t.ContextTrack=p.guards.Reference.of((()=>c.Track)),t.ContextPlaylist=p.guards.Reference.of((()=>d.Playlist)),t.ContextMovie=p.guards.Reference.of((()=>o.Movie)),t.ContextShow=p.guards.Reference.of((()=>u.Show)),t.ContextSeason=p.guards.Reference.of((()=>l.Season)),t.ContextEpisode=p.guards.Reference.of((()=>i.Episode)),t.Context=p.guards.Union.of(p.guards.Reference.of((()=>t.ContextAlbum)),p.guards.Reference.of((()=>t.ContextArtist)),p.guards.Reference.of((()=>t.ContextDisc)),p.guards.Reference.of((()=>t.ContextTrack)),p.guards.Reference.of((()=>t.ContextPlaylist)),p.guards.Reference.of((()=>t.ContextMovie)),p.guards.Reference.of((()=>t.ContextShow)),p.guards.Reference.of((()=>t.ContextSeason)),p.guards.Reference.of((()=>t.ContextEpisode))),t.ContextItem=p.guards.Union.of(p.guards.Reference.of((()=>t.ContextTrack)),p.guards.Reference.of((()=>t.ContextMovie)),p.guards.Reference.of((()=>t.ContextEpisode))),t.Device=p.guards.Object.of({id:p.guards.String,protocol:p.guards.String,name:p.guards.String,type:p.guards.String}),t.Session=p.guards.Object.of({context:p.guards.Union.of(p.guards.Undefined,p.guards.Reference.of((()=>t.Context))),device:p.guards.Union.of(p.guards.Undefined,p.guards.Reference.of((()=>t.Device))),index:p.guards.Union.of(p.guards.Undefined,p.guards.Number),playback:p.guards.Boolean,progress:p.guards.Union.of(p.guards.Undefined,p.guards.Number)}),t.Autoguard={ContextAlbum:t.ContextAlbum,ContextArtist:t.ContextArtist,ContextDisc:t.ContextDisc,ContextTrack:t.ContextTrack,ContextPlaylist:t.ContextPlaylist,ContextMovie:t.ContextMovie,ContextShow:t.ContextShow,ContextSeason:t.ContextSeason,ContextEpisode:t.ContextEpisode,Context:t.Context,ContextItem:t.ContextItem,Device:t.Device,Session:t.Session}},756:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlaylistsClient=void 0;const s=r(440),n=r(298),a=r(696),i=r(578);t.PlaylistsClient=class{constructor(e,t=(e=>new WebSocket(e))){this.token=new s.ObservableClass(void 0),this.online=new s.ObservableClass(!1),this.playlists=new s.ArrayObservable(new Array),this.tsc=new i.TypeSocketClient(e,t,a.Autoguard),this.tsc.addEventListener("sys","connect",(()=>{this.online.updateState(!0)})),this.tsc.addEventListener("sys","disconnect",(()=>{this.online.updateState(!1)})),s.computed(((e,t)=>{e&&this.tsc.send("SetToken",{token:t})}),this.online,this.token),this.tsc.addEventListener("app","CreatePlaylist",(e=>{for(let[t,r]of this.playlists.getState().entries())r.getState().playlist_id===e.playlist.playlist_id&&this.playlists.splice(t-0);let t=Object.assign(Object.assign({},e.playlist),{items:new Array});this.playlists.append(new s.ObservableClass(t))})),this.tsc.addEventListener("app","DeletePlaylist",(e=>{for(let[t,r]of this.playlists.getState().entries())r.getState().playlist_id===e.playlist.playlist_id&&this.playlists.splice(t-0)})),this.tsc.addEventListener("app","UpdatePlaylist",(e=>{for(let[t,r]of this.playlists.getState().entries()){let t=r.getState();t.playlist_id===e.playlist.playlist_id&&r.updateState(Object.assign(Object.assign({},t),e.playlist))}})),this.tsc.addEventListener("app","CreatePlaylistItem",(e=>{for(let[t,r]of this.playlists.getState().entries()){let t=r.getState();if(t.playlist_id===e.playlist_item.playlist.playlist_id){let s=t.items.filter((t=>t.playlist_item_id!==e.playlist_item.playlist_item_id)),a=t.items.length-s.length;s.push(e.playlist_item);let i=1;s=s.map((t=>Object.assign(Object.assign({},t),{number:t.number+(t.number>e.playlist_item.number?i-a:0)}))).sort(n.NumericSort.increasing((e=>e.number))),t=Object.assign(Object.assign({},t),{items:s}),r.updateState(t)}}})),this.tsc.addEventListener("app","DeletePlaylistItem",(e=>{for(let[t,r]of this.playlists.getState().entries()){let t=r.getState();if(t.playlist_id===e.playlist_item.playlist.playlist_id){let s=t.items.filter((t=>t.playlist_item_id!==e.playlist_item.playlist_item_id)),a=t.items.length-s.length,i=0;s=s.map((t=>Object.assign(Object.assign({},t),{number:t.number+(t.number>e.playlist_item.number?i-a:0)}))).sort(n.NumericSort.increasing((e=>e.number))),t=Object.assign(Object.assign({},t),{items:s}),r.updateState(t)}}})),this.tsc.addEventListener("app","UpdatePlaylistItem",(e=>{for(let[t,r]of this.playlists.getState().entries()){let t=r.getState();if(t.playlist_id===e.playlist_item.playlist.playlist_id){let s=t.items.findIndex((t=>t.playlist_item_id===e.playlist_item.playlist_item_id));if(s>=0){let n=e.playlist_item.number-1;if(n>s){for(let e=s+1;e<n;e++)t.items[e].number-=1;t.items.splice(n,0,...t.items.splice(s,1))}else if(n<s){for(let e=n;e<s;e++)t.items[e].number+=1;t.items.splice(n,0,...t.items.splice(s,1))}t.items[n]=Object.assign(Object.assign({},t.items[n]),e.playlist_item),r.updateState(Object.assign({},t))}}}}))}authenticate(e){this.token.updateState(e)}isOnline(){return this.online.getState()}getPermissions(e){return this.tsc.request("PermissionsRequest","PermissionsResponse",e)}createPlaylist(e){return this.tsc.request("CreatePlaylistRequest","CreatePlaylistResponse",e)}deletePlaylist(e){return this.tsc.request("DeletePlaylistRequest","DeletePlaylistResponse",e)}updatePlaylist(e){return this.tsc.request("UpdatePlaylistRequest","UpdatePlaylistResponse",e)}createPlaylistItem(e){return this.tsc.request("CreatePlaylistItemRequest","CreatePlaylistItemResponse",e)}deletePlaylistItem(e){return this.tsc.request("DeletePlaylistItemRequest","DeletePlaylistItemResponse",e)}updatePlaylistItem(e){return this.tsc.request("UpdatePlaylistItemRequest","UpdatePlaylistItemResponse",e)}close(){this.tsc.close()}reconnect(){this.tsc.reconnect()}}},696:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Autoguard=t.UpdatePlaylistItem=t.UpdatePlaylistItemResponse=t.UpdatePlaylistItemRequest=t.DeletePlaylistItem=t.DeletePlaylistItemResponse=t.DeletePlaylistItemRequest=t.CreatePlaylistItem=t.CreatePlaylistItemResponse=t.CreatePlaylistItemRequest=t.UpdatePlaylist=t.UpdatePlaylistResponse=t.UpdatePlaylistRequest=t.DeletePlaylist=t.DeletePlaylistResponse=t.DeletePlaylistRequest=t.CreatePlaylist=t.CreatePlaylistResponse=t.CreatePlaylistRequest=t.PermissionsResponse=t.PermissionsRequest=t.SetToken=void 0;const s=r(447),n=r(447),a=r(175);t.SetToken=a.guards.Object.of({token:a.guards.Union.of(a.guards.Undefined,a.guards.String)}),t.PermissionsRequest=a.guards.Object.of({playlist:a.guards.Object.of({playlist_id:a.guards.String})}),t.PermissionsResponse=a.guards.Object.of({permissions:a.guards.Union.of(a.guards.StringLiteral.of("read"),a.guards.StringLiteral.of("write"))}),t.CreatePlaylistRequest=a.guards.Object.of({playlist:a.guards.Object.of({title:a.guards.String,description:a.guards.String})}),t.CreatePlaylistResponse=a.guards.Object.of({errors:a.guards.Array.of(a.guards.String),playlist_id:a.guards.String}),t.CreatePlaylist=a.guards.Object.of({playlist:a.guards.Reference.of((()=>s.PlaylistBase))}),t.DeletePlaylistRequest=a.guards.Object.of({playlist:a.guards.Object.of({playlist_id:a.guards.String})}),t.DeletePlaylistResponse=a.guards.Object.of({errors:a.guards.Array.of(a.guards.String)}),t.DeletePlaylist=a.guards.Object.of({playlist:a.guards.Reference.of((()=>s.PlaylistBase))}),t.UpdatePlaylistRequest=a.guards.Object.of({playlist:a.guards.Object.of({playlist_id:a.guards.String,title:a.guards.String,description:a.guards.String})}),t.UpdatePlaylistResponse=a.guards.Object.of({errors:a.guards.Array.of(a.guards.String)}),t.UpdatePlaylist=a.guards.Object.of({playlist:a.guards.Reference.of((()=>s.PlaylistBase))}),t.CreatePlaylistItemRequest=a.guards.Object.of({playlist_item:a.guards.Object.of({playlist_id:a.guards.String,track_id:a.guards.String})}),t.CreatePlaylistItemResponse=a.guards.Object.of({errors:a.guards.Array.of(a.guards.String),playlist_item_id:a.guards.String}),t.CreatePlaylistItem=a.guards.Object.of({playlist_item:a.guards.Reference.of((()=>n.PlaylistItemBase))}),t.DeletePlaylistItemRequest=a.guards.Object.of({playlist_item:a.guards.Object.of({playlist_item_id:a.guards.String})}),t.DeletePlaylistItemResponse=a.guards.Object.of({errors:a.guards.Array.of(a.guards.String)}),t.DeletePlaylistItem=a.guards.Object.of({playlist_item:a.guards.Reference.of((()=>n.PlaylistItemBase))}),t.UpdatePlaylistItemRequest=a.guards.Object.of({playlist_item:a.guards.Object.of({playlist_item_id:a.guards.String,number:a.guards.Number})}),t.UpdatePlaylistItemResponse=a.guards.Object.of({errors:a.guards.Array.of(a.guards.String)}),t.UpdatePlaylistItem=a.guards.Object.of({playlist_item:a.guards.Reference.of((()=>n.PlaylistItemBase))}),t.Autoguard={SetToken:t.SetToken,PermissionsRequest:t.PermissionsRequest,PermissionsResponse:t.PermissionsResponse,CreatePlaylistRequest:t.CreatePlaylistRequest,CreatePlaylistResponse:t.CreatePlaylistResponse,CreatePlaylist:t.CreatePlaylist,DeletePlaylistRequest:t.DeletePlaylistRequest,DeletePlaylistResponse:t.DeletePlaylistResponse,DeletePlaylist:t.DeletePlaylist,UpdatePlaylistRequest:t.UpdatePlaylistRequest,UpdatePlaylistResponse:t.UpdatePlaylistResponse,UpdatePlaylist:t.UpdatePlaylist,CreatePlaylistItemRequest:t.CreatePlaylistItemRequest,CreatePlaylistItemResponse:t.CreatePlaylistItemResponse,CreatePlaylistItem:t.CreatePlaylistItem,DeletePlaylistItemRequest:t.DeletePlaylistItemRequest,DeletePlaylistItemResponse:t.DeletePlaylistItemResponse,DeletePlaylistItem:t.DeletePlaylistItem,UpdatePlaylistItemRequest:t.UpdatePlaylistItemRequest,UpdatePlaylistItemResponse:t.UpdatePlaylistItemResponse,UpdatePlaylistItem:t.UpdatePlaylistItem}},578:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TypeSocketClient=void 0;const s=r(978),n=r(611),a=r(185),i=r(565);t.TypeSocketClient=class{constructor(e,t,r){this.nextConnectionAttemptDelayFactor=2+Math.random(),this.nextConnectionAttemptDelay=2e3,this.router=new s.routing.NamespacedMessageRouter,this.serializer=new a.Serializer(r),this.url=e,this.factory=t,this.socket=this.makeSocket(),this.requests=new Map}makeId(){let e="";for(let t=0;t<32;t++)e+=Math.floor(16*Math.random()).toString(16);return e}makeSocket(){let e=this.factory(this.url);return e.addEventListener("close",this.onClose.bind(this)),e.addEventListener("error",this.onError.bind(this)),e.addEventListener("message",this.onMessage.bind(this)),e.addEventListener("open",this.onOpen.bind(this)),e}onClose(e){this.router.route("sys","disconnect",{})}onError(e){setTimeout((()=>{this.socket=this.makeSocket()}),this.nextConnectionAttemptDelay),this.nextConnectionAttemptDelay=Math.round(this.nextConnectionAttemptDelay*this.nextConnectionAttemptDelayFactor)}onMessage(e){try{this.serializer.deserialize(e.data,((e,t,r)=>{if(this.router.route("sys","message",{type:e,data:t}),i.present(r)){let s=this.requests.get(r);i.present(s)&&(this.requests.delete(r),s(e,t))}this.router.route("app",e,t)}))}catch(e){this.socket.close()}}onOpen(e){this.nextConnectionAttemptDelay=2e3,this.router.route("sys","connect",{})}queue(e){if(this.socket.readyState===n.ReadyState.OPEN)this.socket.send(e);else{let t=()=>{this.socket.removeEventListener("open",t),this.socket.send(e)};this.socket.addEventListener("open",t)}}addEventListener(e,t,r){this.router.addObserver(e,t,r)}close(){this.socket.close()}reconnect(){this.socket.readyState===n.ReadyState.CLOSED&&(this.socket=this.makeSocket())}removeEventListener(e,t,r){this.router.addObserver(e,t,r)}request(e,t,r){return new Promise(((s,n)=>{let a=this.makeId(),i=this.serializer.serialize(e,r,a);this.requests.set(a,((e,r)=>{e!==t?n(`Received response with type "${e}" when expecting "${t}"!`):s(r)})),this.queue(i)}))}send(e,t){let r=this.serializer.serialize(e,t);this.queue(r)}}},628:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Autoguard=t.Envelope=void 0;const s=r(175);t.Envelope=s.guards.Object.of({type:s.guards.String,data:s.guards.Any,id:s.guards.Union.of(s.guards.Undefined,s.guards.String)}),t.Autoguard={Envelope:t.Envelope}},185:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Serializer=void 0;const s=r(628),n=r(565);t.Serializer=class{constructor(e){this.guards=e}deserialize(e,t){let r=s.Envelope.as(JSON.parse(e)),a=r.id,i=r.type,o=r.data,d=this.guards[i];if(n.absent(d))throw`Unknown message type "${i}"!`;t(i,d.as(o),a)}serialize(e,t,r){return JSON.stringify({type:e,data:t,id:r})}}},410:function(e,t,r){var s=this&&this.__awaiter||function(e,t,r,s){return new(r||(r=Promise))((function(n,a){function i(e){try{d(s.next(e))}catch(e){a(e)}}function o(e){try{d(s.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,o)}d((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.CarouselFactory=void 0;const n=r(440),a=r(78);t.CarouselFactory=class{constructor(e){this.iconFactory=e}make(...e){let t=new n.ObservableClass(0),r=n.computed((e=>e>0),t),i=n.computed((t=>t<e.length-1),t),o=a.element("div.carousel__content");return o.ref().then((r=>s(this,void 0,void 0,(function*(){let n=new IntersectionObserver((r=>s(this,void 0,void 0,(function*(){for(let s of r)for(let[r,n]of e.entries()){let e=yield n.ref();if(s.target===e&&s.isIntersecting)return void t.updateState(r)}}))),{root:r});for(let t of e){let e=yield t.ref();n.observe(e)}})))),a.element("div.carousel").add(o.add(...e)).add(a.element("div.carousel__controls").add(a.element("div.icon-button").bind("data-enabled",r.addObserver((e=>""+e))).add(this.iconFactory.makeChevron().set("style","transform: scale(-1.0, 1.0);")).on("click",(()=>s(this,void 0,void 0,(function*(){if(r.getState()){let r=yield o.ref(),s=e[t.getState()-1],n=yield s.ref();r.scrollTo({left:n.offsetLeft-r.offsetLeft,behavior:"smooth"})}}))))).add(a.element("div.icon-button").bind("data-enabled",i.addObserver((e=>""+e))).add(this.iconFactory.makeChevron()).on("click",(()=>s(this,void 0,void 0,(function*(){if(i.getState()){let r=yield o.ref(),s=e[t.getState()+1],n=yield s.ref();r.scrollTo({left:n.offsetLeft-r.offsetLeft,behavior:"smooth"})}}))))))}static makeStyle(){return a.element("style").add(a.text("\n\t.carousel {\n\t\tdisplay: grid;\n\t\tgap: 24px;\n\t}\n\n\t.carousel__content {\n\t\talign-items: start;\n\t\tdisplay: grid;\n\t\tgap: 24px;\n\t\tgrid-auto-flow: column;\n\t\tgrid-auto-columns: 100%;\n\t\toverflow: scroll hidden;\n\t\tscroll-behavior: smooth;\n\t\tscroll-snap-type: x mandatory;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\t.carousel__content {\n\t\t\toverflow: hidden;\n\t\t}\n\t}\n\n\t.carousel__content > * {\n\t\tscroll-snap-align: start;\n\t}\n\n\t.carousel__controls {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-flow: column;\n\t\tjustify-content: center;\n\t}\n"))}}},458:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityCardFactory=void 0;const s=r(447),n=r(78),a=r(352),i=r(128),o=r(565),d=`\n\t.entity-card {\n\t\talign-items: start;\n\t\tdisplay: grid;\n\t\tgap: 24px;\n\t\tgrid-auto-rows: min-content;\n\t\tgrid-template-columns: repeat(auto-fit, minmax(240px, auto));\n\t}\n\n\t.entity-card__artwork {\n\t\tposition: relative;\n\t}\n\n\t.entity-card__playback {\n\t\tposition: absolute;\n\t\t\tbottom: 16px;\n\t\t\tright: 16px;\n\t}\n\n\t.entity-card__content {\n\n\t}\n\n\t.entity-card__pusher {\n\t\twidth: 100vw;\n\t}\n\n\t.entity-card__metadata {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t}\n\n\t.entity-card__titles {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\t.entity-card__title {\n\t\tcolor: ${a.TEXT_0};\n\t\tfont-size: 20px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.entity-card__subtitle {\n\t\tcolor: ${a.TEXT_1};\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.entity-card__tags {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-columns: minmax(auto, max-content);\n\t\tgrid-auto-flow: column;\n\t}\n\n\t.entity-card__tag {\n\t\tbackground-color: ${a.BACKGROUND_3};\n\t\tborder-radius: 2px;\n\t\tcolor: ${a.TEXT_1};\n\t\tfont-size: 12px;\n\t\tpadding: 4px 8px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.entity-card__tag--accent {\n\t\tbackground-color: ${a.BACKGROUND_ACCENT};\n\t\tcolor: ${a.TEXT_ACCENT};\n\t}\n\n\t.entity-card__description {\n\t\tcolor: ${a.TEXT_1};\n\t\tfont-size: 16px;\n\t\tline-height: 1.25;\n\t\tword-break: break-word;\n\t}\n\n\t.entity-card__description--compact {\n\t\tdisplay: -webkit-box;\n\t\t\t-webkit-box-orient: vertical;\n\t\t\t-webkit-line-clamp: 3;\n\t\tmax-height: 60px;\n\t\toverflow: hidden;\n\t}\n`;function l(e,t){return 9*e>16*t?e>=1280:t>=720}t.EntityCardFactory=class{constructor(e,t,r,s){this.entityTitleFactory=e,this.entityLinkFactory=t,this.ImageBox=r,this.PlaybackButton=s}make(e,t,r,s,a,i,d={}){var l;return e.add(n.element("div.entity-card").add(n.element("div.entity-card__artwork").add(null!==(l=d.image)&&void 0!==l?l:t).add(n.element("div.entity-card__playback").add(d.playbackButton))).add(n.element("div.entity-card__content").add(n.element("div.entity-card__pusher")).add(n.element("div.entity-card__metadata").add(n.element("div.entity-card__titles").add(0===r.length?void 0:n.element("div.entity-card__title").add(...n.joinarray(r))).add(0===s.length?void 0:n.element("div.entity-card__subtitle").add(...n.joinarray(s)))).add(0===a.length?void 0:n.element("div.entity-card__tags").add(...a)).add(o.absent(i)?void 0:n.element(!1===d.compactDescription?"div.entity-card__description":"div.entity-card__description.entity-card__description--compact").add(n.text(i))))))}forEntity(e,t={}){if(s.Album.is(e))return this.forAlbum(e,t);if(s.Artist.is(e))return this.forArtist(e,t);if(s.Cue.is(e))return this.forCue(e,t);if(s.Disc.is(e))return this.forDisc(e,t);if(s.Episode.is(e))return this.forEpisode(e,t);if(s.Genre.is(e))return this.forGenre(e,t);if(s.Person.is(e))return this.forPerson(e,t);if(s.Playlist.is(e))return this.forPlaylist(e,t);if(s.Movie.is(e))return this.forMovie(e,t);if(s.Season.is(e))return this.forSeason(e,t);if(s.Show.is(e))return this.forShow(e,t);if(s.Track.is(e))return this.forTrack(e,t);if(s.User.is(e))return this.forUser(e,t);if(s.Year.is(e))return this.forYear(e,t);throw"Expected code to be unreachable!"}forAlbum(e,t={}){var r;t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forAlbum(e);let s=0;for(let t of e.discs)for(let e of t.tracks)s+=e.media.duration_ms;let a=this.entityLinkFactory.forAlbum(e),d=this.ImageBox.forSquare(e.artwork.map((e=>`/files/${e.file_id}/`)).shift()),l=[this.entityTitleFactory.forAlbum(e)],u=e.artists.map((e=>this.entityTitleFactory.forArtist(e))),c=["Album",o.present(e.year)?""+e.year:void 0,i.formatDuration(s)].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(a,d,l,u,c,void 0,t)}forArtist(e,t={}){var r,s;t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forArtist(e);let a=0;for(let t of e.albums)for(let e of t.discs)for(let t of e.tracks)a+=t.media.duration_ms;let d=this.entityLinkFactory.forArtist(e),l=this.ImageBox.forSquare(null===(s=e.albums[0])||void 0===s?void 0:s.artwork.map((e=>`/files/${e.file_id}/`)).shift()),u=[this.entityTitleFactory.forArtist(e)],c=new Array,p=["Artist",i.formatDuration(a)].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(d,l,u,c,p,void 0,t)}forCue(e,t={}){var r;if(t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forCue(e),t.image=this.ImageBox.forVideo(`/media/gifs/${e.cue_id}/`),s.Episode.is(e.media))return this.forEpisode(e.media,t);if(s.Movie.is(e.media))return this.forMovie(e.media,t);throw"Expected code to be unreachable!"}forDisc(e,t={}){var r;t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forDisc(e);let s=0;for(let t of e.tracks)s+=t.media.duration_ms;let a=this.entityLinkFactory.forDisc(e),d=this.ImageBox.forSquare(e.album.artwork.map((e=>`/files/${e.file_id}/`)).shift()),l=[this.entityTitleFactory.forDisc(e)],u=[this.entityTitleFactory.forAlbum(e.album)],c=["Disc",i.formatDuration(s)].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(a,d,l,u,c,void 0,t)}forEpisode(e,t={}){var r;t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forEpisode(e);let s=0;s+=e.media.duration_ms;let a=this.entityLinkFactory.forEpisode(e),d=this.ImageBox.forVideo(`/media/stills/${e.media.file_id}/`),u=[this.entityTitleFactory.forEpisode(e)],c=[this.entityTitleFactory.forShow(e.season.show),this.entityTitleFactory.forSeason(e.season)],p=["Episode",o.present(e.year)?""+e.year:void 0,i.formatDuration(s)].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return l(e.media.width,e.media.height)&&p.unshift(n.element("div.entity-card__tag.entity-card__tag--accent").add(n.text("HD"))),o.present(e.last_stream_date)&&p.unshift(n.element("div.entity-card__tag.entity-card__tag--accent").add(n.text("✓"))),this.make(a,d,u,c,p,e.summary,t)}forGenre(e,t={}){let r=this.entityLinkFactory.forGenre(e),s=this.ImageBox.forSquare(),a=[this.entityTitleFactory.forGenre(e)],i=["Genre"].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(r,s,a,[],i,void 0,t)}forMovie(e,t={}){var r;t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forMovie(e);let s=0;s+=e.media.duration_ms;let a=this.entityLinkFactory.forMovie(e),d=this.ImageBox.forPoster(e.artwork.map((e=>`/files/${e.file_id}/`)).shift()),u=[this.entityTitleFactory.forMovie(e)],c=e.genres.map((e=>this.entityTitleFactory.forGenre(e))),p=["Movie",o.present(e.year)?""+e.year:void 0,i.formatDuration(s)].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return l(e.media.width,e.media.height)&&p.unshift(n.element("div.entity-card__tag.entity-card__tag--accent").add(n.text("HD"))),o.present(e.last_stream_date)&&p.unshift(n.element("div.entity-card__tag.entity-card__tag--accent").add(n.text("✓"))),this.make(a,d,u,c,p,e.summary,t)}forPerson(e,t={}){let r=this.entityLinkFactory.forPerson(e),s=this.ImageBox.forSquare(),a=[this.entityTitleFactory.forPerson(e)],i=["Person"].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(r,s,a,[],i,void 0,t)}forPlaylist(e,t={}){var r,s;t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forPlaylist(e);let a=0;for(let t of e.items)a+=t.track.media.duration_ms;let d=this.entityLinkFactory.forPlaylist(e),l=this.ImageBox.forSquare(null===(s=e.items[0])||void 0===s?void 0:s.track.disc.album.artwork.map((e=>`/files/${e.file_id}/`)).shift()),u=[this.entityTitleFactory.forPlaylist(e)],c=[this.entityTitleFactory.forUser(e.user)],p=["Playlist",i.formatDuration(a)].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(d,l,u,c,p,e.description,t)}forSeason(e,t={}){var r;t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forSeason(e);let s=0;for(let t of e.episodes)s+=t.media.duration_ms;let a=this.entityLinkFactory.forSeason(e),d=this.ImageBox.forPoster(e.show.artwork.map((e=>`/files/${e.file_id}/`)).shift()),l=[this.entityTitleFactory.forSeason(e)],u=[this.entityTitleFactory.forShow(e.show)],c=["Season",i.formatDuration(s)].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(a,d,l,u,c,void 0,t)}forShow(e,t={}){var r;t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forShow(e);let s=0;for(let t of e.seasons)for(let e of t.episodes)s+=e.media.duration_ms;let a=this.entityLinkFactory.forShow(e),d=this.ImageBox.forPoster(e.artwork.map((e=>`/files/${e.file_id}/`)).shift()),l=[this.entityTitleFactory.forShow(e)],u=e.genres.map((e=>this.entityTitleFactory.forGenre(e))),c=["Show",i.formatDuration(s)].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(a,d,l,u,c,e.summary,t)}forTrack(e,t={}){var r;t.playbackButton=null!==(r=t.playbackButton)&&void 0!==r?r:this.PlaybackButton.forTrack(e);let s=0;s+=e.media.duration_ms;let a=this.entityLinkFactory.forTrack(e),d=this.ImageBox.forSquare(e.disc.album.artwork.map((e=>`/files/${e.file_id}/`)).shift()),l=[this.entityTitleFactory.forTrack(e)],u=[...e.artists.map((e=>this.entityTitleFactory.forArtist(e))),this.entityTitleFactory.forAlbum(e.disc.album)],c=["Track",i.formatDuration(s)].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(a,d,l,u,c,void 0,t)}forUser(e,t={}){let r=this.entityLinkFactory.forUser(e),s=this.ImageBox.forSquare(),a=[this.entityTitleFactory.forUser(e)],i=[n.element("span").add(n.text(e.username))],d=["User"].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(r,s,a,i,d,void 0,t)}forYear(e,t={}){let r=this.entityLinkFactory.forYear(e),s=this.ImageBox.forSquare(),a=[this.entityTitleFactory.forYear(e)],i=["Year"].filter(o.present).map((e=>n.element("div.entity-card__tag").add(n.text(e))));return this.make(r,s,a,[],i,void 0,t)}static makeStyle(){return n.element("style").add(n.text(d))}}},786:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityLinkFactory=void 0;const s=r(447),n=r(78);t.EntityLinkFactory=class{constructor(e,t){this.navigator=e,this.contextMenuEntity=t}make(e,t){let r,s=()=>{this.contextMenuEntity.updateState(void 0),this.contextMenuEntity.updateState(t)};return n.element("a").set("href",e).on("click",(()=>{this.navigator(e)})).on("contextmenu",s).on("touchstart",(()=>{r=window.setTimeout((()=>{window.clearTimeout(r),r=void 0,s()}),500)}),!1).on("touchcancel",(()=>{window.clearTimeout(r),r=void 0}),!1).on("touchmove",(()=>{window.clearTimeout(r),r=void 0}),!1).on("touchend",(()=>{window.clearTimeout(r),r=void 0}),!1)}forAlbum(e){return this.make(`audio/albums/${e.album_id}/`)}forAlbums(){return this.make("audio/albums/")}forArtist(e){return this.make(`audio/artists/${e.artist_id}/`)}forArtists(){return this.make("audio/artists/")}forCue(e){return this.make(`video/cues/${e.cue_id}/`)}forDisc(e){return this.make(`audio/discs/${e.disc_id}/`)}forDiscs(){return this.make("audio/discs/")}forEpisode(e){return this.make(`video/episodes/${e.episode_id}/`)}forEpisodes(){return this.make("video/episodes/")}forGenre(e){return this.make(`video/genres/${e.genre_id}/`)}forGenres(){return this.make("video/genres/")}forMovie(e){return this.make(`video/movies/${e.movie_id}/`)}forMovies(){return this.make("video/movies/")}forPerson(e){return this.make(`persons/${e.person_id}/`)}forPersons(){return this.make("persons/")}forPlaylist(e){return this.make(`audio/playlists/${e.playlist_id}/`)}forPlaylists(){return this.make("audio/playlists/")}forSeason(e){return this.make(`video/seasons/${e.season_id}/`)}forSeasons(){return this.make("video/seasons/")}forShow(e){return this.make(`video/shows/${e.show_id}/`)}forShows(){return this.make("video/shows/")}forTrack(e){return this.make(`audio/tracks/${e.track_id}/`,e)}forTracks(){return this.make("audio/tracks/")}forUser(e){return this.make(`users/${e.user_id}/`)}forUsers(){return this.make("users/")}forYear(e){return this.make(`years/${e.year_id}/`)}forYears(){return this.make("years/")}forEntity(e){if(s.AlbumBase.is(e))return this.forAlbum(e);if(s.ArtistBase.is(e))return this.forArtist(e);if(s.CueBase.is(e))return this.forCue(e);if(s.DiscBase.is(e))return this.forDisc(e);if(s.EpisodeBase.is(e))return this.forEpisode(e);if(s.GenreBase.is(e))return this.forGenre(e);if(s.PersonBase.is(e))return this.forPerson(e);if(s.PlaylistBase.is(e))return this.forPlaylist(e);if(s.MovieBase.is(e))return this.forMovie(e);if(s.SeasonBase.is(e))return this.forSeason(e);if(s.ShowBase.is(e))return this.forShow(e);if(s.TrackBase.is(e))return this.forTrack(e);if(s.UserBase.is(e))return this.forUser(e);if(s.YearBase.is(e))return this.forYear(e);throw"Expected code to be unreachable!"}static makeStyle(){return n.element("style").add(n.text(""))}}},748:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityNavLinkFactory=void 0;const s=r(565),n=r(352),a=r(78),i=`\n\t.entity-nav-link {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-template-columns: max-content max-content;\n\t\tjustify-content: center;\n\t}\n\n\t.entity-nav-link__last,\n\t.entity-nav-link__next {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tjustify-items: center;\n\t}\n\n\t.entity-nav-link__title {\n\t\tcolor: ${n.TEXT_1};\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n`;t.EntityNavLinkFactory=class{constructor(e,t){this.iconFactory=e,this.entityLinkFactory=t}make(e,t,r){let n=s.absent(t)?a.element("span"):this.entityLinkFactory.forEntity(t),i=s.absent(r)?a.element("span"):this.entityLinkFactory.forEntity(r);return a.element("div.entity-nav-link").add(n.add(a.element("div.entity-nav-link__last").add(a.element("div.icon-button").set("data-enabled",""+s.present(t)).add(this.iconFactory.makeChevron().set("style","transform: scale(-1.0, 1.0);"))).add(a.element("div.entity-nav-link__title").add(a.text("Last "+e))))).add(i.add(a.element("div.entity-nav-link__next").add(a.element("div.icon-button").set("data-enabled",""+s.present(r)).add(this.iconFactory.makeChevron().set("style","transform: scale(1.0, 1.0);"))).add(a.element("div.entity-nav-link__title").add(a.text("Next "+e)))))}forDisc(e,t){return this.make("disc",e,t)}forEpisode(e,t){return this.make("episode",e,t)}forSeason(e,t){return this.make("season",e,t)}forTrack(e,t){return this.make("track",e,t)}static makeStyle(){return a.element("style").add(a.text(i))}}},387:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityRowFactory=void 0;const s=r(447),n=r(78),a=r(352),i=`\n\t.entity-row {\n\t\talign-items: center;\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-template-columns: 60px 1fr;\n\t}\n\n\t.entity-row__artwork {\n\t\tposition: relative;\n\t}\n\n\t.entity-row__playback {\n\t\tposition: absolute;\n\t\t\ttop: 50%; left: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t}\n\n\t.entity-row__content {\n\n\t}\n\n\t.entity-row__metadata {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t}\n\n\t.entity-row__titles {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\t.entity-row__title {\n\t\tcolor: ${a.TEXT_0};\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.entity-row__subtitle {\n\t\tcolor: ${a.TEXT_1};\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n`;t.EntityRowFactory=class{constructor(e,t,r,s){this.entityTitleFactory=e,this.entityLinkFactory=t,this.ImageBox=r,this.PlaybackButton=s}make(e,t,r,s,a){return e.add(n.element("div.entity-row").add(n.element("div.entity-row__artwork").add(t).add(n.element("div.entity-row__playback").add(r))).add(n.element("div.entity-row__content").add(n.element("div.entity-row__metadata").add(n.element("div.entity-row__titles").add(0===s.length?void 0:n.element("div.entity-row__title").add(...n.joinarray(s))).add(0===a.length?void 0:n.element("div.entity-row__subtitle").add(...n.joinarray(a)))))))}forEntity(e){if(s.Album.is(e))return this.forAlbum(e);if(s.Artist.is(e))return this.forArtist(e);if(s.Cue.is(e))return this.forCue(e);if(s.Disc.is(e))return this.forDisc(e);if(s.Episode.is(e))return this.forEpisode(e);if(s.Genre.is(e))return this.forGenre(e);if(s.Person.is(e))return this.forPerson(e);if(s.Playlist.is(e))return this.forPlaylist(e);if(s.Movie.is(e))return this.forMovie(e);if(s.Season.is(e))return this.forSeason(e);if(s.Show.is(e))return this.forShow(e);if(s.Track.is(e))return this.forTrack(e);if(s.User.is(e))return this.forUser(e);if(s.Year.is(e))return this.forYear(e);throw"Expected code to be unreachable!"}forAlbum(e,t=this.PlaybackButton.forAlbum(e)){let r=this.entityLinkFactory.forAlbum(e),s=this.ImageBox.forSquare(e.artwork.map((e=>`/files/${e.file_id}/`)).shift()),n=[this.entityTitleFactory.forAlbum(e)],a=e.artists.map((e=>this.entityTitleFactory.forArtist(e)));return this.make(r,s,t,n,a)}forArtist(e,t=this.PlaybackButton.forArtist(e)){var r;let s=this.entityLinkFactory.forArtist(e),n=this.ImageBox.forSquare(null===(r=e.albums[0])||void 0===r?void 0:r.artwork.map((e=>`/files/${e.file_id}/`)).shift()),a=[this.entityTitleFactory.forArtist(e)],i=new Array;return this.make(s,n,t,a,i)}forCue(e,t=this.PlaybackButton.forCue(e)){if(s.Episode.is(e.media))return this.forEpisode(e.media,t);if(s.Movie.is(e.media))return this.forMovie(e.media,t);throw"Expected code to be unreachable!"}forDisc(e,t=this.PlaybackButton.forDisc(e)){let r=this.entityLinkFactory.forDisc(e),s=this.ImageBox.forSquare(e.album.artwork.map((e=>`/files/${e.file_id}/`)).shift()),n=[this.entityTitleFactory.forDisc(e)],a=[this.entityTitleFactory.forAlbum(e.album)];return this.make(r,s,t,n,a)}forEpisode(e,t=this.PlaybackButton.forEpisode(e)){let r=this.entityLinkFactory.forEpisode(e),s=this.ImageBox.forSquare(`/media/stills/${e.media.file_id}/`),n=[this.entityTitleFactory.forEpisode(e)],a=[this.entityTitleFactory.forShow(e.season.show),this.entityTitleFactory.forSeason(e.season)];return this.make(r,s,t,n,a)}forGenre(e){let t=this.entityLinkFactory.forGenre(e),r=this.ImageBox.forSquare(),s=[this.entityTitleFactory.forGenre(e)];return this.make(t,r,void 0,s,[])}forMovie(e,t=this.PlaybackButton.forMovie(e)){let r=this.entityLinkFactory.forMovie(e),s=this.ImageBox.forSquare(e.artwork.map((e=>`/files/${e.file_id}/`)).shift()),n=[this.entityTitleFactory.forMovie(e)],a=e.genres.map((e=>this.entityTitleFactory.forGenre(e)));return this.make(r,s,t,n,a)}forPerson(e){let t=this.entityLinkFactory.forPerson(e),r=this.ImageBox.forSquare(),s=[this.entityTitleFactory.forPerson(e)];return this.make(t,r,void 0,s,[])}forPlaylist(e,t=this.PlaybackButton.forPlaylist(e)){var r;let s=this.entityLinkFactory.forPlaylist(e),n=this.ImageBox.forSquare(null===(r=e.items[0])||void 0===r?void 0:r.track.disc.album.artwork.map((e=>`/files/${e.file_id}/`)).shift()),a=[this.entityTitleFactory.forPlaylist(e)],i=[this.entityTitleFactory.forUser(e.user)];return this.make(s,n,t,a,i)}forSeason(e,t=this.PlaybackButton.forSeason(e)){let r=this.entityLinkFactory.forSeason(e),s=this.ImageBox.forSquare(e.show.artwork.map((e=>`/files/${e.file_id}/`)).shift()),n=[this.entityTitleFactory.forSeason(e)],a=[this.entityTitleFactory.forShow(e.show)];return this.make(r,s,t,n,a)}forShow(e,t=this.PlaybackButton.forShow(e)){let r=this.entityLinkFactory.forShow(e),s=this.ImageBox.forSquare(e.artwork.map((e=>`/files/${e.file_id}/`)).shift()),n=[this.entityTitleFactory.forShow(e)],a=e.genres.map((e=>this.entityTitleFactory.forGenre(e)));return this.make(r,s,t,n,a)}forTrack(e,t=this.PlaybackButton.forTrack(e)){let r=this.entityLinkFactory.forTrack(e),s=this.ImageBox.forSquare(e.disc.album.artwork.map((e=>`/files/${e.file_id}/`)).shift()),n=[this.entityTitleFactory.forTrack(e)],a=[...e.artists.map((e=>this.entityTitleFactory.forArtist(e))),this.entityTitleFactory.forAlbum(e.disc.album)];return this.make(r,s,t,n,a)}forUser(e){let t=this.entityLinkFactory.forUser(e),r=this.ImageBox.forSquare(),s=[this.entityTitleFactory.forUser(e)],a=[n.element("span").add(n.text(e.username))];return this.make(t,r,void 0,s,a)}forYear(e){let t=this.entityLinkFactory.forYear(e),r=this.ImageBox.forSquare(),s=[this.entityTitleFactory.forYear(e)];return this.make(t,r,void 0,s,[])}static makeStyle(){return n.element("style").add(n.text(i))}}},36:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EntityTitleFactory=void 0;const s=r(447),n=r(78);t.EntityTitleFactory=class{constructor(e){this.entityLinkFactory=e}make(e,t){return e.add(n.text(t))}forEntity(e){if(s.Album.is(e))return this.forAlbum(e);if(s.Artist.is(e))return this.forArtist(e);if(s.Disc.is(e))return this.forDisc(e);if(s.Episode.is(e))return this.forEpisode(e);if(s.Genre.is(e))return this.forGenre(e);if(s.Movie.is(e))return this.forMovie(e);if(s.Person.is(e))return this.forPerson(e);if(s.Playlist.is(e))return this.forPlaylist(e);if(s.Season.is(e))return this.forSeason(e);if(s.Show.is(e))return this.forShow(e);if(s.Track.is(e))return this.forTrack(e);if(s.User.is(e))return this.forUser(e);throw"Expected code to be unreachable!"}forAlbum(e){return this.make(this.entityLinkFactory.forAlbum(e),e.title)}forArtist(e){return this.make(this.entityLinkFactory.forArtist(e),e.title)}forDisc(e){return this.make(this.entityLinkFactory.forDisc(e),"Disc "+e.number)}forEpisode(e){return this.make(this.entityLinkFactory.forEpisode(e),e.title)}forGenre(e){return this.make(this.entityLinkFactory.forGenre(e),e.title)}forMovie(e){return this.make(this.entityLinkFactory.forMovie(e),e.title)}forPerson(e){return this.make(this.entityLinkFactory.forPerson(e),e.name)}forPlaylist(e){return this.make(this.entityLinkFactory.forPlaylist(e),e.title)}forSeason(e){return this.make(this.entityLinkFactory.forSeason(e),"Season "+e.number)}forShow(e){return this.make(this.entityLinkFactory.forShow(e),e.title)}forTrack(e){return this.make(this.entityLinkFactory.forTrack(e),e.title)}forUser(e){return this.make(this.entityLinkFactory.forUser(e),e.name)}forYear(e){return this.make(this.entityLinkFactory.forYear(e),e.year.toString())}static makeStyle(){return n.element("style").add(n.text(""))}}},403:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GridFactory=void 0;const s=r(78);t.GridFactory=class{constructor(){}make(){return s.element("div.grid")}static makeStyle(){return s.element("style").add(s.text("\n\t.grid {\n\t\talign-items: start;\n\t\tdisplay: grid;\n\t\tgap: 24px;\n\t\tgrid-template-columns: repeat(auto-fill, minmax(240px, 1fr));\n\t}\n"))}}},972:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IconFactory=void 0;const s=r(78);t.IconFactory=class{constructor(){}makeBackward(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(s.element("path").set("d","M13,15.268c-0.173,0-0.346-0.045-0.5-0.134L1.645,8.867c-0.31-0.179-0.5-0.509-0.5-0.866s0.19-0.688,0.5-0.866L12.5,0.866c0.154-0.089,0.327-0.134,0.5-0.134s0.346,0.044,0.5,0.134C13.81,1.044,14,1.375,14,1.732v12.536c0,0.357-0.19,0.688-0.5,0.866C13.346,15.223,13.173,15.268,13,15.268z"))}makeCalendar(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M21,24H3c-1.654,0-3-1.346-3-3V6c0-1.654,1.346-3,3-3h18c1.654,0,3,1.346,3,3v15C24,22.654,22.654,24,21,24z M3,5C2.449,5,2,5.449,2,6v15c0,0.552,0.449,1,1,1h18c0.552,0,1-0.448,1-1V6c0-0.551-0.448-1-1-1H3z")).add(s.element("path").set("d","M6,8C5.448,8,5,7.552,5,7V1c0-0.552,0.448-1,1-1s1,0.448,1,1v6C7,7.552,6.552,8,6,8z")).add(s.element("path").set("d","M18,8c-0.553,0-1-0.448-1-1V1c0-0.552,0.447-1,1-1s1,0.448,1,1v6C19,7.552,18.553,8,18,8z")).add(s.element("path").set("d","M23,12H1c-0.552,0-1-0.447-1-1s0.448-1,1-1h22c0.553,0,1,0.447,1,1S23.553,12,23,12z"))}makeChevron(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M8.414,24c-0.256,0-0.512-0.098-0.707-0.293l-1.414-1.414c-0.391-0.391-0.391-1.023,0-1.414L15.172,12L6.293,3.121c-0.391-0.391-0.391-1.023,0-1.414l1.414-1.414C7.902,0.098,8.158,0,8.414,0s0.512,0.098,0.707,0.293l11,11c0.391,0.391,0.391,1.023,0,1.414l-11,11C8.926,23.902,8.67,24,8.414,24z"))}makeCross(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M19.071,21.485c-0.256,0-0.512-0.098-0.707-0.293L12,14.828l-6.364,6.364c-0.188,0.188-0.442,0.293-0.707,0.293s-0.52-0.105-0.707-0.293l-1.414-1.414c-0.391-0.391-0.391-1.023,0-1.414L9.172,12L2.808,5.636c-0.391-0.391-0.391-1.023,0-1.414l1.414-1.414c0.195-0.195,0.451-0.293,0.707-0.293S5.44,2.612,5.636,2.808L12,9.172l6.364-6.364c0.195-0.195,0.451-0.293,0.707-0.293s0.512,0.098,0.707,0.293l1.414,1.414c0.391,0.391,0.391,1.023,0,1.414L14.828,12l6.364,6.364c0.391,0.391,0.391,1.023,0,1.414l-1.414,1.414C19.583,21.388,19.327,21.485,19.071,21.485z"))}makeBroadcast(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(s.element("path").set("d","M1,16c-0.552,0-1-0.447-1-1v-1.829c0-0.325,0.158-0.629,0.423-0.816C0.594,12.233,0.795,12.171,1,12.171c0.112,0,0.226,0.019,0.334,0.058c1.144,0.405,2.032,1.294,2.438,2.438c0.109,0.306,0.062,0.646-0.125,0.911C3.458,15.843,3.153,16,2.829,16H1z")).add(s.element("path").set("d","M6.929,16c-0.498,0-0.919-0.365-0.99-0.857c-0.376-2.616-2.465-4.706-5.081-5.081C0.366,9.99,0,9.568,0,9.071l0-2.016C0,6.771,0.121,6.5,0.333,6.31C0.517,6.145,0.754,6.055,1,6.055c0.037,0,0.073,0.002,0.11,0.006c4.604,0.511,8.317,4.224,8.829,8.829c0.031,0.282-0.059,0.565-0.248,0.777C9.5,15.879,9.229,16,8.945,16H6.929z")).add(s.element("path").set("d","M12.962,16c-0.522,0-0.957-0.402-0.997-0.924C11.518,9.229,6.771,4.482,0.924,4.035C0.403,3.996,0,3.561,0,3.038l0-2.005c0-0.276,0.115-0.541,0.316-0.73C0.502,0.129,0.747,0.033,1,0.033c0.022,0,0.044,0,0.066,0.002c7.968,0.527,14.373,6.933,14.899,14.898c0.018,0.276-0.079,0.548-0.268,0.75C15.508,15.886,15.243,16,14.967,16H12.962z"))}makeDisc(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M12,24C5.383,24,0,18.617,0,12C0,5.383,5.383,0,12,0c6.617,0,12,5.383,12,12C24,18.617,18.617,24,12,24z M12,2C6.486,2,2,6.486,2,12c0,5.514,4.486,10,10,10c5.514,0,10-4.486,10-10C22,6.486,17.514,2,12,2z")).add(s.element("circle").set("cx","12").set("cy","12").set("r","2"))}makeForward(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(s.element("path").set("d","M3,15.268c-0.173,0-0.345-0.045-0.5-0.134C2.19,14.955,2,14.625,2,14.268V1.732c0-0.357,0.19-0.688,0.5-0.866C2.655,0.776,2.827,0.732,3,0.732s0.345,0.044,0.5,0.134l10.855,6.269c0.31,0.179,0.5,0.509,0.5,0.866s-0.19,0.688-0.5,0.866L3.5,15.134C3.345,15.223,3.173,15.268,3,15.268z"))}makeFullscreen(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(s.element("path").set("d","M10.343,8.071c-0.266,0-0.52-0.105-0.707-0.293L8.222,6.364c-0.391-0.391-0.391-1.023,0-1.414l2.121-2.121L9.222,1.707C8.936,1.421,8.85,0.991,9.005,0.617C9.16,0.244,9.524,0,9.929,0H15c0.553,0,1,0.448,1,1v5.071c0,0.404-0.243,0.769-0.617,0.924C15.259,7.046,15.129,7.071,15,7.071c-0.26,0-0.516-0.102-0.707-0.293l-1.121-1.121L11.05,7.778C10.862,7.966,10.608,8.071,10.343,8.071L10.343,8.071z")).add(s.element("path").set("d","M1,16c-0.552,0-1-0.447-1-1V9.929C0,9.524,0.244,9.16,0.617,9.005C0.741,8.954,0.871,8.929,1,8.929c0.26,0,0.516,0.102,0.707,0.293l1.122,1.121L4.95,8.222c0.195-0.195,0.451-0.293,0.707-0.293s0.512,0.098,0.707,0.293l1.415,1.414c0.188,0.188,0.293,0.441,0.293,0.707c0,0.265-0.105,0.52-0.293,0.707l-2.122,2.122l1.121,1.121c0.286,0.286,0.372,0.716,0.217,1.09S6.475,16,6.071,16H1z"))}makeHome(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(s.element("path").set("d","M3,16c-0.552,0-1-0.447-1-1V9H1.334C0.929,9,0.563,8.755,0.409,8.38C0.255,8.005,0.342,7.574,0.631,7.289l6.662-6.59C7.488,0.506,7.742,0.41,7.996,0.41c0.256,0,0.512,0.098,0.707,0.293L11,3V2c0-0.552,0.447-1,1-1h1c0.553,0,1,0.448,1,1v4l1.293,1.293c0.286,0.286,0.372,0.716,0.217,1.09C15.355,8.756,14.99,9,14.586,9H14v6c0,0.553-0.447,1-1,1H3z"))}makeLast(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(s.element("path").set("d","M15,15.268c-0.173,0-0.346-0.045-0.5-0.134L3.645,8.867c-0.31-0.179-0.5-0.509-0.5-0.866s0.19-0.688,0.5-0.866L14.5,0.866c0.154-0.089,0.327-0.134,0.5-0.134s0.346,0.044,0.5,0.134C15.81,1.044,16,1.375,16,1.732v12.536c0,0.357-0.19,0.688-0.5,0.866C15.346,15.223,15.173,15.268,15,15.268z")).add(s.element("path").set("d","M1,16c-0.552,0-1-0.447-1-1V1c0-0.552,0.448-1,1-1h2c0.552,0,1,0.448,1,1v14c0,0.553-0.448,1-1,1H1z"))}makeList(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M22,5H10C9.447,5,9,4.552,9,4s0.447-1,1-1h12c0.553,0,1,0.448,1,1S22.553,5,22,5z")).add(s.element("path").set("d","M4,7C2.346,7,1,5.654,1,4s1.346-3,3-3s3,1.346,3,3S5.654,7,4,7z M4,3C3.449,3,3,3.449,3,4s0.449,1,1,1s1-0.449,1-1S4.551,3,4,3z")).add(s.element("path").set("d","M4,23c-1.654,0-3-1.346-3-3s1.346-3,3-3s3,1.346,3,3S5.654,23,4,23z M4,19c-0.551,0-1,0.448-1,1s0.449,1,1,1s1-0.448,1-1S4.551,19,4,19z")).add(s.element("path").set("d","M4,15c-1.654,0-3-1.346-3-3s1.346-3,3-3s3,1.346,3,3S5.654,15,4,15z M4,11c-0.551,0-1,0.448-1,1s0.449,1,1,1s1-0.448,1-1S4.551,11,4,11z")).add(s.element("path").set("d","M22,13H10c-0.553,0-1-0.447-1-1s0.447-1,1-1h12c0.553,0,1,0.447,1,1S22.553,13,22,13z")).add(s.element("path").set("d","M22,21H10c-0.553,0-1-0.447-1-1s0.447-1,1-1h12c0.553,0,1,0.447,1,1S22.553,21,22,21z"))}makeLock(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M5,24c-0.552,0-1-0.447-1-1V11c0-0.553,0.448-1,1-1h1V6c0-3.309,2.691-6,6-6s6,2.691,6,6v4h1c0.553,0,1,0.447,1,1v12c0,0.553-0.447,1-1,1H5z M12,4c-1.103,0-2,0.897-2,2v4h4V6C14,4.897,13.103,4,12,4z"))}makeMagnifyingGlass(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M21.586,24c-0.256,0-0.512-0.098-0.707-0.293l-5.367-5.367C13.871,19.426,11.965,20,10,20C4.486,20,0,15.514,0,10C0,4.486,4.486,0,10,0c5.514,0,10,4.486,10,10c0,1.965-0.574,3.871-1.66,5.512l5.367,5.367c0.391,0.391,0.391,1.023,0,1.414l-1.414,1.414C22.098,23.902,21.842,24,21.586,24z M10,4c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6S13.309,4,10,4z"))}makeMagnifyingGlassLine(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M23.707,22.293l-5.966-5.966C19.152,14.604,20,12.401,20,10c0-5.523-4.478-10-10-10C4.477,0,0,4.477,0,10c0,5.522,4.477,10,10,10c2.401,0,4.604-0.848,6.327-2.259l5.966,5.966C22.488,23.902,22.744,24,23,24s0.512-0.098,0.707-0.293C24.098,23.316,24.098,22.684,23.707,22.293z M10,18c-4.418,0-8-3.582-8-8c0-4.418,3.582-8,8-8c4.418,0,8,3.582,8,8C18,14.418,14.418,18,10,18z"))}makeMinus(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M1,14c-0.552,0-1-0.447-1-1v-2c0-0.553,0.448-1,1-1h22c0.553,0,1,0.447,1,1v2c0,0.553-0.447,1-1,1H1z"))}makeMonitor(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M21,19H3c-1.654,0-3-1.346-3-3V4c0-1.654,1.346-3,3-3h18c1.654,0,3,1.346,3,3v12C24,17.654,22.654,19,21,19z M3,3C2.449,3,2,3.449,2,4v12c0,0.552,0.449,1,1,1h18c0.552,0,1-0.448,1-1V4c0-0.551-0.448-1-1-1H3z")).add(s.element("path").set("d","M17,23H7c-0.552,0-1-0.447-1-1s0.448-1,1-1h10c0.553,0,1,0.447,1,1S17.553,23,17,23z"))}makeNext(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(s.element("path").set("d","M1,15.268c-0.173,0-0.345-0.045-0.5-0.134C0.19,14.955,0,14.625,0,14.268V1.732c0-0.357,0.19-0.688,0.5-0.866C0.655,0.776,0.827,0.732,1,0.732s0.345,0.044,0.5,0.134l10.855,6.269c0.31,0.179,0.5,0.509,0.5,0.866s-0.19,0.688-0.5,0.866L1.5,15.134C1.345,15.223,1.173,15.268,1,15.268z")).add(s.element("path").set("d","M13,16c-0.553,0-1-0.447-1-1V1c0-0.552,0.447-1,1-1h2c0.553,0,1,0.448,1,1v14c0,0.553-0.447,1-1,1H13z"))}makePause(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(s.element("path").set("d","M3,16c-0.552,0-1-0.447-1-1V1c0-0.552,0.448-1,1-1h2c0.552,0,1,0.448,1,1v14c0,0.553-0.448,1-1,1H3z")).add(s.element("path").set("d","M11,16c-0.553,0-1-0.447-1-1V1c0-0.552,0.447-1,1-1h2c0.553,0,1,0.448,1,1v14c0,0.553-0.447,1-1,1H11z"))}makePerson(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M1.057,24c-0.286,0-0.559-0.123-0.749-0.337c-0.19-0.215-0.279-0.5-0.244-0.784c0.415-3.401,2.707-4.398,4.923-5.363c1.996-0.867,3.881-1.688,4-4.26C7.724,11.515,7,8.505,7,5c0-2.991,2.01-5,5-5s5,2.009,5,5c0,3.505-0.725,6.515-1.987,8.256c0.118,2.572,2.003,3.392,3.998,4.26c2.219,0.965,4.511,1.963,4.925,5.363c0.034,0.284-0.055,0.57-0.244,0.784C23.501,23.877,23.229,24,22.942,24H1.057z"))}makePersonLine(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M23,24H1c-0.552,0-1-0.447-1-1c0-4.931,2.929-6.02,5.067-6.813C7.048,15.45,8,15.008,8,13c0-0.466-0.157-0.734-0.513-1.297C6.859,10.711,6,9.353,6,6c0-3.533,2.467-6,6-6c3.532,0,6,2.467,6,6c0,3.353-0.859,4.711-1.487,5.703C16.157,12.266,16,12.534,16,13c0,2.008,0.952,2.45,2.933,3.187C21.071,16.98,24,18.069,24,23C24,23.553,23.553,24,23,24z M2.051,22h19.898c-0.295-2.669-1.826-3.237-3.713-3.938C16.349,17.36,14,16.487,14,13c0-1.064,0.418-1.726,0.823-2.365C15.375,9.762,16,8.773,16,6c0-2.43-1.57-4-4-4S8,3.57,8,6c0,2.773,0.625,3.762,1.177,4.635C9.582,11.274,10,11.936,10,13c0,3.487-2.349,4.36-4.236,5.062S2.345,19.331,2.051,22z"))}makePieChart(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M10,24C4.486,24,0,19.514,0,14C0,8.486,4.486,4,10,4c0.553,0,1,0.448,1,1v8h8c0.553,0,1,0.447,1,1C20,19.514,15.514,24,10,24z M9,6.062C5.059,6.556,2,9.928,2,14c0,4.411,3.589,8,8,8c4.072,0,7.444-3.06,7.938-7H10c-0.553,0-1-0.447-1-1V6.062z")).add(s.element("path").set("d","M23,11h-9c-0.553,0-1-0.447-1-1V1c0-0.552,0.447-1,1-1c5.514,0,10,4.486,10,10C24,10.553,23.553,11,23,11z M15,9h6.938C21.485,5.387,18.613,2.515,15,2.062V9z"))}makePlay(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(s.element("path").set("d","M3,15.268c-0.173,0-0.345-0.045-0.5-0.134C2.19,14.955,2,14.625,2,14.268V1.732c0-0.357,0.19-0.688,0.5-0.866C2.655,0.776,2.827,0.732,3,0.732s0.345,0.044,0.5,0.134l10.855,6.269c0.31,0.179,0.5,0.509,0.5,0.866s-0.19,0.688-0.5,0.866L3.5,15.134C3.345,15.223,3.173,15.268,3,15.268z"))}makePlus(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M11,24c-0.553,0-1-0.447-1-1v-9H1c-0.552,0-1-0.447-1-1v-2c0-0.553,0.448-1,1-1h9V1c0-0.552,0.447-1,1-1h2c0.553,0,1,0.448,1,1v9h9c0.553,0,1,0.447,1,1v2c0,0.553-0.447,1-1,1h-9v9c0,0.553-0.447,1-1,1H11z"))}makeStar(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M18.088,22.585c-0.159,0-0.319-0.038-0.466-0.115L12,19.514L6.377,22.47c-0.146,0.077-0.306,0.115-0.465,0.115c-0.207,0-0.414-0.064-0.588-0.191c-0.308-0.224-0.462-0.603-0.398-0.978L6,15.154L1.451,10.72c-0.272-0.266-0.371-0.663-0.253-1.024c0.118-0.362,0.431-0.626,0.807-0.681L8.292,8.1l2.812-5.696C11.271,2.063,11.619,1.847,12,1.847s0.729,0.216,0.896,0.558l2.812,5.696l6.287,0.914c0.377,0.055,0.689,0.318,0.808,0.681c0.117,0.361,0.02,0.759-0.253,1.024L18,15.154l1.073,6.262c0.064,0.375-0.09,0.754-0.397,0.978C18.501,22.521,18.295,22.585,18.088,22.585z"))}makeStarLine(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M18.088,23.585c-0.323,0-0.646-0.08-0.932-0.23L12,20.644l-5.158,2.711c-0.661,0.35-1.501,0.288-2.107-0.152c-0.619-0.45-0.924-1.199-0.795-1.954l0.985-5.745l-4.173-4.067c-0.541-0.527-0.739-1.332-0.505-2.05c0.236-0.729,0.855-1.25,1.614-1.361l5.767-0.839l2.579-5.224C10.545,1.274,11.232,0.847,12,0.847s1.455,0.428,1.794,1.116l2.578,5.224l5.767,0.838c0.758,0.11,1.377,0.631,1.615,1.36c0.236,0.731,0.043,1.517-0.506,2.051l-4.174,4.068l0.984,5.743c0.13,0.755-0.175,1.505-0.795,1.955C18.919,23.453,18.513,23.585,18.088,23.585z M12,2.847L9.188,8.543C9.043,8.838,8.762,9.042,8.436,9.09l-6.287,0.914l4.549,4.435c0.235,0.229,0.343,0.561,0.288,0.885l-1.074,6.262l5.624-2.956c0.291-0.154,0.638-0.154,0.931,0l5.622,2.956c0,0,0,0,0-0.001l-1.073-6.261c-0.056-0.324,0.052-0.655,0.287-0.885l4.55-4.435L15.564,9.09c-0.326-0.047-0.607-0.251-0.753-0.547L12,2.847z"))}makeSpeaker(){return s.element("svg").set("width","12px").set("height","12px").set("viewBox","0 0 24 24").add(s.element("path").set("d","M18,24H6c-1.654,0-3-1.346-3-3V3c0-1.654,1.346-3,3-3h12c1.654,0,3,1.346,3,3v18C21,22.654,19.654,24,18,24z M6,2C5.449,2,5,2.449,5,3v18c0,0.552,0.449,1,1,1h12c0.552,0,1-0.448,1-1V3c0-0.551-0.448-1-1-1H6z")).add(s.element("path").set("d","M12,20c-2.757,0-5-2.243-5-5s2.243-5,5-5s5,2.243,5,5S14.757,20,12,20z M12,12c-1.654,0-3,1.346-3,3s1.346,3,3,3s3-1.346,3-3S13.654,12,12,12z")).add(s.element("circle").set("cx","12").set("cy","6").set("r","2"))}static makeStyle(){return s.element("style").add(s.text(""))}}},994:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageBoxFactory=void 0;const s=r(440),n=r(78),a=r(352),i=r(565),o=`\n\t.image-box {\n\t\tbackground-color: ${a.BACKGROUND_3};\n\t\tborder-radius: 2px;\n\t\toverflow: hidden;\n\t\tposition: relative;\n\t\twill-change: opacity;\n\t}\n\n\t.image-box--poster {\n\t\tpadding-bottom: 150%;\n\t}\n\n\t.image-box--square {\n\t\tpadding-bottom: 100%;\n\t}\n\n\t.image-box--video {\n\t\tpadding-bottom: 56.25%;\n\t}\n\n\t.image-box__image {\n\t\theight: 100%;\n\t\tobject-fit: contain;\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t}\n\n\t[data-opaque] {\n\t\topacity: 0;\n\t\ttransition: opacity 1.000s;\n\t}\n\n\t[data-opaque="true"] {\n\t\topacity: 1;\n\t}\n`;t.ImageBoxFactory=class{constructor(e){this.token=e}for(e,t="square"){let r=new s.ObservableClass(!1);return n.element("div.image-box.image-box--"+t).add(i.absent(e)?void 0:n.element("img.image-box__image").bind("data-opaque",r.addObserver((e=>e))).bind("src",this.token.addObserver((t=>{if(i.present(t)&&i.present(e))return`${e}?token=${t}`}))).on("load",(()=>{r.updateState(!0)})))}forPoster(e){return this.for(e,"poster")}forSquare(e){return this.for(e,"square")}forVideo(e){return this.for(e,"video")}static makeStyle(){return n.element("style").add(n.text(o))}}},587:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlaybackButtonFactory=void 0;const s=r(447),n=r(440),a=r(78),i=r(352),o=r(565),d=`\n\t.playback-button {\n\t\tbackground-color: ${i.TEXT_0};\n\t\tborder-radius: 50%;\n\t\tbox-shadow: 0px 0px 8px 4px rgba(0, 0, 0, 0.25);\n\t\tcursor: pointer;\n\t\tfill: ${i.BACKGROUND_2};\n\t\tpadding: 8px;\n\t\ttransition: transform 0.125s;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\t.playback-button:not([data-enabled="false"]):hover {\n\t\t\ttransform: scale(1.25);\n\t\t}\n\n\t\t.playback-button:active {\n\t\t\ttransform: none;\n\t\t}\n\t}\n`;t.PlaybackButtonFactory=class{constructor(e,t){this.player=e,this.iconFactory=t}make(e,t){let r=n.computed(((e,t)=>e&&t),e,this.player.playback);return a.element("div.playback-button").add(this.iconFactory.makePlay().bind("data-hide",r.addObserver((e=>e)))).add(this.iconFactory.makePause().bind("data-hide",r.addObserver((e=>!e)))).on("click",(()=>{r.getState()?this.player.pause():e.getState()?this.player.resume():t()}))}forEntity(e){if(s.Album.is(e))return this.forAlbum(e);if(s.Artist.is(e))return this.forArtist(e);if(s.Cue.is(e))return this.forCue(e);if(s.Disc.is(e))return this.forDisc(e);if(s.Episode.is(e))return this.forEpisode(e);if(s.Movie.is(e))return this.forMovie(e);if(s.Playlist.is(e))return this.forPlaylist(e);if(s.Season.is(e))return this.forSeason(e);if(s.Show.is(e))return this.forShow(e);if(s.Track.is(e))return this.forTrack(e);throw"Expected code to be unreachable!"}forAlbum(e,t,r){let s=n.computed((s=>{if(!o.present(s))return!1;if(o.present(t)){let n=e.discs[t];if(s[s.length-2]!==n.disc_id)return!1;if(o.present(r)){let e=n.tracks[r];if(s[s.length-1]!==e.track_id)return!1}}else if(s[s.length-3]!==e.album_id)return!1;return!0}),this.player.contextPath);return this.make(s,(()=>this.player.playAlbum(e,t,r)))}forArtist(e,t,r,s){let a=n.computed((n=>{if(!o.present(n))return!1;if(o.present(t)){let a=e.albums[t];if(n[n.length-3]!==a.album_id)return!1;if(o.present(r)){let e=a.discs[r];if(n[n.length-2]!==e.disc_id)return!1;if(o.present(s)){let t=e.tracks[s];if(n[n.length-1]!==t.track_id)return!1}}}else if(n[n.length-4]!==e.artist_id)return!1;return!0}),this.player.contextPath);return this.make(a,(()=>this.player.playArtist(e,t,r,s)))}forCue(e){if(s.Episode.is(e.media)){let t=e.media,r=n.computed((e=>!!o.present(e)&&e[e.length-1]===t.episode_id),this.player.contextPath);return this.make(r,(()=>{this.player.playEpisode(t),this.player.seek(e.start_ms/1e3)}))}if(s.Movie.is(e.media)){let t=e.media,r=n.computed((e=>!!o.present(e)&&e[e.length-1]===t.movie_id),this.player.contextPath);return this.make(r,(()=>{this.player.playMovie(t),this.player.seek(e.start_ms/1e3)}))}throw"Expected code to be unreachable!"}forDisc(e,t){let r=n.computed((r=>{if(!o.present(r))return!1;if(o.present(t)){let s=e.tracks[t];if(r[r.length-1]!==s.track_id)return!1}else if(r[r.length-2]!==e.disc_id)return!1;return!0}),this.player.contextPath);return this.make(r,(()=>this.player.playDisc(e,t)))}forEpisode(e){let t=n.computed((t=>!!o.present(t)&&t[t.length-1]===e.episode_id),this.player.contextPath);return this.make(t,(()=>this.player.playEpisode(e)))}forMovie(e){let t=n.computed((t=>!!o.present(t)&&t[t.length-1]===e.movie_id),this.player.contextPath);return this.make(t,(()=>this.player.playMovie(e)))}forPlaylist(e,t){let r=n.computed((r=>{if(!o.present(r))return!1;if(o.present(t)){let s=e.items[t].track;if(r[r.length-1]!==s.track_id)return!1}else if(r[r.length-2]!==e.playlist_id)return!1;return!0}),this.player.contextPath);return this.make(r,(()=>this.player.playPlaylist(e,t)))}forSeason(e,t){let r=n.computed((r=>{if(!o.present(r))return!1;if(o.present(t)){let s=e.episodes[t];if(r[r.length-1]!==s.episode_id)return!1}else if(r[r.length-2]!==e.season_id)return!1;return!0}),this.player.contextPath);return this.make(r,(()=>this.player.playSeason(e,t)))}forShow(e,t,r){let s=n.computed((s=>{if(!o.present(s))return!1;if(o.present(t)){let n=e.seasons[t];if(s[s.length-2]!==n.season_id)return!1;if(o.present(r)){let e=n.episodes[r];if(s[s.length-1]!==e.episode_id)return!1}}else if(s[s.length-3]!==e.show_id)return!1;return!0}),this.player.contextPath);return this.make(s,(()=>this.player.playShow(e,t,r)))}forTrack(e){let t=n.computed((t=>!!o.present(t)&&t[t.length-1]===e.track_id),this.player.contextPath);return this.make(t,(()=>this.player.playTrack(e)))}static makeStyle(){return a.element("style").add(a.text(d))}}},128:(e,t)=>{function r(e){let t=Math.floor(e/1e3);e-=1e3*t;let r=Math.floor(t/60);t-=60*r;let s=Math.floor(r/60);r-=60*s;let n=Math.floor(s/24);return s-=24*n,{ms:e,s:t,m:r,h:s,d:n}}Object.defineProperty(t,"__esModule",{value:!0}),t.formatDuration=t.computeDuration=void 0,t.computeDuration=r,t.formatDuration=function(e){let t=r(e);return t.d>=10?t.d+"d":t.d>=1?`${t.d}d ${t.h}h`:t.h>=10?t.h+"h":t.h>=1?`${t.h}h ${t.m}m`:t.m>=10?t.m+"m":t.m>=1?`${t.m}m ${t.s}s`:t.s+"s"}},352:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_ACCENT=t.TEXT_1=t.TEXT_0=t.BACKGROUND_ACCENT=t.BACKGROUND_4=t.BACKGROUND_3=t.BACKGROUND_2=t.BACKGROUND_1=t.BACKGROUND_0=void 0,t.BACKGROUND_0="rgb(0, 0, 0)",t.BACKGROUND_1="rgb(15, 15, 15)",t.BACKGROUND_2="rgb(31, 31, 31)",t.BACKGROUND_3="rgb(47, 47, 47)",t.BACKGROUND_4="rgb(63, 63, 63)",t.BACKGROUND_ACCENT="rgb(223, 79, 127)",t.TEXT_0="rgb(255, 255, 255)",t.TEXT_1="rgb(159, 159, 159)",t.TEXT_ACCENT="rgb(255, 255, 255)"},78:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.joinarray=t.text=t.element=t.XElement=t.XText=void 0;const s=r(565),n=r(440);class a{constructor(e){this.content=e}render(){let e=document.createTextNode("");return this.content instanceof n.ObservableClass?this.content.addObserver((t=>{e.textContent=t})):e.textContent=this.content,e}}t.XText=a;class i{constructor(e){let t=e.split(".");this.tag=t[0],this.attributes=new Map,this.children=new Array,this.bound=new Map,this.bound2=new Map,this.listeners=new Map,this.resolve=()=>{},this.element=new Promise(((e,t)=>{this.resolve=e}));let r=t.slice(1).join(" ");""!==r&&this.attributes.set("class",r)}add(...e){for(let t of e)null!=t&&this.children.push(t);return this}bind(e,t){return this.bound.set(e,t),this}bind2(e,t){return this.bound2.set(e,t),this}on(e,t,r=!0){let s=this.listeners.get(e);return null==s&&(s=new Array,this.listeners.set(e,s)),s.push((e=>{r&&(e.preventDefault(),e.stopPropagation()),t(e)})),this}ref(){if(s.absent(this.element))throw"Expected element to be rendered!";return this.element}render(){let e=["svg","path","circle"].indexOf(this.tag)>=0?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",t=document.createElementNS(e,this.tag);t.setAttribute=(()=>{let e=t.setAttribute.bind(t);return(r,s)=>{if("src"===r){let n=new IntersectionObserver((a=>{for(let i of a)i.target===t&&i.isIntersecting&&(n.unobserve(t),e(r,s))}),{root:document.body});n.observe(t)}else e(r,s)}})();for(let[e,r]of this.listeners)for(let s of r)t.addEventListener(e,s);for(let[e,r]of this.attributes)t.setAttribute(e,r);for(let[e,r]of this.bound)r((r=>{t.setAttribute(e,""+r)}));for(let[e,r]of this.bound2)r.addObserver((r=>{t.setAttribute(e,""+r)})),"input"===this.tag&&"value"===e&&t.addEventListener("input",(()=>{r.updateState(t.value)}));for(let e of this.children)t.appendChild(e.render());return this.array&&this.array.addObserver({onappend:e=>{if(this.renderer){let r=this.renderer(e);t.appendChild(r.render())}},onsplice:(e,r)=>{let n=t.children[r];s.present(n)&&t.removeChild(n)}}),this.resolve(t),t}repeat(e,t){return this.array=e,this.renderer=t,this}set(e,t=""){return this.attributes.set(e,t),this}}function o(e){return new a(e)}t.XElement=i,t.element=function(e){return new i(e)},t.text=o,t.joinarray=function(e,t=" · "){let r=[];for(let s of e)r.push(s),r.push(o(t));return r.pop(),r}},375:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Union=t.Undefined=t.Tuple=t.StringLiteral=t.String=t.Reference=t.Record=t.Object=t.NumberLiteral=t.Number=t.Null=t.Intersection=t.BooleanLiteral=t.Boolean=t.Array=t.Any=void 0,t.Any={as:(e,t="")=>e,is(e){try{this.as(e)}catch(e){return!1}return!0}},t.Array={of:e=>({as(t,r=""){if(null!=t&&t.constructor===globalThis.Array){for(let s=0;s<t.length;s++)e.as(t[s],r+"["+s+"]");return t}throw"Expected an array at "+r+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}})},t.Boolean={as(e,t=""){if(null!=e&&e.constructor===globalThis.Boolean)return e;throw"Expected a boolean at "+t+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}},t.BooleanLiteral={of:e=>({as(t,r=""){if(t===e)return t;throw"Expected "+e+" at "+r+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}})},t.Intersection={of:(...e)=>({as(t,r=""){for(let s of e)s.as(t,r);return t},is(e){try{this.as(e)}catch(e){return!1}return!0}})},t.Null={as(e,t=""){if(null===e)return e;throw"Expected null at "+t+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}},t.Number={as(e,t=""){if(null!=e&&e.constructor===globalThis.Number)return e;throw"Expected a number at "+t+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}},t.NumberLiteral={of:e=>({as(t,r=""){if(t===e)return t;throw"Expected "+e+" at "+r+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}})},t.Object={of:e=>({as(t,r=""){if(null!=t&&t.constructor===globalThis.Object){for(let s in e)e[s].as(t[s],r+/^([a-z][a-z0-9_]*)$/is.test(s)?"."+s:'["'+s+'"]');return t}throw"Expected an object at "+r+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}})},t.Record={of:e=>({as(t,r=""){if(null!=t&&t.constructor===globalThis.Object){for(let s of globalThis.Object.keys(t))e.as(t[s],r+'["'+s+'"]');return t}throw"Expected a record at "+r+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}})},t.Reference={of:e=>({as:(t,r="")=>e().as(t,r),is:t=>e().is(t)})},t.String={as(e,t=""){if(null!=e&&e.constructor===globalThis.String)return e;throw"Expected a string at "+t+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}},t.StringLiteral={of:e=>({as(t,r=""){if(t===e)return t;throw'Expected "'+e+'" at '+r+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}})},t.Tuple={of:(...e)=>({as(t,r=""){if(null!=t&&t.constructor===globalThis.Array){for(let s=0;s<e.length;s++)e[s].as(t[s],r+"["+s+"]");return t}throw"Expected a tuple at "+r+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}})},t.Undefined={as(e,t=""){if(void 0===e)return e;throw"Expected undefined at "+t+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}},t.Union={of:(...e)=>({as(t,r=""){for(let s of e)try{return s.as(t,r)}catch(e){}throw"Expected a union at "+r+"!"},is(e){try{this.as(e)}catch(e){return!1}return!0}})}},175:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transform=t.tokenization=t.serialization=t.language=t.guards=void 0;const s=r(375);t.guards=s;const n=r(226);t.language=n;const a=r(129);t.serialization=a;const i=r(329);t.tokenization=i,t.transform=function(e,t){let r=new i.Tokenizer(e);return n.Schema.parse(r).generateModule(t)}},226:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Schema=t.UnionType=t.UndefinedType=t.TupleType=t.StringLiteralType=t.StringType=t.ReferenceType=t.RecordType=t.ObjectType=t.NumberLiteralType=t.NumberType=t.NullType=t.IntersectionType=t.GroupType=t.BooleanLiteralType=t.BooleanType=t.ArrayType=t.AnyType=t.Type=void 0;const s=r(329);t.Type={parse(e,...t){try{return x.parse(e,...t)}catch(e){}try{return l.parse(e,...t)}catch(e){}try{return a.parse(e,...t)}catch(e){}try{return n.parse(e)}catch(e){}try{return i.parse(e)}catch(e){}try{return o.parse(e)}catch(e){}try{return u.parse(e)}catch(e){}try{return c.parse(e)}catch(e){}try{return p.parse(e)}catch(e){}try{return m.parse(e)}catch(e){}try{return y.parse(e)}catch(e){}try{return v.parse(e)}catch(e){}try{return g.parse(e)}catch(e){}try{return b.parse(e)}catch(e){}try{return h.parse(e)}catch(e){}try{return d.parse(e)}catch(e){}try{return f.parse(e)}catch(e){}return e.newContext(((e,t)=>{let r=e();throw`Unexpected ${r.family} at row ${r.row}, col ${r.col}!`}))}};class n{constructor(){}generateType(e){return"any"}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\treturn subject;"),t.push("}")):t.push("autoguard.Any"),t.join(e.eol)}getImports(){return[]}static parse(e){return e.newContext(((e,t)=>(s.expect(e(),"any"),n.INSTANCE)))}}t.AnyType=n,n.INSTANCE=new n;class a{constructor(e){this.type=e}generateType(e){return this.type.generateType(e)+"[]"}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif ((subject != null) && (subject.constructor === globalThis.Array)) {"),t.push("\t\tfor (let i = 0; i < subject.length; i++) {"),t.push("\t\t\t("+this.type.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t\t\t"}))+')(subject[i], path + "[" + i + "]");'),t.push("\t\t}"),t.push("\t\treturn subject;"),t.push("\t}"),t.push('\tthrow "Expected an array at " + path + "!";'),t.push("}")):t.push("autoguard.Array.of("+this.type.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol}))+")"),t.join(e.eol)}getImports(){return this.type.getImports()}static parse(e,...r){if(r.includes("Array"))throw"Recursion prevention!";return e.newContext(((n,i)=>{let o=t.Type.parse(e,...r,"Array");s.expect(n(),"["),s.expect(n(),"]");let d=new a(o);for(;;)try{e.newContext(((e,t)=>{s.expect(e(),"["),s.expect(e(),"]"),d=new a(d)}))}catch(e){break}return d}))}}t.ArrayType=a;class i{constructor(){}generateType(e){return"boolean"}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif ((subject != null) && (subject.constructor === globalThis.Boolean)) {"),t.push("\t\treturn subject as boolean;"),t.push("\t}"),t.push('\tthrow "Expected a boolean at " + path + "!";'),t.push("}")):t.push("autoguard.Boolean"),t.join(e.eol)}getImports(){return[]}static parse(e){return e.newContext(((e,t)=>(s.expect(e(),"boolean"),i.INSTANCE)))}}t.BooleanType=i,i.INSTANCE=new i;class o{constructor(e){this.value=e}generateType(e){return""+this.value}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif (subject === "+this.generateType(Object.assign(Object.assign({},e),{eol:e.eol+"\t"}))+") {"),t.push("\t\treturn subject;"),t.push("\t}"),t.push('\tthrow "Expected '+this.value+' at " + path + "!";'),t.push("}")):t.push("autoguard.BooleanLiteral.of("+this.generateType(Object.assign(Object.assign({},e),{eol:e.eol}))+")"),t.join(e.eol)}getImports(){return[]}static parse(e){return e.newContext(((e,t)=>"true"===s.expect(e(),["true","false"]).family?o.INSTANCE_TRUE:o.INSTANCE_FALSE))}}t.BooleanLiteralType=o,o.INSTANCE_TRUE=new o(!0),o.INSTANCE_FALSE=new o(!1);class d{constructor(e){this.type=e}generateType(e){return"("+this.type.generateType(e)+")"}generateTypeGuard(e){return this.type.generateTypeGuard(e)}getImports(){return this.type.getImports()}static parse(e){return e.newContext(((r,n)=>{s.expect(r(),"(");let a=t.Type.parse(e);return s.expect(r(),")"),new d(a)}))}}t.GroupType=d;class l{constructor(){this.types=new Set}add(e){return this.types.add(e),this}generateType(e){let t=new Array;for(let r of this.types)t.push(r.generateType(e));return t.join(" & ")}generateTypeGuard(e){let t=new Array;if(e.standalone){t.push("(subject, path) => {");for(let r of this.types)t.push("\t("+r.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t"}))+")(subject, path);");return t.push("\treturn subject;"),t.push("}"),t.join(e.eol)}for(let r of this.types)t.push("\t"+r.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t"})));return"autoguard.Intersection.of("+e.eol+t.join(","+e.eol)+e.eol+")"}getImports(){let e=new Array;for(let t of this.types)e.push(...t.getImports());return e}static parse(e,...r){if(r.includes("Intersection"))throw"Recursion prevention!";return e.newContext(((n,a)=>{var i;let o=t.Type.parse(e,...r,"Intersection"),d=new l;for(d.add(o);"&"===(null===(i=a())||void 0===i?void 0:i.value);){s.expect(n(),"&");let a=t.Type.parse(e,...r,"Intersection");d.add(a)}return 1===d.types.size?o:d}))}}t.IntersectionType=l;class u{constructor(){}generateType(e){return"null"}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif (subject === null) {"),t.push("\t\treturn subject;"),t.push("\t}"),t.push('\tthrow "Expected null at " + path + "!";'),t.push("}")):t.push("autoguard.Null"),t.join(e.eol)}getImports(){return[]}static parse(e){return e.newContext(((e,t)=>(s.expect(e(),"null"),u.INSTANCE)))}}t.NullType=u,u.INSTANCE=new u;class c{constructor(){}generateType(e){return"number"}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif ((subject != null) && (subject.constructor === globalThis.Number)) {"),t.push("\t\treturn subject as number;"),t.push("\t}"),t.push('\tthrow "Expected a number at " + path + "!";'),t.push("}")):t.push("autoguard.Number"),t.join(e.eol)}getImports(){return[]}static parse(e){return e.newContext(((e,t)=>(s.expect(e(),"number"),c.INSTANCE)))}}t.NumberType=c,c.INSTANCE=new c;class p{constructor(e){this.value=e}generateType(e){return""+this.value}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif (subject === "+this.generateType(Object.assign(Object.assign({},e),{eol:e.eol+"\t"}))+") {"),t.push("\t\treturn subject;"),t.push("\t}"),t.push('\tthrow "Expected '+this.value+' at " + path + "!";'),t.push("}")):t.push("autoguard.NumberLiteral.of("+this.generateType(Object.assign(Object.assign({},e),{eol:e.eol}))+")"),t.join(e.eol)}getImports(){return[]}static parse(e){return e.newContext(((e,t)=>{let r=s.expect(e(),"NUMBER_LITERAL").value;return new p(Number.parseInt(r))}))}}t.NumberLiteralType=p;class h{constructor(){this.members=new Map}add(e,t){return this.members.set(e,t),this}generateType(e){if(0===this.members.size)return"{}";let t=new Array;for(let[r,s]of this.members)t.push('\t"'+r+'"'+(s.optional?"?":"")+": "+s.type.generateType(Object.assign(Object.assign({},e),{eol:e.eol+"\t"})));return"{"+(t.length>0?e.eol+t.join(","+e.eol)+e.eol:"")+"}"}generateTypeGuard(e){let t=new Array;if(e.standalone){t.push("(subject, path) => {"),t.push("\tif ((subject != null) && (subject.constructor === globalThis.Object)) {");for(let[r,s]of this.members){let n=s.type;if(s.optional){let e=new x;e.add(v.INSTANCE),e.add(n),n=e}let a=/^([a-z][a-z0-9_]*)$/is.test(r)?'".'+r+'"':'"[\\"'+r+'\\"]"';t.push("\t\t("+n.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t\t"}))+')(subject["'+r+'"], path + '+a+");")}return t.push("\t\treturn subject;"),t.push("\t}"),t.push('\tthrow "Expected an object at " + path + "!";'),t.push("}"),t.join(e.eol)}for(let[r,s]of this.members){let n=s.type;if(s.optional){let e=new x;e.add(v.INSTANCE),e.add(n),n=e}t.push('\t"'+r+'": '+n.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t"})))}return"autoguard.Object.of<"+(null!=this.typename?this.typename:this.generateType(e))+">({"+(t.length>0?e.eol+t.join(","+e.eol)+e.eol:"")+"})"}getImports(){let e=new Array;for(let[t,r]of this.members){let t=r.type;e.push(...t.getImports())}return e}setTypename(e){this.typename=e}static parse(e){return e.newContext(((r,n)=>{var a,i,o;s.expect(r(),"{");let d=new h;if("}"!==(null===(a=n())||void 0===a?void 0:a.value))for(;;){let a=!1,l=s.expect(r(),["any","boolean","false","null","number","string","true","undefined","IDENTIFIER","STRING_LITERAL"]),u="STRING_LITERAL"===l.family?l.value.slice(1,-1):l.value;"?"===(null===(i=n())||void 0===i?void 0:i.value)&&(r(),a=!0),s.expect(r(),":");let c=t.Type.parse(e);if(d.add(u,{type:c,optional:a}),","!==(null===(o=n())||void 0===o?void 0:o.value))break;s.expect(r(),",")}return s.expect(r(),"}"),d}))}}t.ObjectType=h;class f{constructor(e){this.type=e}generateType(e){return"Record<string, undefined | "+this.type.generateType(e)+">"}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif ((subject != null) && (subject.constructor === globalThis.Object)) {"),t.push("\t\tfor (let key of globalThis.Object.keys(subject)) {"),t.push("\t\t\t("+this.type.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t\t\t"}))+')(subject[key], path + "[\\"" + key + "\\"]");'),t.push("\t\t}"),t.push("\t\treturn subject;"),t.push("\t}"),t.push('\tthrow "Expected a record at " + path + "!";'),t.push("}")):t.push("autoguard.Record.of("+this.type.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol}))+")"),t.join(e.eol)}getImports(){return this.type.getImports()}static parse(e){return e.newContext(((r,n)=>{s.expect(r(),"{");let a=t.Type.parse(e);return s.expect(r(),"}"),new f(a)}))}}t.RecordType=f;class g{constructor(e,t){this.path=e,this.typename=t}generateType(e){return this.typename}generateTypeGuard(e){return e.standalone?this.typename+".as":"autoguard.Reference.of<"+this.typename+">(() => "+this.typename+")"}getImports(){return this.path.length>0?[{path:this.path,typename:this.typename}]:[]}static parse(e){return e.newContext(((e,t)=>{var r,n;"@"===(null===(r=t())||void 0===r?void 0:r.family)&&s.expect(e(),"@");let a=new Array;for(;;){let r=e();if(s.expect(r,[".","..","IDENTIFIER"]),a.push(r),"/"!==(null===(n=t())||void 0===n?void 0:n.family))break;s.expect(e(),"/")}let i=a.pop();return s.expect(i,"IDENTIFIER"),new g(a.map((e=>e.value)),i.value)}))}}t.ReferenceType=g;class m{constructor(){}generateType(e){return"string"}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif ((subject != null) && (subject.constructor === globalThis.String)) {"),t.push("\t\treturn subject as string;"),t.push("\t}"),t.push('\tthrow "Expected a string at " + path + "!";'),t.push("}")):t.push("autoguard.String"),t.join(e.eol)}getImports(){return[]}static parse(e){return e.newContext(((e,t)=>(s.expect(e(),"string"),m.INSTANCE)))}}t.StringType=m,m.INSTANCE=new m;class y{constructor(e){this.value=e}generateType(e){return'"'+this.value+'"'}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif (subject === "+this.generateType(Object.assign(Object.assign({},e),{eol:e.eol+"\t"}))+") {"),t.push("\t\treturn subject;"),t.push("\t}"),t.push('\tthrow "Expected \\"'+this.value+'\\" at " + path + "!";'),t.push("}")):t.push('autoguard.StringLiteral.of("'+this.value+'")'),t.join(e.eol)}getImports(){return[]}static parse(e){return e.newContext(((e,t)=>{let r=s.expect(e(),"STRING_LITERAL").value;return new y(r.slice(1,-1))}))}}t.StringLiteralType=y;class b{constructor(){this.types=new Array}add(e){return this.types.push(e),this}generateType(e){let t=new Array;for(let r of this.types)t.push("\t"+r.generateType(Object.assign(Object.assign({},e),{eol:e.eol+"\t"})));return"["+(t.length>0?e.eol+t.join(","+e.eol)+e.eol:"")+"]"}generateTypeGuard(e){let t=new Array;if(e.standalone){t.push("(subject, path) => {"),t.push("\tif ((subject != null) && (subject.constructor === globalThis.Array)) {");for(let r=0;r<this.types.length;r++){let s=this.types[r];t.push("\t\t("+s.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t\t"}))+")(subject["+r+'], path + "['+r+']");')}return t.push("\t\treturn subject as "+this.generateType(Object.assign(Object.assign({},e),{eol:e.eol+"\t\t"}))+";"),t.push("\t}"),t.push('\tthrow "Expected a tuple at " + path + "!";'),t.push("}"),t.join(e.eol)}for(let r of this.types)t.push("\t"+r.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t"})));return"autoguard.Tuple.of("+(t.length>0?e.eol+t.join(","+e.eol)+e.eol:"")+")"}getImports(){let e=new Array;for(let t of this.types)e.push(...t.getImports());return e}static parse(e){return e.newContext(((r,n)=>{var a,i;s.expect(r(),"[");let o=new b;if("]"!==(null===(a=n())||void 0===a?void 0:a.value))for(;;){let a=t.Type.parse(e);if(o.add(a),","!==(null===(i=n())||void 0===i?void 0:i.value))break;s.expect(r(),",")}return s.expect(r(),"]"),o}))}}t.TupleType=b;class v{constructor(){}generateType(e){return"undefined"}generateTypeGuard(e){let t=new Array;return e.standalone?(t.push("(subject, path) => {"),t.push("\tif (subject === undefined) {"),t.push("\t\treturn subject;"),t.push("\t}"),t.push('\tthrow "Expected undefined at " + path + "!";'),t.push("}")):t.push("autoguard.Undefined"),t.join(e.eol)}getImports(){return[]}static parse(e){return e.newContext(((e,t)=>(s.expect(e(),"undefined"),v.INSTANCE)))}}t.UndefinedType=v,v.INSTANCE=new v;class x{constructor(){this.types=new Set}add(e){return this.types.add(e),this}generateType(e){let t=new Array;for(let r of this.types)t.push(r.generateType(e));return t.join(" | ")}generateTypeGuard(e){let t=new Array;if(e.standalone){t.push("(subject, path) => {");for(let r of this.types)t.push("\ttry {"),t.push("\t\treturn ("+r.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t\t"}))+")(subject, path);"),t.push("\t} catch (error) {}");return t.push('\tthrow "Expected a union at " + path + "!";'),t.push("}"),t.join(e.eol)}for(let r of this.types)t.push("\t"+r.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t"})));return"autoguard.Union.of("+e.eol+t.join(","+e.eol)+e.eol+")"}getImports(){let e=new Array;for(let t of this.types)e.push(...t.getImports());return e}static parse(e,...r){if(r.includes("Union"))throw"Recursion prevention!";return e.newContext(((n,a)=>{var i;let o=t.Type.parse(e,...r,"Union"),d=new x;for(d.add(o);"|"===(null===(i=a())||void 0===i?void 0:i.value);){s.expect(n(),"|");let a=t.Type.parse(e,...r,"Union");d.add(a)}return 1===d.types.size?o:d}))}}t.UnionType=x;class S{constructor(){this.types=new Map}getImports(){let e=new Map;for(let[t,r]of this.types){let t=r.getImports();for(let r of t)e.set(r.typename,r.path)}return Array.from(e.entries()).sort(((e,t)=>e[0].localeCompare(t[0]))).map((e=>({path:e[1],typename:e[0]})))}add(e,t){return this.types.set(e,t),this}generateModule(e){let t=new Array;t.push("// This file was auto-generated by @joelek/ts-autoguard. Edit at own risk."),t.push("");let r=this.getImports();for(let e of r)t.push("import { "+e.typename+' } from "'+e.path.join("/")+'";');e.standalone||t.push('import { guards as autoguard } from "@joelek/ts-autoguard";'),t.push("");for(let[r,s]of this.types)t.push("export type "+r+" = "+s.generateType(e)+";"),t.push(""),e.standalone?(t.push("export const "+r+" = {"),t.push('\tas(subject: any, path: string = ""): '+r+" {"),t.push("\t\treturn ("+s.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol+"\t\t"}))+")(subject, path);"),t.push("\t},"),t.push("\tis(subject: any): subject is "+r+" {"),t.push("\t\ttry {"),t.push("\t\t\tthis.as(subject);"),t.push("\t\t} catch (error) {"),t.push("\t\t\treturn false;"),t.push("\t\t}"),t.push("\t\treturn true;"),t.push("\t}"),t.push("};"),t.push("")):(t.push("export const "+r+" = "+s.generateTypeGuard(Object.assign(Object.assign({},e),{eol:e.eol}))+";"),t.push(""));let s=new h;for(let[e,t]of this.types)s.add(e,{type:new g([],e),optional:!1});return t.push("export type Autoguard = "+s.generateType(e)+";"),t.push(""),t.push("export const Autoguard = "+s.generateType(e)+";"),t.push(""),t.join(e.eol)}static parse(e){return e.newContext(((r,n)=>{var a,i,o;s.expect(r(),"{");let d=new S;if("}"!==(null===(a=n())||void 0===a?void 0:a.value))for(;;){let a=s.expect(r(),"IDENTIFIER").value;s.expect(r(),":");let l=t.Type.parse(e);if(null===(i=l.setTypename)||void 0===i||i.call(l,a),d.add(a,l),","!==(null===(o=n())||void 0===o?void 0:o.value))break;s.expect(r(),",")}if(s.expect(r(),"}"),null!=n())throw"Expected end of stream!";return d}))}}t.Schema=S},129:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSerializer=void 0,t.MessageSerializer=class{constructor(e){this.guards=e}deserialize(e,t){let r=JSON.parse(e);if(null==r||r.constructor!==Object||null==r.type||r.type.constructor!==String)throw"Invalid message envelope!";{let e=r.type,s=r.data,n=this.guards[e];if(void 0===n)throw'Unknown message type "'+e+'"!';t(e,n.as(s))}}serialize(e,t){return JSON.stringify({type:e,data:t})}}},329:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.expect=t.Tokenizer=t.Families=void 0,t.Families=["WS","(",")","[","]","{","}","?","|",".","..","/","&","@",",",":","any","boolean","false","null","number","string","true","undefined","IDENTIFIER","NUMBER_LITERAL","STRING_LITERAL"],t.Tokenizer=class{constructor(e){let t={WS:/^([\t\r\n ]+)/ius,"(":/^([\(])/ius,")":/^([\)])/ius,"[":/^([\[])/ius,"]":/^([\]])/ius,"{":/^([\{])/ius,"}":/^([\}])/ius,"?":/^([\?])/ius,"|":/^([\|])/ius,".":/^([\.])/ius,"..":/^([\.][\.])/ius,"/":/^([\/])/ius,"&":/^([&])/ius,"@":/^([@])/ius,",":/^([,])/ius,":":/^([:])/ius,any:/^(any)/ius,boolean:/^(boolean)/ius,false:/^(false)/ius,null:/^(null)/ius,number:/^(number)/ius,string:/^(string)/ius,true:/^(true)/ius,undefined:/^(undefined)/ius,IDENTIFIER:/^([a-z][a-z0-9_]*)/ius,NUMBER_LITERAL:/^(([1-9][0-9]+)|([0-9]))/ius,STRING_LITERAL:/^(["][^"]*["])/ius},r=new Array,s=1,n=1;for(;e.length>0;){let a;for(let r in t){let s=r,n=t[s].exec(e);null!=n&&(null==a||n[1].length>a[1].length)&&(a=[s,n[1]])}if(null==a)throw`Unrecognized token at row ${s}, col ${n}!`;r.push({family:a[0],value:a[1],row:s,col:n}),e=e.slice(a[1].length);let i=a[1].split(/\r?\n/);i.length>1&&(s+=i.length-1,n=1),n+=i[i.length-1].length}this.tokens=r.filter((e=>"WS"!==e.family)),this.offset=0}peek(){return this.tokens[this.offset]}read(){if(this.offset>=this.tokens.length)throw"Unexpectedly reached end of stream!";return this.tokens[this.offset++]}newContext(e){let t=this.offset;try{return e((()=>this.read()),(()=>this.peek()))}catch(e){throw this.offset=t,e}}},t.expect=function(e,t){if(!(Array.isArray(t)?t:[t]).includes(e.family))throw`Unexpected ${e.family} at row ${e.row}, col ${e.col}!`;return e}},611:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCode=t.ReadyState=void 0,(s=t.ReadyState||(t.ReadyState={}))[s.CONNECTING=0]="CONNECTING",s[s.OPEN=1]="OPEN",s[s.CLOSING=2]="CLOSING",s[s.CLOSED=3]="CLOSED",(r=t.StatusCode||(t.StatusCode={}))[r.NORMAL=1e3]="NORMAL",r[r.GOING_AWAY=1001]="GOING_AWAY",r[r.PROTOCOL_ERROR=1002]="PROTOCOL_ERROR",r[r.DATA_TYPE_NOT_ACCEPTED=1003]="DATA_TYPE_NOT_ACCEPTED",r[r.RESERVED_1004=1004]="RESERVED_1004",r[r.RESERVED_1005=1005]="RESERVED_1005",r[r.RESERVED_1006=1006]="RESERVED_1006",r[r.BAD_DATA_TYPE=1007]="BAD_DATA_TYPE",r[r.POLICY_VIOLATION=1008]="POLICY_VIOLATION",r[r.MESSAGE_TOO_BIG=1009]="MESSAGE_TOO_BIG",r[r.CLIENT_EXPECTED_EXTENSION=1010]="CLIENT_EXPECTED_EXTENSION",r[r.SERVER_UNEXPECTED_CONDITION=1011]="SERVER_UNEXPECTED_CONDITION",r[r.RESERVED_1015=1015]="RESERVED_1015"},978:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.routing=r(220)},220:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NamespacedMessageRouter=t.MessageRouter=void 0;class r{constructor(){this.observers=new Map}addObserver(e,t){let r=this.observers.get(e);void 0===r&&(r=new Set,this.observers.set(e,r)),r.add(t)}removeObserver(e,t){let r=this.observers.get(e);void 0!==r&&r.delete(t)}route(e,t){let r=this.observers.get(e);if(void 0!==r)for(let e of r)e(t)}}t.MessageRouter=r,t.NamespacedMessageRouter=class{constructor(){this.routers=new Map}addObserver(e,t,s){let n=this.routers.get(e);void 0===n&&(n=new r,this.routers.set(e,n)),n.addObserver(t,s)}removeObserver(e,t,r){let s=this.routers.get(e);void 0!==s&&s.removeObserver(t,r)}route(e,t,r){let s=this.routers.get(e);void 0!==s&&s.route(t,r)}}}},t={};!function r(s){if(t[s])return t[s].exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,r),n.exports}(224)})();