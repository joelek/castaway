(()=>{"use strict";var t={375:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Union=e.Undefined=e.Tuple=e.StringLiteral=e.String=e.Reference=e.Record=e.Object=e.NumberLiteral=e.Number=e.Null=e.Intersection=e.BooleanLiteral=e.Boolean=e.Array=e.Any=void 0,e.Any={as:(t,e="")=>t,is(t){try{this.as(t)}catch(t){return!1}return!0}},e.Array={of:t=>({as(e,n=""){if(null!=e&&e.constructor===globalThis.Array){for(let i=0;i<e.length;i++)t.as(e[i],n+"["+i+"]");return e}throw"Expected an array at "+n+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}})},e.Boolean={as(t,e=""){if(null!=t&&t.constructor===globalThis.Boolean)return t;throw"Expected a boolean at "+e+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}},e.BooleanLiteral={of:t=>({as(e,n=""){if(e===t)return e;throw"Expected "+t+" at "+n+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}})},e.Intersection={of:(...t)=>({as(e,n=""){for(let i of t)i.as(e,n);return e},is(t){try{this.as(t)}catch(t){return!1}return!0}})},e.Null={as(t,e=""){if(null===t)return t;throw"Expected null at "+e+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}},e.Number={as(t,e=""){if(null!=t&&t.constructor===globalThis.Number)return t;throw"Expected a number at "+e+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}},e.NumberLiteral={of:t=>({as(e,n=""){if(e===t)return e;throw"Expected "+t+" at "+n+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}})},e.Object={of:t=>({as(e,n=""){if(null!=e&&e.constructor===globalThis.Object){for(let i in t)t[i].as(e[i],n+/^([a-z][a-z0-9_]*)$/is.test(i)?"."+i:'["'+i+'"]');return e}throw"Expected an object at "+n+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}})},e.Record={of:t=>({as(e,n=""){if(null!=e&&e.constructor===globalThis.Object){for(let i of globalThis.Object.keys(e))t.as(e[i],n+'["'+i+'"]');return e}throw"Expected a record at "+n+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}})},e.Reference={of:t=>({as:(e,n="")=>t().as(e,n),is:e=>t().is(e)})},e.String={as(t,e=""){if(null!=t&&t.constructor===globalThis.String)return t;throw"Expected a string at "+e+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}},e.StringLiteral={of:t=>({as(e,n=""){if(e===t)return e;throw'Expected "'+t+'" at '+n+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}})},e.Tuple={of:(...t)=>({as(e,n=""){if(null!=e&&e.constructor===globalThis.Array){for(let i=0;i<t.length;i++)t[i].as(e[i],n+"["+i+"]");return e}throw"Expected a tuple at "+n+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}})},e.Undefined={as(t,e=""){if(void 0===t)return t;throw"Expected undefined at "+e+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}},e.Union={of:(...t)=>({as(e,n=""){for(let i of t)try{return i.as(e,n)}catch(t){}throw"Expected a union at "+n+"!"},is(t){try{this.as(t)}catch(t){return!1}return!0}})}},175:(t,e,n)=>{e.m7=e.l8=void 0;const i=n(375);e.l8=i;n(226);const a=n(129);e.m7=a;n(329)},226:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Schema=e.UnionType=e.UndefinedType=e.TupleType=e.StringLiteralType=e.StringType=e.ReferenceType=e.RecordType=e.ObjectType=e.NumberLiteralType=e.NumberType=e.NullType=e.IntersectionType=e.GroupType=e.BooleanLiteralType=e.BooleanType=e.ArrayType=e.AnyType=e.Type=void 0;const i=n(329);e.Type={parse(t,...e){try{return w.parse(t,...e)}catch(t){}try{return l.parse(t,...e)}catch(t){}try{return r.parse(t,...e)}catch(t){}try{return a.parse(t)}catch(t){}try{return d.parse(t)}catch(t){}try{return s.parse(t)}catch(t){}try{return c.parse(t)}catch(t){}try{return p.parse(t)}catch(t){}try{return u.parse(t)}catch(t){}try{return m.parse(t)}catch(t){}try{return v.parse(t)}catch(t){}try{return y.parse(t)}catch(t){}try{return g.parse(t)}catch(t){}try{return b.parse(t)}catch(t){}try{return h.parse(t)}catch(t){}try{return o.parse(t)}catch(t){}try{return f.parse(t)}catch(t){}return t.newContext(((t,e)=>{let n=t();throw`Unexpected ${n.family} at row ${n.row}, col ${n.col}!`}))}};class a{constructor(){}generateType(t){return"any"}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\treturn subject;"),e.push("}")):e.push("autoguard.Any"),e.join(t.eol)}static parse(t){return t.newContext(((t,e)=>(i.expect(t(),"any"),a.INSTANCE)))}}e.AnyType=a,a.INSTANCE=new a;class r{constructor(t){this.type=t}generateType(t){return this.type.generateType(t)+"[]"}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif ((subject != null) && (subject.constructor === globalThis.Array)) {"),e.push("\t\tfor (let i = 0; i < subject.length; i++) {"),e.push("\t\t\t("+this.type.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t\t\t"}))+')(subject[i], path + "[" + i + "]");'),e.push("\t\t}"),e.push("\t\treturn subject;"),e.push("\t}"),e.push('\tthrow "Expected an array at " + path + "!";'),e.push("}")):e.push("autoguard.Array.of("+this.type.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol}))+")"),e.join(t.eol)}static parse(t,...n){if(n.includes("Array"))throw"Recursion prevention!";return t.newContext(((a,d)=>{let s=e.Type.parse(t,...n,"Array");i.expect(a(),"["),i.expect(a(),"]");let o=new r(s);for(;;)try{t.newContext(((t,e)=>{i.expect(t(),"["),i.expect(t(),"]"),o=new r(o)}))}catch(t){break}return o}))}}e.ArrayType=r;class d{constructor(){}generateType(t){return"boolean"}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif ((subject != null) && (subject.constructor === globalThis.Boolean)) {"),e.push("\t\treturn subject as boolean;"),e.push("\t}"),e.push('\tthrow "Expected a boolean at " + path + "!";'),e.push("}")):e.push("autoguard.Boolean"),e.join(t.eol)}static parse(t){return t.newContext(((t,e)=>(i.expect(t(),"boolean"),d.INSTANCE)))}}e.BooleanType=d,d.INSTANCE=new d;class s{constructor(t){this.value=t}generateType(t){return""+this.value}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif (subject === "+this.generateType(Object.assign(Object.assign({},t),{eol:t.eol+"\t"}))+") {"),e.push("\t\treturn subject;"),e.push("\t}"),e.push('\tthrow "Expected '+this.value+' at " + path + "!";'),e.push("}")):e.push("autoguard.BooleanLiteral.of("+this.generateType(Object.assign(Object.assign({},t),{eol:t.eol}))+")"),e.join(t.eol)}static parse(t){return t.newContext(((t,e)=>"true"===i.expect(t(),["true","false"]).family?s.INSTANCE_TRUE:s.INSTANCE_FALSE))}}e.BooleanLiteralType=s,s.INSTANCE_TRUE=new s(!0),s.INSTANCE_FALSE=new s(!1);class o{constructor(t){this.type=t}generateType(t){return"("+this.type.generateType(t)+")"}generateTypeGuard(t){return this.type.generateTypeGuard(t)}static parse(t){return t.newContext(((n,a)=>{i.expect(n(),"(");let r=e.Type.parse(t);return i.expect(n(),")"),new o(r)}))}}e.GroupType=o;class l{constructor(){this.types=new Set}add(t){return this.types.add(t),this}generateType(t){let e=new Array;for(let n of this.types)e.push(n.generateType(t));return e.join(" & ")}generateTypeGuard(t){let e=new Array;if(t.standalone){e.push("(subject, path) => {");for(let n of this.types)e.push("\t("+n.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t"}))+")(subject, path);");return e.push("\treturn subject;"),e.push("}"),e.join(t.eol)}for(let n of this.types)e.push("\t"+n.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t"})));return"autoguard.Intersection.of("+t.eol+e.join(","+t.eol)+t.eol+")"}static parse(t,...n){if(n.includes("Intersection"))throw"Recursion prevention!";return t.newContext(((a,r)=>{var d;let s=e.Type.parse(t,...n,"Intersection"),o=new l;for(o.add(s);"&"===(null===(d=r())||void 0===d?void 0:d.value);){i.expect(a(),"&");let r=e.Type.parse(t,...n,"Intersection");o.add(r)}return 1===o.types.size?s:o}))}}e.IntersectionType=l;class c{constructor(){}generateType(t){return"null"}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif (subject === null) {"),e.push("\t\treturn subject;"),e.push("\t}"),e.push('\tthrow "Expected null at " + path + "!";'),e.push("}")):e.push("autoguard.Null"),e.join(t.eol)}static parse(t){return t.newContext(((t,e)=>(i.expect(t(),"null"),c.INSTANCE)))}}e.NullType=c,c.INSTANCE=new c;class p{constructor(){}generateType(t){return"number"}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif ((subject != null) && (subject.constructor === globalThis.Number)) {"),e.push("\t\treturn subject as number;"),e.push("\t}"),e.push('\tthrow "Expected a number at " + path + "!";'),e.push("}")):e.push("autoguard.Number"),e.join(t.eol)}static parse(t){return t.newContext(((t,e)=>(i.expect(t(),"number"),p.INSTANCE)))}}e.NumberType=p,p.INSTANCE=new p;class u{constructor(t){this.value=t}generateType(t){return""+this.value}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif (subject === "+this.generateType(Object.assign(Object.assign({},t),{eol:t.eol+"\t"}))+") {"),e.push("\t\treturn subject;"),e.push("\t}"),e.push('\tthrow "Expected '+this.value+' at " + path + "!";'),e.push("}")):e.push("autoguard.NumberLiteral.of("+this.generateType(Object.assign(Object.assign({},t),{eol:t.eol}))+")"),e.join(t.eol)}static parse(t){return t.newContext(((t,e)=>{let n=i.expect(t(),"NUMBER_LITERAL").value;return new u(Number.parseInt(n))}))}}e.NumberLiteralType=u;class h{constructor(){this.members=new Map}add(t,e){return this.members.set(t,e),this}generateType(t){if(0===this.members.size)return"{}";let e=new Array;for(let[n,i]of this.members)e.push('\t"'+n+'"'+(i.optional?"?":"")+": "+i.type.generateType(Object.assign(Object.assign({},t),{eol:t.eol+"\t"})));return"{"+(e.length>0?t.eol+e.join(","+t.eol)+t.eol:"")+"}"}generateTypeGuard(t){let e=new Array;if(t.standalone){e.push("(subject, path) => {"),e.push("\tif ((subject != null) && (subject.constructor === globalThis.Object)) {");for(let[n,i]of this.members){let a=i.type;if(i.optional){let t=new w;t.add(y.INSTANCE),t.add(a),a=t}let r=/^([a-z][a-z0-9_]*)$/is.test(n)?'".'+n+'"':'"[\\"'+n+'\\"]"';e.push("\t\t("+a.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t\t"}))+')(subject["'+n+'"], path + '+r+");")}return e.push("\t\treturn subject;"),e.push("\t}"),e.push('\tthrow "Expected an object at " + path + "!";'),e.push("}"),e.join(t.eol)}for(let[n,i]of this.members){let a=i.type;if(i.optional){let t=new w;t.add(y.INSTANCE),t.add(a),a=t}e.push('\t"'+n+'": '+a.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t"})))}return"autoguard.Object.of<"+(null!=this.typename?this.typename:this.generateType(t))+">({"+(e.length>0?t.eol+e.join(","+t.eol)+t.eol:"")+"})"}setTypename(t){this.typename=t}static parse(t){return t.newContext(((n,a)=>{var r,d,s;i.expect(n(),"{");let o=new h;if("}"!==(null===(r=a())||void 0===r?void 0:r.value))for(;;){let r=!1,l=i.expect(n(),["any","boolean","false","null","number","string","true","undefined","IDENTIFIER","STRING_LITERAL"]),c="STRING_LITERAL"===l.family?l.value.slice(1,-1):l.value;"?"===(null===(d=a())||void 0===d?void 0:d.value)&&(n(),r=!0),i.expect(n(),":");let p=e.Type.parse(t);if(o.add(c,{type:p,optional:r}),","!==(null===(s=a())||void 0===s?void 0:s.value))break;i.expect(n(),",")}return i.expect(n(),"}"),o}))}}e.ObjectType=h;class f{constructor(t){this.type=t}generateType(t){return"Record<string, undefined | "+this.type.generateType(t)+">"}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif ((subject != null) && (subject.constructor === globalThis.Object)) {"),e.push("\t\tfor (let key of globalThis.Object.keys(subject)) {"),e.push("\t\t\t("+this.type.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t\t\t"}))+')(subject[key], path + "[\\"" + key + "\\"]");'),e.push("\t\t}"),e.push("\t\treturn subject;"),e.push("\t}"),e.push('\tthrow "Expected a record at " + path + "!";'),e.push("}")):e.push("autoguard.Record.of("+this.type.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol}))+")"),e.join(t.eol)}static parse(t){return t.newContext(((n,a)=>{i.expect(n(),"{");let r=e.Type.parse(t);return i.expect(n(),"}"),new f(r)}))}}e.RecordType=f;class g{constructor(t){this.typename=t}generateType(t){return this.typename}generateTypeGuard(t){return t.standalone?this.typename+".as":"autoguard.Reference.of<"+this.typename+">(() => "+this.typename+")"}static parse(t){return t.newContext(((t,e)=>{var n;"@"===(null===(n=e())||void 0===n?void 0:n.family)&&i.expect(t(),"@");let a=i.expect(t(),"IDENTIFIER").value;return new g(a)}))}}e.ReferenceType=g;class m{constructor(){}generateType(t){return"string"}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif ((subject != null) && (subject.constructor === globalThis.String)) {"),e.push("\t\treturn subject as string;"),e.push("\t}"),e.push('\tthrow "Expected a string at " + path + "!";'),e.push("}")):e.push("autoguard.String"),e.join(t.eol)}static parse(t){return t.newContext(((t,e)=>(i.expect(t(),"string"),m.INSTANCE)))}}e.StringType=m,m.INSTANCE=new m;class v{constructor(t){this.value=t}generateType(t){return'"'+this.value+'"'}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif (subject === "+this.generateType(Object.assign(Object.assign({},t),{eol:t.eol+"\t"}))+") {"),e.push("\t\treturn subject;"),e.push("\t}"),e.push('\tthrow "Expected \\"'+this.value+'\\" at " + path + "!";'),e.push("}")):e.push('autoguard.StringLiteral.of("'+this.value+'")'),e.join(t.eol)}static parse(t){return t.newContext(((t,e)=>{let n=i.expect(t(),"STRING_LITERAL").value;return new v(n.slice(1,-1))}))}}e.StringLiteralType=v;class b{constructor(){this.types=new Array}add(t){return this.types.push(t),this}generateType(t){let e=new Array;for(let n of this.types)e.push("\t"+n.generateType(Object.assign(Object.assign({},t),{eol:t.eol+"\t"})));return"["+(e.length>0?t.eol+e.join(","+t.eol)+t.eol:"")+"]"}generateTypeGuard(t){let e=new Array;if(t.standalone){e.push("(subject, path) => {"),e.push("\tif ((subject != null) && (subject.constructor === globalThis.Array)) {");for(let n=0;n<this.types.length;n++){let i=this.types[n];e.push("\t\t("+i.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t\t"}))+")(subject["+n+'], path + "['+n+']");')}return e.push("\t\treturn subject as "+this.generateType(Object.assign(Object.assign({},t),{eol:t.eol+"\t\t"}))+";"),e.push("\t}"),e.push('\tthrow "Expected a tuple at " + path + "!";'),e.push("}"),e.join(t.eol)}for(let n of this.types)e.push("\t"+n.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t"})));return"autoguard.Tuple.of("+(e.length>0?t.eol+e.join(","+t.eol)+t.eol:"")+")"}static parse(t){return t.newContext(((n,a)=>{var r,d;i.expect(n(),"[");let s=new b;if("]"!==(null===(r=a())||void 0===r?void 0:r.value))for(;;){let r=e.Type.parse(t);if(s.add(r),","!==(null===(d=a())||void 0===d?void 0:d.value))break;i.expect(n(),",")}return i.expect(n(),"]"),s}))}}e.TupleType=b;class y{constructor(){}generateType(t){return"undefined"}generateTypeGuard(t){let e=new Array;return t.standalone?(e.push("(subject, path) => {"),e.push("\tif (subject === undefined) {"),e.push("\t\treturn subject;"),e.push("\t}"),e.push('\tthrow "Expected undefined at " + path + "!";'),e.push("}")):e.push("autoguard.Undefined"),e.join(t.eol)}static parse(t){return t.newContext(((t,e)=>(i.expect(t(),"undefined"),y.INSTANCE)))}}e.UndefinedType=y,y.INSTANCE=new y;class w{constructor(){this.types=new Set}add(t){return this.types.add(t),this}generateType(t){let e=new Array;for(let n of this.types)e.push(n.generateType(t));return e.join(" | ")}generateTypeGuard(t){let e=new Array;if(t.standalone){e.push("(subject, path) => {");for(let n of this.types)e.push("\ttry {"),e.push("\t\treturn ("+n.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t\t"}))+")(subject, path);"),e.push("\t} catch (error) {}");return e.push('\tthrow "Expected a union at " + path + "!";'),e.push("}"),e.join(t.eol)}for(let n of this.types)e.push("\t"+n.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t"})));return"autoguard.Union.of("+t.eol+e.join(","+t.eol)+t.eol+")"}static parse(t,...n){if(n.includes("Union"))throw"Recursion prevention!";return t.newContext(((a,r)=>{var d;let s=e.Type.parse(t,...n,"Union"),o=new w;for(o.add(s);"|"===(null===(d=r())||void 0===d?void 0:d.value);){i.expect(a(),"|");let r=e.Type.parse(t,...n,"Union");o.add(r)}return 1===o.types.size?s:o}))}}e.UnionType=w;class x{constructor(){this.types=new Map}add(t,e){return this.types.set(t,e),this}generateModule(t){let e=new Array;e.push("// This file was auto-generated by @joelek/ts-autoguard. Edit at own risk."),e.push(""),t.standalone||(e.push('import { guards as autoguard } from "@joelek/ts-autoguard";'),e.push(""));for(let[n,i]of this.types)e.push("export type "+n+" = "+i.generateType(t)+";"),e.push(""),t.standalone?(e.push("export const "+n+" = {"),e.push('\tas(subject: any, path: string = ""): '+n+" {"),e.push("\t\treturn ("+i.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol+"\t\t"}))+")(subject, path);"),e.push("\t},"),e.push("\tis(subject: any): subject is "+n+" {"),e.push("\t\ttry {"),e.push("\t\t\tthis.as(subject);"),e.push("\t\t} catch (error) {"),e.push("\t\t\treturn false;"),e.push("\t\t}"),e.push("\t\treturn true;"),e.push("\t}"),e.push("};"),e.push("")):(e.push("export const "+n+" = "+i.generateTypeGuard(Object.assign(Object.assign({},t),{eol:t.eol}))+";"),e.push(""));let n=new h;for(let[t,e]of this.types)n.add(t,{type:new g(t),optional:!1});return e.push("export type Autoguard = "+n.generateType(t)+";"),e.push(""),e.push("export const Autoguard = "+n.generateType(t)+";"),e.push(""),e.join(t.eol)}static parse(t){return t.newContext(((n,a)=>{var r,d,s;i.expect(n(),"{");let o=new x;if("}"!==(null===(r=a())||void 0===r?void 0:r.value))for(;;){let r=i.expect(n(),"IDENTIFIER").value;i.expect(n(),":");let l=e.Type.parse(t);if(null===(d=l.setTypename)||void 0===d||d.call(l,r),o.add(r,l),","!==(null===(s=a())||void 0===s?void 0:s.value))break;i.expect(n(),",")}if(i.expect(n(),"}"),null!=a())throw"Expected end of stream!";return o}))}}e.Schema=x},129:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageSerializer=void 0,e.MessageSerializer=class{constructor(t){this.guards=t}deserialize(t,e){let n=JSON.parse(t);if(null==n||n.constructor!==Object||null==n.type||n.type.constructor!==String)throw"Invalid message envelope!";{let t=n.type,i=n.data,a=this.guards[t];if(void 0===a)throw'Unknown message type "'+t+'"!';e(t,a.as(i))}}serialize(t,e){return JSON.stringify({type:t,data:e})}}},329:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.expect=e.Tokenizer=e.Families=void 0,e.Families=["WS","(",")","[","]","{","}","?","|","&","@",",",":","any","boolean","false","null","number","string","true","undefined","IDENTIFIER","NUMBER_LITERAL","STRING_LITERAL"],e.Tokenizer=class{constructor(t){let e={WS:/^([\t\r\n ]+)/ius,"(":/^([\(])/ius,")":/^([\)])/ius,"[":/^([\[])/ius,"]":/^([\]])/ius,"{":/^([\{])/ius,"}":/^([\}])/ius,"?":/^([\?])/ius,"|":/^([\|])/ius,"&":/^([&])/ius,"@":/^([@])/ius,",":/^([,])/ius,":":/^([:])/ius,any:/^(any)/ius,boolean:/^(boolean)/ius,false:/^(false)/ius,null:/^(null)/ius,number:/^(number)/ius,string:/^(string)/ius,true:/^(true)/ius,undefined:/^(undefined)/ius,IDENTIFIER:/^([a-z][a-z0-9_]*)/ius,NUMBER_LITERAL:/^(([1-9][0-9]+)|([0-9]))/ius,STRING_LITERAL:/^(["][^"]*["])/ius},n=new Array,i=1,a=1;for(;t.length>0;){let r;for(let n in e){let i=n,a=e[i].exec(t);null!=a&&(null==r||a[1].length>r[1].length)&&(r=[i,a[1]])}if(null==r)throw`Unrecognized token at row ${i}, col ${a}!`;n.push({family:r[0],value:r[1],row:i,col:a}),t=t.slice(r[1].length);let d=r[1].split(/\r?\n/);d.length>1&&(i+=d.length-1,a=1),a+=d[d.length-1].length}this.tokens=n.filter((t=>"WS"!==t.family)),this.offset=0}peek(){return this.tokens[this.offset]}read(){if(this.offset>=this.tokens.length)throw"Unexpectedly reached end of stream!";return this.tokens[this.offset++]}newContext(t){let e=this.offset;try{return t((()=>this.read()),(()=>this.peek()))}catch(t){throw this.offset=e,t}}},e.expect=function(t,e){if(!(Array.isArray(e)?e:[e]).includes(t.family))throw`Unexpected ${t.family} at row ${t.row}, col ${t.col}!`;return t}},611:(t,e)=>{var n,i;e.GL=e.kQ=void 0,(i=e.kQ||(e.kQ={}))[i.CONNECTING=0]="CONNECTING",i[i.OPEN=1]="OPEN",i[i.CLOSING=2]="CLOSING",i[i.CLOSED=3]="CLOSED",(n=e.GL||(e.GL={}))[n.NORMAL=1e3]="NORMAL",n[n.GOING_AWAY=1001]="GOING_AWAY",n[n.PROTOCOL_ERROR=1002]="PROTOCOL_ERROR",n[n.DATA_TYPE_NOT_ACCEPTED=1003]="DATA_TYPE_NOT_ACCEPTED",n[n.RESERVED_1004=1004]="RESERVED_1004",n[n.RESERVED_1005=1005]="RESERVED_1005",n[n.RESERVED_1006=1006]="RESERVED_1006",n[n.BAD_DATA_TYPE=1007]="BAD_DATA_TYPE",n[n.POLICY_VIOLATION=1008]="POLICY_VIOLATION",n[n.MESSAGE_TOO_BIG=1009]="MESSAGE_TOO_BIG",n[n.CLIENT_EXPECTED_EXTENSION=1010]="CLIENT_EXPECTED_EXTENSION",n[n.SERVER_UNEXPECTED_CONDITION=1011]="SERVER_UNEXPECTED_CONDITION",n[n.RESERVED_1015=1015]="RESERVED_1015"},978:(t,e,n)=>{e.routing=n(220)},220:(t,e)=>{e.NamespacedMessageRouter=void 0;class n{constructor(){this.observers=new Map}addObserver(t,e){let n=this.observers.get(t);void 0===n&&(n=new Set,this.observers.set(t,n)),n.add(e)}removeObserver(t,e){let n=this.observers.get(t);void 0!==n&&n.delete(e)}route(t,e){let n=this.observers.get(t);if(void 0!==n)for(let t of n)t(e)}}e.NamespacedMessageRouter=class{constructor(){this.routers=new Map}addObserver(t,e,i){let a=this.routers.get(t);void 0===a&&(a=new n,this.routers.set(t,a)),a.addObserver(e,i)}removeObserver(t,e,n){let i=this.routers.get(t);void 0!==i&&i.removeObserver(e,n)}route(t,e,n){let i=this.routers.get(t);void 0!==i&&i.route(e,n)}}}},e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={exports:{}};return t[i](a,a.exports,n),a.exports}(()=>{function t(t,e){return"s"+("00"+t).slice(-2)+"e"+("00"+e).slice(-2)}const e={eng:{title:"English",iso639_1:"en",iso3166_1:"US"},swe:{title:"Swedish",iso639_1:"sv",iso3166_1:"SE"},jpn:{title:"Japanese",iso639_1:"ja",iso3166_1:"JP"}};function i(t){navigator.mediaSession&&(navigator.mediaSession.metadata=new globalThis.MediaMetadata(t))}class a{constructor(t){this.state=t,this.observers=new Array}addObserver(t){let e=new a(t(this.state));return this.observers.push((n=>{e.updateState(t(n))})),e.addObserver.bind(e)}getState(){return this.state}updateState(t){if(t!==this.state){this.state=t;for(let t of this.observers)t(this.state)}}}function r(t,...e){let n=new a(t(...e.map((t=>t.getState())))),i=()=>{n.updateState(t(...e.map((t=>t.getState()))))};for(let t of e)t.addObserver(i);return n}class d{constructor(t){this.state=t,this.observers=new Array}addObserver(t){var e;this.observers.push(t),null===(e=t.onupdate)||void 0===e||e.call(t,this.state)}compute(t){let e=new a(t(this.state));return this.observers.push({onupdate(n){e.updateState(t(n))}}),e.addObserver.bind(e)}getState(){return this.state}append(t){var e,n;this.state.push(t);for(let i of this.observers)null===(e=i.onappend)||void 0===e||e.call(i,t),null===(n=i.onupdate)||void 0===n||n.call(i,this.state)}splice(t){var e,n;if(t<0||t>=this.state.length)throw`Expected an index of at most ${this.state.length}, got ${t}!`;let i=this.state[t];this.state.splice(t,1);for(let a of this.observers)null===(e=a.onsplice)||void 0===e||e.call(a,i,t),null===(n=a.onupdate)||void 0===n||n.call(a,this.state)}update(t){for(let t=this.state.length-1;t>=0;t--)this.splice(t);for(let e of t)this.append(e)}}function s(t){return null==t}function o(t){return null!=t}var l=n(175);const c=l.l8.Object.of({artist_id:l.l8.String,title:l.l8.String}),p=l.l8.Intersection.of(l.l8.Reference.of((()=>c)),l.l8.Object.of({albums:l.l8.Array.of(l.l8.Reference.of((()=>h)))})),u=l.l8.Object.of({album_id:l.l8.String,title:l.l8.String,year:l.l8.Number,artists:l.l8.Array.of(l.l8.Reference.of((()=>c))),artwork:l.l8.Union.of(l.l8.Undefined,l.l8.Reference.of((()=>L)))}),h=l.l8.Intersection.of(l.l8.Reference.of((()=>u)),l.l8.Object.of({discs:l.l8.Array.of(l.l8.Reference.of((()=>g)))})),f=l.l8.Object.of({disc_id:l.l8.String,album:l.l8.Reference.of((()=>u)),number:l.l8.Number}),g=l.l8.Intersection.of(l.l8.Reference.of((()=>f)),l.l8.Object.of({tracks:l.l8.Array.of(l.l8.Reference.of((()=>v)))})),m=l.l8.Object.of({track_id:l.l8.String,title:l.l8.String,disc:l.l8.Reference.of((()=>f)),artists:l.l8.Array.of(l.l8.Reference.of((()=>c))),file:l.l8.Reference.of((()=>P)),number:l.l8.Number,last_stream_date:l.l8.Union.of(l.l8.Undefined,l.l8.Number)}),v=l.l8.Intersection.of(l.l8.Reference.of((()=>m)),l.l8.Object.of({})),b=l.l8.Object.of({user_id:l.l8.String,username:l.l8.String}),y=(l.l8.Intersection.of(l.l8.Reference.of((()=>b)),l.l8.Object.of({})),l.l8.Object.of({playlist_id:l.l8.String,title:l.l8.String,description:l.l8.String,user:l.l8.Reference.of((()=>b))})),w=l.l8.Intersection.of(l.l8.Reference.of((()=>y)),l.l8.Object.of({items:l.l8.Array.of(l.l8.Reference.of((()=>_)))})),x=l.l8.Object.of({number:l.l8.Number,playlist:l.l8.Reference.of((()=>y)),track:l.l8.Reference.of((()=>v))}),_=l.l8.Intersection.of(l.l8.Reference.of((()=>x)),l.l8.Object.of({})),S=l.l8.Object.of({genre_id:l.l8.String,title:l.l8.String}),k=l.l8.Intersection.of(l.l8.Reference.of((()=>S)),l.l8.Object.of({})),E=l.l8.Object.of({movie_id:l.l8.String,title:l.l8.String,year:l.l8.Number,summary:l.l8.String,artwork:l.l8.Union.of(l.l8.Undefined,l.l8.Reference.of((()=>L))),file:l.l8.Reference.of((()=>z)),subtitles:l.l8.Array.of(l.l8.Reference.of((()=>N))),last_stream_date:l.l8.Union.of(l.l8.Undefined,l.l8.Number)}),C=l.l8.Intersection.of(l.l8.Reference.of((()=>E)),l.l8.Object.of({genres:l.l8.Array.of(l.l8.Reference.of((()=>k)))})),O=l.l8.Object.of({show_id:l.l8.String,title:l.l8.String,artwork:l.l8.Union.of(l.l8.Undefined,l.l8.Reference.of((()=>L)))}),T=l.l8.Intersection.of(l.l8.Reference.of((()=>O)),l.l8.Object.of({seasons:l.l8.Array.of(l.l8.Reference.of((()=>A))),genres:l.l8.Array.of(l.l8.Reference.of((()=>k)))})),j=l.l8.Object.of({season_id:l.l8.String,number:l.l8.Number,show:l.l8.Reference.of((()=>O))}),A=l.l8.Intersection.of(l.l8.Reference.of((()=>j)),l.l8.Object.of({episodes:l.l8.Array.of(l.l8.Reference.of((()=>$)))})),I=l.l8.Object.of({episode_id:l.l8.String,title:l.l8.String,summary:l.l8.String,number:l.l8.Number,file:l.l8.Reference.of((()=>z)),subtitles:l.l8.Array.of(l.l8.Reference.of((()=>N))),season:l.l8.Reference.of((()=>j)),year:l.l8.Union.of(l.l8.Undefined,l.l8.Number),last_stream_date:l.l8.Union.of(l.l8.Undefined,l.l8.Number)}),$=l.l8.Intersection.of(l.l8.Reference.of((()=>I)),l.l8.Object.of({})),R=l.l8.Object.of({file_id:l.l8.String,mime:l.l8.String}),P=l.l8.Intersection.of(l.l8.Reference.of((()=>R)),l.l8.Object.of({duration_ms:l.l8.Number})),L=l.l8.Intersection.of(l.l8.Reference.of((()=>R)),l.l8.Object.of({height:l.l8.Number,width:l.l8.Number})),N=l.l8.Intersection.of(l.l8.Reference.of((()=>R)),l.l8.Object.of({language:l.l8.Union.of(l.l8.Undefined,l.l8.String)})),z=l.l8.Intersection.of(l.l8.Reference.of((()=>R)),l.l8.Object.of({duration_ms:l.l8.Number})),D=l.l8.Reference.of((()=>h)),U=l.l8.Reference.of((()=>p)),G=l.l8.Reference.of((()=>v)),M=l.l8.Reference.of((()=>w)),V=l.l8.Reference.of((()=>C)),B=l.l8.Reference.of((()=>T)),q=l.l8.Reference.of((()=>A)),H=l.l8.Reference.of((()=>$)),F=l.l8.Union.of(l.l8.Reference.of((()=>D)),l.l8.Reference.of((()=>U)),l.l8.Reference.of((()=>G)),l.l8.Reference.of((()=>M)),l.l8.Reference.of((()=>V)),l.l8.Reference.of((()=>B)),l.l8.Reference.of((()=>q)),l.l8.Reference.of((()=>H))),W=(l.l8.Union.of(l.l8.Reference.of((()=>G)),l.l8.Reference.of((()=>V)),l.l8.Reference.of((()=>H))),l.l8.Object.of({id:l.l8.String,type:l.l8.String,name:l.l8.String})),X=(l.l8.Object.of({context:l.l8.Union.of(l.l8.Undefined,l.l8.Reference.of((()=>F))),device:l.l8.Union.of(l.l8.Undefined,l.l8.Reference.of((()=>W))),index:l.l8.Union.of(l.l8.Undefined,l.l8.Number),playback:l.l8.Boolean,progress:l.l8.Union.of(l.l8.Undefined,l.l8.Number)}),{SetContext:l.l8.Object.of({context:l.l8.Union.of(l.l8.Undefined,l.l8.Reference.of((()=>F)))}),SetDevice:l.l8.Object.of({device:l.l8.Union.of(l.l8.Undefined,l.l8.Reference.of((()=>W)))}),SetDevices:l.l8.Object.of({devices:l.l8.Array.of(l.l8.Reference.of((()=>W)))}),SetIndex:l.l8.Object.of({index:l.l8.Union.of(l.l8.Undefined,l.l8.Number)}),SetLocalDevice:l.l8.Object.of({device:l.l8.Reference.of((()=>W))}),SetPlayback:l.l8.Object.of({playback:l.l8.Boolean}),SetProgress:l.l8.Object.of({progress:l.l8.Union.of(l.l8.Undefined,l.l8.Number)}),SetToken:l.l8.Object.of({token:l.l8.Union.of(l.l8.Undefined,l.l8.String)})});var Y=n(978),J=n(611);class Q{constructor(t,e,n){this.nextConnectionAttemptDelayFactor=2+Math.random(),this.nextConnectionAttemptDelay=2e3,this.router=new Y.routing.NamespacedMessageRouter,this.serializer=new l.m7.MessageSerializer(n),this.url=t,this.factory=e,this.socket=e(t),this.socket.addEventListener("close",this.onClose.bind(this)),this.socket.addEventListener("error",this.onError.bind(this)),this.socket.addEventListener("message",this.onMessage.bind(this)),this.socket.addEventListener("open",this.onOpen.bind(this))}onClose(t){this.router.route("sys","disconnect",{})}onError(t){setTimeout((()=>{this.socket=this.factory(this.url),this.socket.addEventListener("close",this.onClose.bind(this)),this.socket.addEventListener("error",this.onError.bind(this)),this.socket.addEventListener("message",this.onMessage.bind(this)),this.socket.addEventListener("open",this.onOpen.bind(this))}),this.nextConnectionAttemptDelay),this.nextConnectionAttemptDelay=Math.round(this.nextConnectionAttemptDelay*this.nextConnectionAttemptDelayFactor)}onMessage(t){let e=t.data;this.serializer.deserialize(e,((t,e)=>{this.router.route("sys","message",{type:t,data:e}),this.router.route("app",t,e)}))}onOpen(t){this.nextConnectionAttemptDelay=2e3,this.router.route("sys","connect",{})}addEventListener(t,e,n){this.router.addObserver(t,e,n)}close(){this.socket.close()}removeEventListener(t,e,n){this.router.addObserver(t,e,n)}send(t,e){if(this.socket.readyState===J.kQ.OPEN)this.socket.send(this.serializer.serialize(t,e));else{let n=()=>{this.socket.removeEventListener("open",n),this.socket.send(this.serializer.serialize(t,e))};this.socket.addEventListener("open",n)}}}class K{constructor(t){this.content=t}render(){let t=document.createTextNode("");return this.content instanceof a?this.content.addObserver((e=>{t.textContent=e})):t.textContent=this.content,t}}class Z{constructor(t){let e=t.split(".");this.tag=e[0],this.attributes=new Map,this.children=new Array,this.bound=new Map,this.bound2=new Map,this.listeners=new Map;let n=e.slice(1).join(" ");""!==n&&this.attributes.set("class",n)}add(...t){for(let e of t)null!=e&&this.children.push(e);return this}bind(t,e){return this.bound.set(t,e),this}bind2(t,e){return this.bound2.set(t,e),this}on(t,e){let n=this.listeners.get(t);return null==n&&(n=new Array,this.listeners.set(t,n)),n.push((t=>{t.preventDefault(),t.stopPropagation(),e(t)})),this}render(){let t=["svg","path"].indexOf(this.tag)>=0?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",e=document.createElementNS(t,this.tag);for(let[t,n]of this.listeners)for(let i of n)e.addEventListener(t,i);for(let[t,n]of this.attributes)e.setAttribute(t,n);for(let[t,n]of this.bound)n((n=>{e.setAttribute(t,""+n)}));for(let[t,n]of this.bound2)n.addObserver((n=>{e.setAttribute(t,""+n)})),"input"===this.tag&&"value"===t&&e.addEventListener("change",(()=>{n.updateState(e.value)}));for(let t of this.children)e.appendChild(t.render());return this.array&&this.array.addObserver({onupdate:t=>{if(this.renderer){for(;e.firstChild;)e.firstChild.remove();for(let n of t)e.appendChild(this.renderer(n).render())}}}),e}repeat(t,e){return this.array=t,this.renderer=e,this}set(t,e=""){return this.attributes.set(t,e),this}}function tt(t){return new Z(t)}function et(t){return new K(t)}function nt(t,e=" · "){let n=[];for(let i of t)n.push(i),n.push(et(e));return n.pop(),n}function it(t){let e=function(t){let e=Math.floor(t/1e3);t-=1e3*e;let n=Math.floor(e/60);e-=60*n;let i=Math.floor(n/60);n-=60*i;let a=Math.floor(i/24);return i-=24*a,{ms:t,s:e,m:n,h:i,d:a}}(t);return e.d>=10?e.d+"d":e.d>=1?`${e.d}d ${e.h}h`:e.h>=10?e.h+"h":e.h>=1?`${e.h}h ${e.m}m`:e.m>=10?e.m+"m":e.m>=1?`${e.m}m ${e.s}s`:e.s+"s"}const at="rgb(159, 159, 159)";class rt{constructor(){}for(t,e="1-1"){let n=new a(!1);return tt("div.image-box.image-box--aspect-"+e).add(s(t)?void 0:tt("img.image-box__image").bind("data-opaque",n.addObserver((t=>t))).set("src",t).on("load",(()=>{n.updateState(!0)})))}forPoster(t){return this.for(t,"2-3")}forSquare(t){return this.for(t,"1-1")}forVideo(t){return this.for(t,"16-9")}static makeStyle(){return tt("style").add(et('\n\t.image-box {\n\t\tbackground-color: rgb(0, 0, 0);\n\t\tposition: relative;\n\t}\n\n\t.image-box--aspect-1-1 {\n\t\tpadding-bottom: 100%;\n\t}\n\n\t.image-box--aspect-16-9 {\n\t\tpadding-bottom: 56.25%;\n\t}\n\n\t.image-box--aspect-2-3 {\n\t\tpadding-bottom: 150%;\n\t}\n\n\t.image-box__image {\n\t\theight: 100%;\n\t\tobject-fit: contain;\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t}\n\n\t[data-opaque] {\n\t\topacity: 0;\n\t\ttransition: opacity 0.1s;\n\t}\n\n\t[data-opaque="true"] {\n\t\topacity: 1;\n\t}\n'))}}class dt{constructor(t){this.navigator=t}for(t,e){return tt("a").set("href",t).on("click",(()=>{this.navigator(t)})).add(et(e))}forAlbum(t){return this.for(`audio/albums/${t.album_id}/`,t.title)}forArtist(t){return this.for(`audio/artists/${t.artist_id}/`,t.title)}forDisc(t){return this.for(`audio/discs/${t.disc_id}/`,`Disc ${t.number} of ${t.album.title}`)}forEpisode(t){return this.for(`video/episodes/${t.episode_id}/`,t.title)}forGenre(t){return this.for(`video/genres/${t.genre_id}/`,t.title)}forMovie(t){return this.for(`video/movies/${t.movie_id}/`,t.title)}forPlaylist(t){return this.for(`audio/playlists/${t.playlist_id}/`,t.title)}forSeason(t){return this.for(`video/seasons/${t.season_id}/`,`Season ${t.number} of ${t.show.title}`)}forShow(t){return this.for(`video/shows/${t.show_id}/`,t.title)}forTrack(t){return this.for(`audio/tracks/${t.track_id}/`,t.title)}forUser(t){return this.for(`users/${t.user_id}/`,t.username)}static makeStyle(){return tt("style").add(et(""))}}const st=`\n\t.entity-row {\n\t\talign-items: start;\n\t\tbackground-color: rgb(47, 47, 47);\n\t\tborder-radius: 2px;\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-template-columns: 72px 1fr;\n\t\toverflow: hidden;\n\t}\n\n\t.entity-row__artwork {\n\t\tposition: relative;\n\t}\n\n\t.entity-row__metadata {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t}\n\n\t.entity-row__titles {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\t.entity-row__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.entity-row__subtitle {\n\t\tcolor: ${at};\n\t\tfont-size: 12px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.entity-row__tags {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-columns: minmax(auto, max-content);\n\t\tgrid-auto-flow: column;\n\t}\n\n\t.entity-row__tag {\n\t\tbackground-color: rgb(63, 63, 63);\n\t\tborder-radius: 2px;\n\t\tcolor: ${at};\n\t\tfont-size: 12px;\n\t\tpadding: 4px 8px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.entity-row__tag--accent {\n\t\tbackground-color: rgb(223, 79, 127);\n\t\tcolor: rgb(255, 255, 255);\n\t}\n`;class ot{constructor(t,e){this.EntityLink=t,this.ImageBox=e}forAlbum(t){let e=0;for(let n of t.discs)for(let t of n.tracks)e+=t.file.duration_ms;return tt("div.entity-row").add(tt("div.entity-row__artwork").add(this.ImageBox.forSquare(s(t.artwork)?void 0:`/files/${t.artwork.file_id}/?token=null`))).add(tt("div.entity-row__metadata").add(tt("div.entity-row__titles").add(tt("div.entity-row__title").add(et(t.title))).add(tt("div.entity-row__subtitle").add(...nt(t.artists.map((t=>this.EntityLink.forArtist(t))))))).add(tt("div.entity-row__tags").add(tt("div.entity-row__tag").add(et("Album"))).add(tt("div.entity-row__tag").add(et(""+t.year))).add(tt("div.entity-row__tag").add(et(it(e))))))}static makeStyle(){return tt("style").add(et(st))}}var lt,ct=function(t,e,n,i){return new(n||(n=Promise))((function(a,r){function d(t){try{o(i.next(t))}catch(t){r(t)}}function s(t){try{o(i.throw(t))}catch(t){r(t)}}function o(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(d,s)}o((i=i.apply(t,e||[])).next())}))};const pt=new rt;document.head.appendChild(rt.makeStyle().render());const ut=new dt(pe);document.head.appendChild(dt.makeStyle().render());const ht=new ot(ut,pt);document.head.appendChild(ot.makeStyle().render());let ft=new class{constructor(t,e=(t=>new WebSocket(t))){this.estimatedProgress=new a(void 0),this.estimatedProgressTimestamp=new a(void 0),this.token=new a(void 0),this.localDevice=new a(void 0),this.devices=new d(new Array),this.device=new a(void 0),this.isDeviceLocal=new a(!1),this.isDeviceRemote=new a(!1),this.context=new a(void 0),this.contextPath=new a(void 0),this.flattenedContext=new a(void 0),this.lastIndex=new a(void 0),this.lastEntry=new a(void 0),this.lastLocalEntry=new a(void 0),this.currentIndex=new a(void 0),this.currentEntry=new a(void 0),this.currentLocalEntry=new a(void 0),this.nextIndex=new a(void 0),this.nextEntry=new a(void 0),this.nextLocalEntry=new a(void 0),this.playback=new a(!1),this.progress=new a(void 0),this.localPlayback=new a(!1),this.canPlayLast=new a(!1),this.canPlayCurrent=new a(!1),this.canPlayNext=new a(!1),this.isCurrentEntryVideo=new a(!1),this.tsc=new Q(t,e,X),this.context.addObserver((t=>{if(o(t))if(D.is(t)){let e=[],n=t;for(let t of n.discs)e.push(...t.tracks);this.flattenedContext.updateState(e)}else if(U.is(t)){let e=[],n=t;for(let t of n.albums)for(let n of t.discs)e.push(...n.tracks);this.flattenedContext.updateState(e)}else if(H.is(t)){let e=[],n=t;e.push(n),this.flattenedContext.updateState(e)}else if(V.is(t)){let e=[],n=t;e.push(n),this.flattenedContext.updateState(e)}else if(M.is(t)){let e=[],n=t;for(let t of n.items)e.push(t.track);this.flattenedContext.updateState(e)}else if(q.is(t)){let e=[],n=t;e.push(...n.episodes),this.flattenedContext.updateState(e)}else if(B.is(t)){let e=[],n=t;for(let t of n.seasons)e.push(...t.episodes);this.flattenedContext.updateState(e)}else{if(!G.is(t))throw"Expected code to be unreachable!";{let e=[],n=t;e.push(n),this.flattenedContext.updateState(e)}}}));{let t=()=>{let t=this.context.getState(),e=this.currentIndex.getState();if(o(t)&&o(e)){if(D.is(t)){let n=0,i=e,a=t.discs;for(let t=0;t<a.length;t++){let e=a[t].tracks.length;if(!(i>=e))break;n+=1,i-=e}return this.contextPath.updateState([t.album_id,t.discs[n].disc_id,t.discs[n].tracks[i].track_id])}if(U.is(t)){let n=0,i=0,a=e,r=t.albums;t:for(let t=0;t<r.length;t++){let e=r[t].discs;for(let t=0;t<e.length;t++){let n=e[t].tracks.length;if(!(a>=n))break t;i+=1,a-=n}n+=1,i=0}return this.contextPath.updateState([t.artist_id,t.albums[n].album_id,t.albums[n].discs[i].disc_id,t.albums[n].discs[i].tracks[a].track_id])}if(H.is(t))return this.contextPath.updateState([t.episode_id]);if(V.is(t))return this.contextPath.updateState([t.movie_id]);if(M.is(t)){let n=e;return this.contextPath.updateState([t.playlist_id,t.items[n].track.track_id])}if(B.is(t)){let n=0,i=e,a=t.seasons;for(let t=0;t<a.length;t++){let e=a[t].episodes.length;if(!(i>=e))break;n+=1,i-=e}return this.contextPath.updateState([t.show_id,t.seasons[n].season_id,t.seasons[n].episodes[i].episode_id])}if(q.is(t)){let n=e;return this.contextPath.updateState([t.season_id,t.episodes[n].episode_id])}if(G.is(t))return this.contextPath.updateState([t.track_id]);throw"Expected code to be unreachable!"}this.contextPath.updateState(void 0)};this.context.addObserver(t),this.currentIndex.addObserver(t)}this.lastEntry.addObserver((t=>{this.canPlayLast.updateState(o(t))})),this.currentEntry.addObserver((t=>{this.canPlayCurrent.updateState(o(t))})),this.nextEntry.addObserver((t=>{this.canPlayNext.updateState(o(t))})),this.progress.addObserver((t=>{this.estimatedProgress.updateState(t),this.estimatedProgressTimestamp.updateState(Date.now())})),this.playback.addObserver((t=>{let e=this.estimatedProgress.getState(),n=this.estimatedProgressTimestamp.getState(),i=Date.now();t||o(e)&&o(n)&&this.estimatedProgress.updateState(e+(i-n)/1e3),this.estimatedProgressTimestamp.updateState(i)})),this.estimatedProgress.addObserver((t=>{console.log("Estimated progress to "+(null!=t?t:0))}));{let t=()=>{let t=this.playback.getState(),e=this.isDeviceLocal.getState();this.localPlayback.updateState(e&&t)};this.playback.addObserver(t),this.isDeviceLocal.addObserver(t)}{let t=()=>{let t=this.lastEntry.getState(),e=this.isDeviceLocal.getState();this.lastLocalEntry.updateState(e?t:void 0)};this.lastEntry.addObserver(t),this.isDeviceLocal.addObserver(t)}{let t=()=>{let t=this.currentEntry.getState(),e=this.isDeviceLocal.getState();this.currentLocalEntry.updateState(e?t:void 0)};this.currentEntry.addObserver(t),this.isDeviceLocal.addObserver(t)}{let t=()=>{let t=this.nextEntry.getState(),e=this.isDeviceLocal.getState();this.nextLocalEntry.updateState(e?t:void 0)};this.nextEntry.addObserver(t),this.isDeviceLocal.addObserver(t)}{let t=()=>{let t=this.localDevice.getState(),e=this.device.getState();return o(t)&&o(e)&&t.id===e.id?this.isDeviceLocal.updateState(!0):this.isDeviceLocal.updateState(!1)};this.localDevice.addObserver(t),this.device.addObserver(t)}{let t=()=>{let t=this.localDevice.getState(),e=this.device.getState();return o(t)&&o(e)&&t.id!==e.id?this.isDeviceRemote.updateState(!0):this.isDeviceRemote.updateState(!1)};this.localDevice.addObserver(t),this.device.addObserver(t)}{let t=()=>{let t=this.flattenedContext.getState(),e=this.currentIndex.getState();if(o(t)&&o(e)){let n=e-1;if(n>=0&&n<t.length)return this.lastIndex.updateState(n)}return this.lastIndex.updateState(void 0)};this.flattenedContext.addObserver(t),this.currentIndex.addObserver(t)}{let t=()=>{let t=this.flattenedContext.getState(),e=this.currentIndex.getState();if(o(t)&&o(e)){let n=e+1;if(n>=0&&n<t.length)return this.nextIndex.updateState(n)}return this.nextIndex.updateState(void 0)};this.flattenedContext.addObserver(t),this.currentIndex.addObserver(t)}{let t=()=>{let t=this.flattenedContext.getState(),e=this.lastIndex.getState();return o(t)&&o(e)?this.lastEntry.updateState(t[e]):this.lastEntry.updateState(void 0)};this.flattenedContext.addObserver(t),this.lastIndex.addObserver(t)}{let t=()=>{let t=this.flattenedContext.getState(),e=this.currentIndex.getState();return o(t)&&o(e)&&e>=0&&e+0<t.length?this.currentEntry.updateState(t[e+0]):this.currentEntry.updateState(void 0)};this.flattenedContext.addObserver(t),this.currentIndex.addObserver(t)}{let t=()=>{let t=this.flattenedContext.getState(),e=this.nextIndex.getState();return o(t)&&o(e)?this.nextEntry.updateState(t[e]):this.nextEntry.updateState(void 0)};this.flattenedContext.addObserver(t),this.nextIndex.addObserver(t)}this.token.addObserver((t=>{this.tsc.send("SetToken",{token:t})})),this.tsc.addEventListener("app","SetLocalDevice",(t=>{this.localDevice.updateState(t.device)})),this.tsc.addEventListener("app","SetDevices",(t=>{this.devices.update(t.devices)})),this.tsc.addEventListener("app","SetContext",(t=>{this.context.updateState(t.context)})),this.tsc.addEventListener("app","SetDevice",(t=>{this.device.updateState(t.device)})),this.tsc.addEventListener("app","SetIndex",(t=>{this.currentIndex.updateState(t.index)})),this.tsc.addEventListener("app","SetPlayback",(t=>{this.playback.updateState(t.playback)})),this.tsc.addEventListener("app","SetProgress",(t=>{this.progress.updateState(t.progress)})),this.tsc.addEventListener("app","SetToken",(t=>{this.token.updateState(t.token)}))}play(t,e){this.tsc.send("SetContext",{context:t}),this.tsc.send("SetIndex",{index:e}),this.resume()}authenticate(t){this.tsc.send("SetToken",{token:t})}close(){this.tsc.close()}last(){let t=this.lastIndex.getState();o(t)&&(this.currentIndex.updateState(t),this.tsc.send("SetIndex",{index:t}))}next(){let t=this.nextIndex.getState();o(t)&&(this.currentIndex.updateState(t),this.tsc.send("SetIndex",{index:t}))}pause(){this.playback.updateState(!1),this.tsc.send("SetPlayback",{playback:!1})}playAlbum(t,e,n){let i=0;if(o(e)){let a=t.discs;if(e<0||e>=a.length)throw`Expected ${e} to be a number between 0 and ${a.length}!`;if(i+=a.slice(0,e).reduce(((t,e)=>t+e.tracks.length),0),o(n)){let t=a[e].tracks;if(n<0||n>=t.length)throw`Expected ${n} to be a number between 0 and ${t.length}!`;i+=n}}return this.play(t,i)}playArtist(t,e,n,i){let a=0;if(o(e)){let r=t.albums;if(e<0||e>=r.length)throw`Expected ${e} to be a number between 0 and ${r.length}!`;if(a+=r.slice(0,e).reduce(((t,e)=>t+e.discs.reduce(((t,e)=>t+e.tracks.length),0)),0),o(n)){let t=r[e].discs;if(n<0||n>=t.length)throw`Expected ${n} to be a number between 0 and ${t.length}!`;if(a+=t.slice(0,n).reduce(((t,e)=>t+e.tracks.length),0),o(i)){let e=t[n].tracks;if(i<0||i>=e.length)throw`Expected ${i} to be a number between 0 and ${e.length}!`;a+=i}}}return this.play(t,a)}playEpisode(t){this.play(t,0)}playMovie(t){this.play(t,0)}playPlaylist(t,e){let n=0;if(o(e)){let i=t.items;if(e<0||e>=i.length)throw`Expected ${e} to be a number between 0 and ${i.length}!`;n+=e}return this.play(t,n)}playSeason(t,e){let n=0;if(o(e)){let i=t.episodes;if(e<0||e>=i.length)throw`Expected ${e} to be a number between 0 and ${i.length}!`;n+=e}return this.play(t,n)}playShow(t,e,n){let i=0;if(o(e)){let a=t.seasons;if(e<0||e>=a.length)throw`Expected ${e} to be a number between 0 and ${a.length}!`;if(i+=a.slice(0,e).reduce(((t,e)=>t+e.episodes.length),0),o(n)){let t=a[e].episodes;if(n<0||n>=t.length)throw`Expected ${n} to be a number between 0 and ${t.length}!`;i+=n}}return this.play(t,i)}playTrack(t){this.play(t,0)}resume(){this.playback.updateState(!0),this.tsc.send("SetPlayback",{playback:!0})}seek(t){this.tsc.send("SetProgress",{progress:t})}toggle(){this.playback.getState()?this.pause():this.resume()}transfer(t){this.tsc.send("SetDevice",{device:t})}}(`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}/sockets/context/?type=browser&name=Browser`),gt=document.createElement("video"),mt=document.createElement("video"),vt=document.createElement("video");mt.addEventListener("ended",(()=>{ft.next()}));let bt=new a(!0);mt.addEventListener("loadeddata",(()=>{bt.updateState(!1)})),ft.playback.addObserver((t=>{mt.autoplay=t})),mt.addEventListener("playing",(()=>{ft.isCurrentEntryVideo.updateState(mt.videoWidth>0&&mt.videoHeight>0)}));{let t=()=>ct(void 0,void 0,void 0,(function*(){var t;bt.getState()||(mt.currentTime=null!==(t=ft.progress.getState())&&void 0!==t?t:0)}));ft.progress.addObserver(t),bt.addObserver(t)}{let t=()=>ct(void 0,void 0,void 0,(function*(){if(!bt.getState())if(ft.playback.getState())try{yield mt.play()}catch(t){}else mt.pause()}));ft.playback.addObserver(t),bt.addObserver(t)}{let t=()=>{let t=ft.canPlayLast.getState(),e=ft.canPlayCurrent.getState(),n=ft.canPlayNext.getState();!function(t){if(navigator.mediaSession)for(let e in t)navigator.mediaSession.setActionHandler(e,t[e])}({play:e?ft.resume.bind(ft):void 0,pause:e?ft.pause.bind(ft):void 0,previoustrack:t?ft.last.bind(ft):void 0,nexttrack:n?ft.next.bind(ft):void 0})};ft.canPlayLast.addObserver(t),ft.canPlayCurrent.addObserver(t),ft.canPlayNext.addObserver(t)}let yt=new a(""),wt=new a("");ft.currentEntry.addObserver((t=>{if(o(t))if($.is(t)){let e=t,n=e.season.show;yt.updateState(e.title),wt.updateState(n.title),i({title:e.title})}else if(C.is(t)){let e=t;yt.updateState(e.title),wt.updateState(""),i({title:e.title,artwork:s(e.artwork)?void 0:[{src:`/files/${e.artwork.file_id}/?token=${Tt}`,sizes:`${e.artwork.width}x${e.artwork.height}`,type:e.artwork.mime}]})}else{if(!v.is(t))throw"Expected code to be unreachable!";{let e=t,n=e.disc.album;yt.updateState(e.title),wt.updateState(e.artists.map((t=>t.title)).join(" · ")),i({title:e.title,artist:e.artists.map((t=>t.title)).join(" · "),album:n.title,artwork:s(n.artwork)?void 0:[{src:`/files/${n.artwork.file_id}/?token=${Tt}`,sizes:`${n.artwork.width}x${n.artwork.height}`,type:n.artwork.mime}]})}}else yt.updateState(""),wt.updateState(""),i({})}));{let t=()=>{let t=ft.lastLocalEntry.getState(),e=ft.token.getState();s(t)||s(e)?gt.src="":gt.src=`/files/${t.file.file_id}/?token=${e}`};ft.lastLocalEntry.addObserver(t),ft.token.addObserver(t)}{let t=()=>{var t;bt.updateState(!0);let n=ft.currentLocalEntry.getState(),i=ft.token.getState();if(s(n)||s(i))mt.src="";else{for(mt.src=`/files/${n.file.file_id}/?token=${i}`;null!=mt.lastChild;)mt.removeChild(mt.lastChild);if(C.is(n)||$.is(n)){let a=n.subtitles,r=null!==(t=a.find((t=>"swe"===t.language)))&&void 0!==t?t:a.find((t=>"eng"===t.language));for(let t of a){let n=document.createElement("track");if(n.src=`/files/${t.file_id}/?token=${i}`,o(t.language)){let i=e[t.language];o(i)&&(n.label=i.title,n.srclang=i.iso639_1,n.kind="subtitles"),t===r&&n.setAttribute("default","")}mt.appendChild(n)}}}};ft.currentLocalEntry.addObserver(t),ft.token.addObserver(t)}{let t=()=>{let t=ft.nextLocalEntry.getState(),e=ft.token.getState();s(t)||s(e)?gt.src="":gt.src=`/files/${t.file.file_id}/?token=${e}`};ft.nextLocalEntry.addObserver(t),ft.token.addObserver(t)}const xt="rgb(223, 79, 127)";let _t=document.createElement("style");_t.innerText=`\n\t::-webkit-scrollbar {\n\t\tbackground-color: transparent;\n\t\theight: 8px;\n\t\twidth: 8px;\n\t}\n\n\t::-webkit-scrollbar-corner {\n\t\tbackground-color: transparent;\n\t}\n\n\t::-webkit-scrollbar-thumb {\n\t\tbackground-color: rgba(255, 255, 255, 0.125);\n\t\tborder-radius: 4px;\n\t}\n\n\t* {\n\t\tborder: none;\n\t\tfont-size: 0px;\n\t\tmargin: 0px;\n\t\tline-height: 1;\n\t\toutline: none;\n\t\tpadding: 0px;\n\t}\n\n\ta {\n\t\tcolor: inherit;\n\t\tdisplay: inline-block;\n\t\tfont-size: inherit;\n\t\ttext-decoration: none;\n\t\ttransition: color 0.1s;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\ta:hover {\n\t\t\tcolor: rgb(255, 255, 255);\n\t\t}\n\t}\n\n\thtml {\n\t\theight: 100%;\n\t}\n\n\tbody {\n\t\theight: 100%;\n\t}\n\n\t.page-header {\n\t\tbackground-color: ${xt};\n\t}\n\n\t.page-header__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tcursor: pointer;\n\t\tfont-family: "Pacifico", cursive;\n\t\tfont-size: 32px;\n\t\ttransform-origin: left;\n\t\ttransition: transform 0.1s;\n\t\twhite-space: nowrap;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\t.page-header__title:hover {\n\t\t\ttransform: scale(1.25);\n\t\t}\n\t}\n\n\t[data-hide="true"] {\n\t\tdisplay: none !important;\n\t}\n\n\t[data-grid] {\n\t\tmargin: 0px auto;\n\t\tmax-width: 960px;\n\t\tmin-width: 160px;\n\t\tpadding: 16px;\n\t}\n\n\t[data-cell] {\n\t\tdisplay: inline-block;\n\t\tvertical-align: top;\n\t}\n\n\t@media all and (max-width: 319px) {\n\t\t[data-cell^="1:"] {\n\t\t\twidth: 16.66%;\n\t\t}\n\n\t\t[data-cell^="2:"] {\n\t\t\twidth: 33.33%;\n\t\t}\n\n\t\t[data-cell^="3:"] {\n\t\t\twidth: 50.00%;\n\t\t}\n\n\t\t[data-cell^="4:"] {\n\t\t\twidth: 66.66%;\n\t\t}\n\n\t\t[data-cell^="5:"] {\n\t\t\twidth: 83.33%;\n\t\t}\n\n\t\t[data-cell^="6:"] {\n\t\t\twidth: 100.00%;\n\t\t}\n\t}\n\n\t@media all and (min-width: 320px) and (max-width: 479px) {\n\t\t[data-cell*=":1:"] {\n\t\t\twidth: 16.66%;\n\t\t}\n\n\t\t[data-cell*=":2:"] {\n\t\t\twidth: 33.33%;\n\t\t}\n\n\t\t[data-cell*=":3:"] {\n\t\t\twidth: 50.00%;\n\t\t}\n\n\t\t[data-cell*=":4:"] {\n\t\t\twidth: 66.66%;\n\t\t}\n\n\t\t[data-cell*=":5:"] {\n\t\t\twidth: 83.33%;\n\t\t}\n\n\t\t[data-cell*=":6:"] {\n\t\t\twidth: 100.00%;\n\t\t}\n\t}\n\n\t@media all and (min-width: 480px) {\n\t\t[data-cell$=":1"] {\n\t\t\twidth: 16.66%;\n\t\t}\n\n\t\t[data-cell$=":2"] {\n\t\t\twidth: 33.33%;\n\t\t}\n\n\t\t[data-cell$=":3"] {\n\t\t\twidth: 50.00%;\n\t\t}\n\n\t\t[data-cell$=":4"] {\n\t\t\twidth: 66.66%;\n\t\t}\n\n\t\t[data-cell$=":5"] {\n\t\t\twidth: 83.33%;\n\t\t}\n\n\t\t[data-cell$=":6"] {\n\t\t\twidth: 100.00%;\n\t\t}\n\t}\n\n\t[data-flex] {\n\t\t--gap: max(0px, calc(var(--gap, 0px) - 4px));\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tflex-wrap: wrap;\n\t}\n\n\t[data-flex="x"] {\n\t\tflex-direction: row;\n\t\twidth: 100%;\n\t}\n\n\t[data-flex="x"] > :not(:first-child) {\n\t\tmargin-left: var(--gap, 0px);\n\t}\n\n\t[data-flex="y"] {\n\t\tflex-direction: column;\n\t\theight: 100%;\n\t}\n\n\t[data-flex="y"] > :not(:first-child) {\n\t\tmargin-top: var(--gap, 0px);\n\t}\n\n\t[data-wrap="false"] {\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\tbody {\n\t\tbackground-color: rgb(31, 31, 31);\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-family: "Nunito", sans-serif;\n\t\toverflow: hidden;\n\t\tuser-select: none;\n\t}\n\n\tbody ::selection {\n\t\tbackground-color: ${xt};\n\t\tcolor: rgb(255, 255, 255);\n\t}\n\n\tbutton {\n\t\tbackground-color: ${xt};\n\t\tborder-radius: 4px;\n\t\tcolor: rgb(255, 255, 255);\n\t\tcursor: pointer;\n\t\tfont-size: 16px;\n\t\tpadding: 8px 16px;\n\t\ttransition: transform 0.1s;\n\t}\n\n\tbutton[data-enabled="false"] {\n\t\tbackground-color: rgb(79, 79, 79);\n\t\tcursor: default;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\tbutton:not([data-enabled="false"]):hover {\n\t\t\ttransform: scale(1.25);\n\t\t}\n\n\t\tbutton:active {\n\t\t\ttransform: none;\n\t\t}\n\t}\n\n\tinput {\n\t\tbackground-color: rgb(63, 63, 63);\n\t\tborder-radius: 4px;\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t\tpadding: 8px;\n\t}\n\n\t.group {\n\t\tbackground-color: rgb(63, 63, 63);\n\t\tborder-radius: 2px;\n\t\tmargin: 8px;\n\t\tpadding: 4px;\n\t}\n\n\t.group > * {\n\t\tmargin: 4px;\n\t}\n\n\t.slider-widget {\n\t\tpadding: 4px;\n\t}\n\n\t.slider-widget__indicator {\n\t\tpadding: 4px;\n\t\tborder-radius: 4px;\n\t\tbackground-color: rgb(31, 31, 31);\n\t}\n\n\t.slider-widget__knob-wrapper {\n\t\tposition: relative;\n\t}\n\n\t.slider-widget__knob {\n\t\tbox-shadow: 0px 0px 8px 0px rgba(0, 0, 0, 0.5);\n\t\twidth: 16px;\n\t\theight: 16px;\n\t\tborder-radius: 50%;\n\t\tbackground-color: rgb(255, 255, 255);\n\t\tposition: absolute;\n\t\ttop: 0%;\n\t\tleft: 0%;\n\t\tmargin-top: -8px;\n\t\tmargin-left: -8px;\n\t}\n\n\t.watched::before {\n\t\tcontent: "·";\n\t\tcolor: ${xt};\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t.media-widget {\n\t\tbackground-color: rgb(47, 47, 47);\n\t\tborder-radius: 2px;\n\t\tcursor: pointer;\n\t\tdisplay: grid;\n\t\tgap: 0px;\n\t\tgrid-auto-flow: row;\n\t\tgrid-auto-rows: max-content;\n\t\toverflow: hidden;\n\t}\n\n\t.media-widget__artwork {\n\t\tbackground-color: rgb(0, 0, 0);\n\t\tbackground-size: cover;\n\t\tpadding-bottom: 100%;\n\t\tposition: relative;\n\t}\n\n\t.media-widget__images {\n\t\tdisplay: grid;\n\t\tgrid-auto-flow: column;\n\t\theight: 100%;\n\t\tjustify-content: start;\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t}\n\n\t.media-widget__image {\n\t\theight: 100%;\n\t}\n\n\t.media-widget__metadata {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-auto-flow: row;\n\t\tgrid-auto-rows: max-content;\n\t\tpadding: 16px;\n\t}\n\n\t.media-widget__titles {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-flow: row;\n\t\tgrid-auto-rows: max-content;\n\t}\n\n\t.media-widget__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.media-widget__subtitle {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 12px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.media-widget__tags {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-columns: minmax(auto, min-content);\n\t\tgrid-auto-flow: column;\n\t}\n\n\t.media-widget__description {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 12px;\n\t\tline-height: 1.25;\n\t\tword-break: break-word;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\t.media-tag {\n\t\tbackground-color: rgb(63, 63, 63);\n\t\tborder-radius: 2px;\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 12px;\n\t\tpadding: 4px 8px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.media-tag--accent {\n\t\tbackground-color: ${xt};\n\t\tcolor: rgb(255, 255, 255);\n\t}\n\n\n\n\n\n\n\n\t.content {\n\t\tbox-sizing: border-box;\n\t\tmargin: 0px auto;\n\t\tmax-width: 960px;\n\t\tpadding: 32px;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t.text-header {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 20px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.text-paragraph {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 16px;\n\t\tline-height: 1.25;\n\t\tword-break: break-word;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t.entity-header {\n\t\talign-items: start;\n\t\tdisplay: grid;\n\t\tgap: 32px;\n\t\tgrid-template-columns: repeat(auto-fit, minmax(240px, max-content));\n\t}\n\n\t.entity-header__artwork {\n\t\tborder-radius: 2px;\n\t\toverflow: hidden;\n\t\tposition: relative;\n\t}\n\n\t.entity-header__metadata {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-auto-rows: max-content;\n\t}\n\n\t.entity-header__titles {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-flow: row;\n\t\tgrid-auto-rows: max-content;\n\t}\n\n\t.entity-header__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 24px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.entity-header__subtitle {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 20px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.entity-header__tags {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-columns: minmax(auto, min-content);\n\t\tgrid-auto-flow: column;\n\t}\n\n\t.entity-header__description {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 16px;\n\t\tline-height: 1.25;\n\t\tword-break: break-word;\n\t}\n\n\n\n\n\n\n\n\t.playback-button {\n\t\tbackground-color: rgb(255, 255, 255);\n\t\tborder-radius: 50%;\n\t\tbox-shadow: 0px 0px 8px 4px rgba(0, 0, 0, 0.25);\n\t\tcursor: pointer;\n\t\tfill: rgb(31, 31, 31);\n\t\tmargin: 16px;\n\t\tpadding: 8px;\n\t\tposition: absolute;\n\t\t\tbottom: 0%;\n\t\t\tright: 0%;\n\t\ttransition: transform 0.1s;\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\t.playback-button:not([data-enabled="false"]):hover {\n\t\t\ttransform: scale(1.25);\n\t\t}\n\n\t\t.playback-button:active {\n\t\t\ttransform: none;\n\t\t}\n\t}\n\n\n\n\n\n\n\t.media-grid {\n\t\tdisplay: grid;\n\t\tgap: 24px;\n\t\tgrid-auto-flow: row;\n\t\tgrid-auto-rows: max-content;\n\t}\n\n\t.media-grid__header {\n\n\t}\n\n\t.media-grid__content {\n\t\tdisplay: grid;\n\t\tgap: 24px;\n\t\tgrid-auto-flow: row;\n\t\tgrid-auto-rows: max-content;\n\t\tgrid-template-columns: repeat(auto-fill, minmax(240px, 1fr));\n\t}\n\n\n\n\n\n\n\n\n\n\n\t.playlist {\n\t\tdisplay: grid;\n\t\tgap: 24px;\n\t\tgrid-auto-flow: row;\n\t\tgrid-auto-rows: max-content;\n\t}\n\n\t.playlist__header {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t}\n\n\t.playlist__tags {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-columns: minmax(auto, min-content);\n\t\tgrid-auto-flow: column;\n\t}\n\n\t.playlist__content {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-auto-flow: row;\n\t\tgrid-auto-rows: max-content;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\t.playlist-item {\n\t\tborder-left: 4px solid transparent;\n\t\tcursor: pointer;\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-flow: row;\n\t\tgrid-auto-rows: max-content;\n\t\tmargin-left: -16px;\n\t\tpadding-left: 12px;\n\t}\n\n\t.playlist-item[data-playing="true"] {\n\t\tborder-color: ${xt};\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\t.playlist-item:hover {\n\t\t\tborder-color: rgb(255, 255, 255);\n\t\t}\n\t}\n\n\t.playlist-item__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.playlist-item__subtitle {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 12px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.playlist-item__tags {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-columns: minmax(auto, min-content);\n\t}\n\n\n\n\n\n\n\n\t.login-modal {\n\t\tbox-sizing: border-box;\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-auto-rows: min-content;\n\t\theight: 100%;\n\t\tmargin: 0px auto;\n\t\tmax-width: 320px;\n\t\tpadding: 32px;\n\t\twidth: 100%;\n\t}\n\n\t.login-modal__form {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\n\n\n\n\n\n\n\t.modal-container {\n\t\tbackground-color: rgb(31, 31, 31);\n\t\theight: 100%;\n\t\tposition: absolute;\n\t\twidth: 100%;\n\t\tz-index: 1;\n\t}\n\n\t.modal-container__content {\n\t\tmargin: 0px auto;\n\t\theight: 100%;\n\t\tmax-width: 480px;\n\t\toverflow: hidden;\n\t\twidth: 100%;\n\t}\n\n\n\n\n\n\n\n\n\n\t.device-selector {\n\t\tpadding: 32px;\n\t}\n\n\t.device-selector__devices {\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t}\n\n\t.device-selector__device {\n\t\talign-items: center;\n\t\tcursor: pointer;\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-template-columns: min-content 1fr;\n\t}\n\n\t.device-selector__device-info {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\t.device-selector__device-name {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.device-selector__device-type {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 12px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\t.media-player {\n\t\talign-items: center;\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-template-columns: 1fr min-content;\n\t}\n\n\t.media-player__metadata {\n\t\tcursor: pointer;\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\t.media-player__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.media-player__subtitle {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 12px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.media-player__controls {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-auto-columns: minmax(auto, min-content);\n\t\tgrid-auto-flow: column;\n\t}\n\n\n\n\n\n\n\n\n\t.icon-button {\n\t\tbackground-color: rgb(255, 255, 255);\n\t\tborder-radius: 50%;\n\t\tbox-shadow: 0px 0px 8px 4px rgba(0, 0, 0, 0.25);\n\t\tcursor: pointer;\n\t\tfill: rgb(31, 31, 31);\n\t\tpadding: 8px;\n\t\ttransition: transform 0.1s;\n\t}\n\n\t.icon-button[data-enabled="false"] {\n\t\tbackground-color: rgb(79, 79, 79);\n\t\tcursor: default;\n\t}\n\n\t.icon-button[data-active="true"] {\n\t\tbackground-color: ${xt};\n\t\tfill: rgb(255, 255, 255);\n\t}\n\n\t@media (hover: hover) and (pointer: fine) {\n\t\t.icon-button:not([data-enabled="false"]):hover {\n\t\t\ttransform: scale(1.25);\n\t\t}\n\n\t\t.icon-button:active {\n\t\t\ttransform: none;\n\t\t}\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\t.app {\n\t\tdisplay: grid;\n\t\theight: 100%;\n\t\tgrid-template-rows: min-content 1fr min-content;\n\t}\n\n\t.app__header {\n\t\tbackground-color: ${xt};\n\t\tbox-shadow: 0px 0px 8px 4px rgba(0, 0, 0, 0.25);\n\t\tz-index: 1;\n\t}\n\n\t.app__content {\n\t\theight: auto;\n\t\toverflow: hidden;\n\t\tposition: relative;\n\t\tz-index: 0;\n\t}\n\n\t.app__devices {\n\t\tbackground-color: ${xt};\n\t}\n\n\t.app__devices-container {\n\t\tcursor: pointer;\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t\tgrid-template-columns: min-content 1fr;\n\t}\n\n\t.app__devices-icon {\n\t\tfill: rgb(255, 255, 255);\n\t}\n\n\t.app__devices-text {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-size: 16px;\n\t}\n\n\t.app__navigation {\n\t\tbackground-color: rgb(47, 47, 47);\n\t\tbox-shadow: 0px 0px 8px 4px rgba(0, 0, 0, 0.25);\n\t\tposition: relative;\n\t\tz-index: 1;\n\t}\n\n\n\n\n\n\n\t.scroll-container {\n\t\theight: 100%;\n\t\toverflow: auto;\n\t\twidth: 100%;\n\t}\n\n\n\n\n\n\n\n\n\t.access-token {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n\n\t.access-token__title {\n\t\tcolor: rgb(255, 255, 255);\n\t\tfont-family: "Space Mono", monospace;\n\t\tfont-size: 16px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\t.access-token__subtitle {\n\t\tcolor: rgb(159, 159, 159);\n\t\tfont-size: 12px;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t}\n\n\n\n\n\n\n\n\n\n\n\n\t.login-modal {\n\t\tbox-sizing: border-box;\n\t\tdisplay: grid;\n\t\tgap: 16px;\n\t\tgrid-auto-rows: min-content;\n\t\theight: 100%;\n\t\tmargin: 0px auto;\n\t\tmax-width: 320px;\n\t\tpadding: 32px;\n\t\twidth: 100%;\n\t}\n\n\t.login-modal__form {\n\t\tdisplay: grid;\n\t\tgap: 8px;\n\t}\n`,document.head.appendChild(_t);let St=(t,e,n)=>{let i=new XMLHttpRequest;i.addEventListener("readystatechange",(()=>{i.readyState===XMLHttpRequest.DONE&&n(i.status,JSON.parse(i.responseText))})),i.open("POST",t,!0),i.send(JSON.stringify(e))};const kt=new a(!1);ft.devices.addObserver({onupdate:t=>{t.length<2&&kt.updateState(!1)}});const Et=new a(!1);{let t=()=>{let t=ft.isDeviceLocal.getState(),e=ft.isCurrentEntryVideo.getState();Et.updateState(t&&e)};ft.isDeviceLocal.addObserver(t),ft.isCurrentEntryVideo.addObserver(t)}const Ct=new a(!1),Ot=new a(!1);{let t=()=>{Ot.updateState(Ct.getState()||kt.getState())};Ct.addObserver(t),kt.addObserver(t)}let Tt,jt,At=new a(null!==(lt=localStorage.getItem("token"))&&void 0!==lt?lt:void 0);function It(t,e){return ct(this,void 0,void 0,(function*(){return new Promise(((n,i)=>{St("/api/auth/",{username:t,password:e},((t,e)=>{jt=t>=200&&t<300,jt?(Tt=e.token,localStorage.setItem("token",Tt)):(localStorage.removeItem("token"),Tt=void 0),At.updateState(Tt),n(Tt)}))}))}))}At.addObserver((t=>{Tt=t,ft.authenticate(Tt)}));let $t=document.createElement("div"),Rt=document.createElement("div");Et.addObserver((t=>{t?$t.style.setProperty("display","none"):$t.style.removeProperty("display")}));let Pt=tt("div.app").render();document.body.appendChild(Pt);let Lt=tt("div.app__header").add(tt("div.content").set("style","padding: 24px").add(tt("div.page-header__title").add(et("Orbit")).on("click",(()=>{pe("/")})))).render();Pt.appendChild(Lt),Rt.setAttribute("class","app__content"),Pt.appendChild(Rt);let Nt=new a(""),zt=new a("");Rt.appendChild(tt("div.login-modal").bind("data-hide",Ct.addObserver((t=>!t))).add(tt("div.login-modal__form").add(tt("input.login-modal__username").bind2("value",Nt).set("type","text").set("placeholder","Username...")).add(tt("input.login-modal__password").bind2("value",zt).set("type","password").set("placeholder","Password...").on("keyup",(t=>ct(void 0,void 0,void 0,(function*(){"Enter"===t.key&&null!=(yield It(Nt.getState(),zt.getState()))&&Ct.updateState(!1)})))))).add(tt("button").add(et("Login")).on("click",(()=>ct(void 0,void 0,void 0,(function*(){null!=(yield It(Nt.getState(),zt.getState()))&&Ct.updateState(!1)}))))).render());let Dt=new d([]);{let t=()=>{let t=ft.devices.getState(),e=ft.device.getState(),n=ft.localDevice.getState();Dt.update(t.map((t=>Object.assign(Object.assign({},t),{active:(null==e?void 0:e.id)===t.id,local:(null==n?void 0:n.id)===t.id}))))};ft.devices.addObserver({onupdate:t}),ft.device.addObserver(t),ft.localDevice.addObserver(t)}let Ut=tt("div.modal-container").bind("data-hide",Ot.addObserver((t=>!t))).add(tt("div.modal-container__content").add(tt("div.device-selector").bind("data-hide",kt.addObserver((t=>!t))).add(tt("div.device-selector__devices").repeat(Dt,(t=>tt("div.device-selector__device").add(Yt().set("data-active",""+t.active).add(Ft())).add(tt("div.device-selector__device-info").add(tt("div.device-selector__device-name").add(et(t.name))).add(tt("div.device-selector__device-type").add(et(t.local?"local":"remote")))).on("click",(()=>{ft.transfer({id:t.id,type:t.type,name:t.name}),kt.updateState(!1)})))))));Rt.appendChild(Ut.render());let Gt,Mt=tt("div.scroll-container").render(),Vt=tt("div.scroll-container__sentinel").set("style","height: 1px").render();function Bt(t){o(Gt)&&qt.unobserve(Vt),Gt=t,o(Gt)&&qt.observe(Vt)}Mt.appendChild($t),Mt.appendChild(Vt),Rt.appendChild(Mt);let qt=new IntersectionObserver((t=>ct(void 0,void 0,void 0,(function*(){if(console.log(t),!s(Gt))for(let e of t)if(e.target===Vt&&e.isIntersecting){yield Gt(),Bt(Gt);break}}))),{root:Mt}),Ht=tt("div.app__navigation").render();const Ft=()=>tt("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(tt("path").set("d","M1,16c-0.552,0-1-0.447-1-1v-1.829c0-0.325,0.158-0.629,0.423-0.816C0.594,12.233,0.795,12.171,1,12.171c0.112,0,0.226,0.019,0.334,0.058c1.144,0.405,2.032,1.294,2.438,2.438c0.109,0.306,0.062,0.646-0.125,0.911C3.458,15.843,3.153,16,2.829,16H1z")).add(tt("path").set("d","M6.929,16c-0.498,0-0.919-0.365-0.99-0.857c-0.376-2.616-2.465-4.706-5.081-5.081C0.366,9.99,0,9.568,0,9.071l0-2.016C0,6.771,0.121,6.5,0.333,6.31C0.517,6.145,0.754,6.055,1,6.055c0.037,0,0.073,0.002,0.11,0.006c4.604,0.511,8.317,4.224,8.829,8.829c0.031,0.282-0.059,0.565-0.248,0.777C9.5,15.879,9.229,16,8.945,16H6.929z")).add(tt("path").set("d","M12.962,16c-0.522,0-0.957-0.402-0.997-0.924C11.518,9.229,6.771,4.482,0.924,4.035C0.403,3.996,0,3.561,0,3.038l0-2.005c0-0.276,0.115-0.541,0.316-0.73C0.502,0.129,0.747,0.033,1,0.033c0.022,0,0.044,0,0.066,0.002c7.968,0.527,14.373,6.933,14.899,14.898c0.018,0.276-0.079,0.548-0.268,0.75C15.508,15.886,15.243,16,14.967,16H12.962z")),Wt=()=>tt("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(tt("path").set("d","M3,15.268c-0.173,0-0.345-0.045-0.5-0.134C2.19,14.955,2,14.625,2,14.268V1.732c0-0.357,0.19-0.688,0.5-0.866C2.655,0.776,2.827,0.732,3,0.732s0.345,0.044,0.5,0.134l10.855,6.269c0.31,0.179,0.5,0.509,0.5,0.866s-0.19,0.688-0.5,0.866L3.5,15.134C3.345,15.223,3.173,15.268,3,15.268z")),Xt=()=>tt("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(tt("path").set("d","M3,16c-0.552,0-1-0.447-1-1V1c0-0.552,0.448-1,1-1h2c0.552,0,1,0.448,1,1v14c0,0.553-0.448,1-1,1H3z")).add(tt("path").set("d","M11,16c-0.553,0-1-0.447-1-1V1c0-0.552,0.447-1,1-1h2c0.553,0,1,0.448,1,1v14c0,0.553-0.447,1-1,1H11z")),Yt=()=>tt("div.icon-button");let Jt=tt("div.content").set("style","padding: 16px;").add(tt("div.media-player").add(tt("div.media-player__metadata").add(tt("div.media-player__title").add(et(yt))).add(tt("div.media-player__subtitle").add(et(wt))).on("click",(t=>{let e=ft.context.getState();if(o(e))if(h.is(e))pe(`audio/albums/${e.album_id}/`);else if(p.is(e))pe(`audio/artists/${e.artist_id}/`);else if($.is(e))pe(`video/episodes/${e.episode_id}/`);else if(C.is(e))pe(`video/movies/${e.movie_id}/`);else if(w.is(e))pe(`audio/playlists/${e.playlist_id}/`);else if(A.is(e))pe(`video/seasons/${e.season_id}/`);else if(T.is(e))pe(`video/shows/${e.show_id}/`);else{if(!v.is(e))throw"Expected code to be unreachable!";pe(`audio/tracks/${e.track_id}/`)}}))).add(tt("div.media-player__controls").add(Yt().bind("data-hide",ft.devices.compute((t=>t.length<2))).add(Ft()).on("click",(()=>{kt.updateState(!kt.getState())}))).add(Yt().bind("data-enabled",ft.canPlayLast.addObserver((t=>t))).add(tt("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(tt("path").set("d","M15,15.268c-0.173,0-0.346-0.045-0.5-0.134L3.645,8.867c-0.31-0.179-0.5-0.509-0.5-0.866s0.19-0.688,0.5-0.866L14.5,0.866c0.154-0.089,0.327-0.134,0.5-0.134s0.346,0.044,0.5,0.134C15.81,1.044,16,1.375,16,1.732v12.536c0,0.357-0.19,0.688-0.5,0.866C15.346,15.223,15.173,15.268,15,15.268z")).add(tt("path").set("d","M1,16c-0.552,0-1-0.447-1-1V1c0-0.552,0.448-1,1-1h2c0.552,0,1,0.448,1,1v14c0,0.553-0.448,1-1,1H1z"))).on("click",(()=>{ft.last()}))).add(Yt().bind("data-enabled",ft.canPlayCurrent.addObserver((t=>t))).add(Wt().bind("data-hide",ft.playback.addObserver((t=>!0===t)))).add(Xt().bind("data-hide",ft.playback.addObserver((t=>!1===t)))).on("click",(()=>{ft.toggle()}))).add(Yt().bind("data-enabled",ft.canPlayNext.addObserver((t=>t))).add(tt("svg").set("width","12px").set("height","12px").set("viewBox","0 0 16 16").add(tt("path").set("d","M1,15.268c-0.173,0-0.345-0.045-0.5-0.134C0.19,14.955,0,14.625,0,14.268V1.732c0-0.357,0.19-0.688,0.5-0.866C0.655,0.776,0.827,0.732,1,0.732s0.345,0.044,0.5,0.134l10.855,6.269c0.31,0.179,0.5,0.509,0.5,0.866s-0.19,0.688-0.5,0.866L1.5,15.134C1.345,15.223,1.173,15.268,1,15.268z")).add(tt("path").set("d","M13,16c-0.553,0-1-0.447-1-1V1c0-0.552,0.447-1,1-1h2c0.553,0,1,0.448,1,1v14c0,0.553-0.447,1-1,1H13z"))).on("click",(()=>{ft.next()}))))).render();Pt.appendChild(Ht),Ht.appendChild(Jt),mt.setAttribute("playsinline",""),mt.setAttribute("preload","auto"),mt.style.setProperty("height","100%"),mt.style.setProperty("width","100%"),gt.setAttribute("preload","auto"),gt.style.setProperty("display","none"),vt.setAttribute("preload","auto"),vt.style.setProperty("display","none");let Qt=tt("div").bind("data-hide",Et.addObserver((t=>!t))).set("style","background-color: rgb(0, 0, 0); height: 100%;").render();Mt.appendChild(Qt),Qt.appendChild(mt),Qt.appendChild(gt),Qt.appendChild(vt);const Kt=t=>tt("div.media-tag").add(et(t));function Zt(t,e){let n=0;for(let e of t.discs)for(let t of e.tracks)n+=t.file.duration_ms;let i=t.title,a=["Album",""+t.year,it(n)],d=r((e=>!!o(e)&&e[e.length-3]===t.album_id),ft.contextPath),l=r(((t,e)=>t&&e),d,ft.playback);return tt("div.media-widget").on("click",(e=>{pe(`audio/albums/${t.album_id}/`)})).add(tt("div.media-widget__artwork").add(s(t.artwork)?void 0:tt("div.media-widget__images").add(tt("img.media-widget__image").set("src",`/files/${t.artwork.file_id}/?token=${Tt}`))).add(tt("div.playback-button").add(Wt().bind("data-hide",l.addObserver((t=>t)))).add(Xt().bind("data-hide",l.addObserver((t=>!t)))).on("click",(t=>{l.getState()?ft.pause():d.getState()?ft.resume():e()})))).add(tt("div.media-widget__metadata").add(tt("div.media-widget__titles").add(tt("div.media-widget__title").add(et(i))).add(tt("div.media-widget__subtitle").add(...nt(t.artists.map((t=>ut.forArtist(t))))))).add(tt("div.media-widget__tags").add(...a.map(Kt))))}function te(t){return tt("div.media-widget").add(tt("div.media-widget__artwork")).add(tt("div.media-widget__metadata").add(tt("div.media-widget__titles").add(tt("div.media-widget__title").add(et(t.title)))).add(tt("div.media-widget__tags").add(Kt("Video Genre")))).on("click",(()=>{pe(`video/genres/${t.genre_id}/`)}))}function ee(t,e){let n=["Show",it(t.seasons.reduce(((t,e)=>t+e.episodes.reduce(((t,e)=>t+e.file.duration_ms),0)),0))],i=r((e=>!!o(e)&&e[e.length-3]===t.show_id),ft.contextPath),a=r(((t,e)=>t&&e),i,ft.playback);return tt("div.media-widget").on("click",(()=>{pe(`video/shows/${t.show_id}/`)})).add(tt("div.media-widget__artwork").set("style","padding-bottom: 150%;").add(s(t.artwork)?void 0:tt("div.media-widget__images").add(tt("img.media-widget__image").set("src",`/files/${t.artwork.file_id}/?token=${Tt}`))).add(tt("div.playback-button").add(Wt().bind("data-hide",a.addObserver((t=>t)))).add(Xt().bind("data-hide",a.addObserver((t=>!t)))).on("click",(t=>{a.getState()?ft.pause():i.getState()?ft.resume():e()})))).add(tt("div.media-widget__metadata").add(tt("div.media-widget__titles").add(tt("div.media-widget__title").add(et(t.title)))).add(tt("div.media-widget__tags").add(...n.map(Kt))))}function ne(t,e=(()=>ft.playMovie(t))){let n=t.title,i=["Movie",""+t.year,it(t.file.duration_ms)],a=r((e=>!!o(e)&&e[e.length-1]===t.movie_id),ft.contextPath),d=r(((t,e)=>t&&e),a,ft.playback);return tt("div.media-widget").on("click",(()=>{pe(`video/movies/${t.movie_id}/`)})).add(tt("div.media-widget__artwork").set("style","padding-bottom: 150%;").add(s(t.artwork)?void 0:tt("div.media-widget__images").add(tt("img.media-widget__image").set("src",`/files/${t.artwork.file_id}/?token=${Tt}`))).add(tt("div.playback-button").add(Wt().bind("data-hide",d.addObserver((t=>t)))).add(Xt().bind("data-hide",d.addObserver((t=>!t)))).on("click",(t=>{d.getState()?ft.pause():a.getState()?ft.resume():e()})))).add(tt("div.media-widget__metadata").add(tt("div.media-widget__titles").add(tt("div.media-widget__title").add(et(n))).add(tt("div.media-widget__subtitle").add(...nt(t.genres.map((t=>ut.forGenre(t))))))).add(tt("div.media-widget__tags").add(...i.map(Kt))))}function ie(t,...e){return tt("div.media-grid").add(t?tt("div.media-grid__header").add(ae(et(t))):void 0).add(tt("div.media-grid__content").add(...e))}function ae(t){return tt("div.text-header").add(t)}const re=(t,e=[],n=[],i,a,r)=>tt("div.entity-header").add(tt("div.entity-header__artwork").add(i).add(a)).add(tt("div.entity-header__metadata").add(tt("div.entity-header__titles").add(tt("div.entity-header__title").add(et(t))).add(0===e.length?void 0:tt("div.entity-header__subtitle").add(...nt(e)))).add(tt("div.entity-header__tags").add(...n.map(Kt))).add(function(t,e){if(o(t))return(t=>tt("div.entity-header__description").add(et(t)))(t)}(r)));function de(t){var e,n;return{movie_id:t.movie_id,title:t.title,year:t.year,summary:null!==(e=t.summary)&&void 0!==e?e:"",artwork:s(t.poster_file_id)?void 0:{file_id:t.poster_file_id,mime:"image/jpg",height:720,width:1080},file:{file_id:t.movie_parts[0].file_id,mime:"video/mp4",duration_ms:t.movie_parts[0].duration},subtitles:t.movie_parts[0].subtitles.map((t=>{var e;return{file_id:t.file_id,mime:"text/vtt",language:null!==(e=t.language)&&void 0!==e?e:void 0}})),last_stream_date:null!==(n=t.movie_parts[0].streamed)&&void 0!==n?n:void 0,genres:[]}}function se(t){let e={show_id:t.show_id,title:t.title};return Object.assign(Object.assign({},e),{seasons:t.seasons.map((t=>{let n={season_id:t.season_id,number:t.number,show:e};return Object.assign(Object.assign({},n),{episodes:t.episodes.map((t=>{var e,i,a;return{episode_id:t.episode_id,title:t.title,summary:null!==(e=t.summary)&&void 0!==e?e:"",number:t.number,file:{file_id:t.file_id,mime:"video/mp4",duration_ms:t.duration},subtitles:t.subtitles.map((t=>{var e;return{file_id:t.file_id,mime:"text/vtt",language:null!==(e=t.language)&&void 0!==e?e:void 0}})),season:n,year:null!==(i=t.year)&&void 0!==i?i:void 0,last_stream_date:null!==(a=t.streamed)&&void 0!==a?a:void 0}}))})})),genres:[]})}function oe(t){let e={album_id:t.album_id,title:t.title,year:t.year,artists:t.artists.map((t=>({artist_id:t.artist_id,title:t.title}))),artwork:s(t.cover_file_id)?void 0:{file_id:t.cover_file_id,mime:"image/jpg",height:1080,width:1080}};return Object.assign(Object.assign({},e),{discs:t.discs.map((t=>{let n={disc_id:t.disc_id,album:e,number:t.number};return Object.assign(Object.assign({},n),{tracks:t.tracks.map((t=>({track_id:t.track_id,title:t.title,disc:n,artists:t.artists.map((t=>({artist_id:t.artist_id,title:t.title}))),file:{file_id:t.file_id,mime:"audio/mp4",duration_ms:t.duration},number:t.number,last_stream_date:void 0})))})}))})}function le(t){let e={artist_id:t.artist_id,title:t.title};return Object.assign(Object.assign({},e),{albums:t.albums.map(oe)})}let ce=e=>{for(Bt();null!==$t.lastChild;)$t.removeChild($t.lastChild);let n;if(null!==(n=/^audio[/]albums[/]([0-9a-f]{32})[/]/.exec(e)))St(`/api/audio/albums/${n[1]}/`,{},((t,e)=>{let n=oe(e),i=r((t=>!!o(t)&&t[t.length-3]===n.album_id),ft.contextPath),a=r(((t,e)=>t&&e),i,ft.playback),d=0;for(let t of e.discs)for(let e of t.tracks)d+=e.duration;let l=tt("div.content").add(re(e.title,e.artists.map((t=>ut.forArtist(t))),["Album",""+e.year,it(d)],pt.forSquare(s(n.artwork)?void 0:`/files/${n.artwork.file_id}/?token=${Tt}`),tt("div.playback-button").add(Wt().bind("data-hide",a.addObserver((t=>t)))).add(Xt().bind("data-hide",a.addObserver((t=>!t)))).on("click",(t=>{a.getState()?ft.pause():i.getState()?ft.resume():ft.playAlbum(n)})))).add(ht.forAlbum(n)).render();$t.appendChild(l);for(let t=0;t<e.discs.length;t++){let e=n.discs[t];if(e.tracks.length>0){let i=tt("div.content").add(tt("div.playlist").add(tt("div.playlist__header").add(ae(et("Disc "+e.number)))).add(tt("div.playlist__content").add(...e.tracks.map(((e,i)=>tt("div.playlist-item").bind("data-playing",ft.contextPath.addObserver((t=>!s(t)&&t[t.length-3]===e.disc.album.album_id&&t[t.length-2]===e.disc.disc_id&&t[t.length-1]===e.track_id))).add(tt("div.playlist-item__title").add(et(e.title))).add(tt("div.playlist-item__subtitle").add(et(e.artists.map((t=>t.title)).join(" · ")))).on("click",(()=>{ft.playAlbum(n,t,i)})))))));$t.appendChild(i.render())}}}));else if(null!==(n=/^audio[/]albums[/]/.exec(e)))St("/api/audio/albums/",{},((t,e)=>{let n=e.albums.map(oe);$t.appendChild(tt("div").add(tt("div.content").add(ae(et("Albums")))).add(tt("div.content").add(ie(void 0,...n.map((t=>Zt(t,(()=>ft.playAlbum(t)))))))).render())}));else if(null!==(n=/^audio[/]artists[/]([0-9a-f]{32})[/]/.exec(e)))St(`/api/audio/artists/${n[1]}/`,{},((t,e)=>{let n=le(e),i=r((t=>!!o(t)&&t[t.length-4]===n.artist_id),ft.contextPath),a=r(((t,e)=>t&&e),i,ft.playback),d=0;for(let t of e.albums)for(let e of t.discs)for(let t of e.tracks)d+=t.duration;let s=tt("div.content").add(re(e.title,[],["Artist",it(d)],pt.forSquare(),tt("div.playback-button").add(Wt().bind("data-hide",a.addObserver((t=>t)))).add(Xt().bind("data-hide",a.addObserver((t=>!t)))).on("click",(()=>{a.getState()?ft.pause():i.getState()?ft.resume():ft.playArtist(n)})),void 0)).render();if($t.appendChild(s),n.albums.length>0){let t=tt("div.content").render();$t.appendChild(t);let e=tt("div.media-grid").add(tt("div.media-grid__header").add(ae(et("Discography")))).render();t.appendChild(e);let i=tt("div.media-grid__content").add(...n.albums.map(((t,e)=>Zt(t,(()=>ft.playArtist(n,e)))))).render();e.appendChild(i)}if(e.appearances.length>0){let t=tt("div.content").render();$t.appendChild(t);let n=tt("div.media-grid").add(tt("div.media-grid__header").add(ae(et("Appearances")))).render();t.appendChild(n);let i=tt("div.media-grid__content").render();n.appendChild(i);for(let t of e.appearances){let e=oe(t),n=Zt(e,(()=>ft.playAlbum(e))).render();i.appendChild(n)}}}));else if(null!==(n=/^audio[/]artists[/]/.exec(e)))St("/api/audio/artists/",{},((t,e)=>{let n=e.artists.map(le);$t.appendChild(tt("div").add(tt("div.content").add(ae(et("Artists")))).add(tt("div.content").add(ie(void 0,...n.map((t=>function(t,e=(()=>ft.playArtist(t))){let n=0;for(let e of t.albums)for(let t of e.discs)for(let e of t.tracks)n+=e.file.duration_ms;let i=r((e=>!!o(e)&&e[e.length-4]===t.artist_id),ft.contextPath),a=r(((t,e)=>t&&e),i,ft.playback);return tt("div.media-widget").on("click",(()=>{pe(`audio/artists/${t.artist_id}/`)})).add(tt("div.media-widget__artwork").add(tt("div.playback-button").add(Wt().bind("data-hide",a.addObserver((t=>t)))).add(Xt().bind("data-hide",a.addObserver((t=>!t)))).on("click",(()=>{a.getState()?ft.pause():i.getState()?ft.resume():e()})))).add(tt("div.media-widget__metadata").add(tt("div.media-widget__titles").add(tt("div.media-widget__title").add(et(t.title)))).add(tt("div.media-widget__tags").add(Kt("Artist")).add(Kt(it(n)))))}(t,(()=>ft.playArtist(t)))))))).render())}));else if(null!==(n=/^audio[/]playlists[/]([0-9a-f]{32})[/]/.exec(e)))St(`/api/audio/playlists/${n[1]}/`,{},((t,e)=>{let n=0;for(let t of e.items)n+=t.track.file.duration_ms;$t.appendChild(tt("div").add(tt("div.content").add(re(e.title,[ut.forUser(e.user)],["Playlist",it(n)],pt.forSquare(),void 0,e.description))).add(tt("div.content").add(tt("div.playlist__content").add(...e.items.map(((t,n)=>tt("div.playlist-item").bind("data-playing",ft.contextPath.addObserver((n=>!s(n)&&n[n.length-2]===e.playlist_id&&n[n.length-1]===t.track.track_id))).add(tt("div.playlist-item__title").add(et(t.track.title))).add(tt("div.playlist-item__subtitle").add(et(t.track.artists.map((t=>t.title)).join(" · ")))).on("click",(()=>{ft.playPlaylist(e,n)}))))))).render())}));else if(null!==(n=/^audio[/]playlists[/]/.exec(e)))St("/api/audio/playlists/",{},((t,e)=>{let n=e.playlists;$t.appendChild(tt("div").add(tt("div.content").add(ae(et("Playlists")))).add(tt("div.content").add(ie(void 0,...n.map((t=>function(t,e=(()=>ft.playPlaylist(t))){let n=0;for(let e of t.items)n+=e.track.file.duration_ms;let i=r((e=>!!o(e)&&e[e.length-2]===t.playlist_id),ft.contextPath),a=r(((t,e)=>t&&e),i,ft.playback);return tt("div.media-widget").on("click",(()=>{pe(`audio/playlists/${t.playlist_id}/`)})).add(tt("div.media-widget__artwork").add(tt("div.playback-button").add(Wt().bind("data-hide",a.addObserver((t=>t)))).add(Xt().bind("data-hide",a.addObserver((t=>!t)))).on("click",(()=>{a.getState()?ft.pause():i.getState()?ft.resume():e()})))).add(tt("div.media-widget__metadata").add(tt("div.media-widget__titles").add(tt("div.media-widget__title").add(et(t.title))).add(tt("div.media-widget__subtitle").add(ut.forUser(t.user)))).add(tt("div.media-widget__tags").add(Kt("Playlist")).add(Kt(it(n)))))}(t)))))).render())}));else if(null!==(n=/^audio[/]/.exec(e)))$t.appendChild(tt("div").add(tt("div.content").add(ae(et("Audio")))).add(tt("div.content").set("style","display: grid; gap: 32px;").add(ae(ut.for("audio/artists/","Artists"))).add(ae(ut.for("audio/albums/","Albums"))).add(ae(ut.for("audio/playlists/","Playlists")))).render());else if(null!==(n=/^video[/]shows[/]([0-9a-f]{32})[/]/.exec(e)))St(`/api/video/shows/${n[1]}/?token=${Tt}`,{},((e,n)=>{const i=se(n),a=i.seasons.reduce(((t,e)=>t+e.episodes.reduce(((t,e)=>t+e.file.duration_ms),0)),0),d=function(t){let e;return t.seasons.forEach(((n,i)=>{n.episodes.forEach(((n,a)=>{var r;if(o(n.last_stream_date)){if(o(e)&&n.last_stream_date<(null!==(r=t.seasons[e.seasonIndex].episodes[e.episodeIndex].last_stream_date)&&void 0!==r?r:0))return;e={seasonIndex:i,episodeIndex:a}}}))})),o(e)?(e.episodeIndex+=1,e.episodeIndex===t.seasons[e.seasonIndex].episodes.length&&(e.episodeIndex=0,e.seasonIndex+=1,e.seasonIndex===t.seasons.length&&(e.seasonIndex=0))):t.seasons.length>0&&t.seasons[0].episodes.length>0&&(e={seasonIndex:0,episodeIndex:0}),e}(i),l=s(d)?void 0:i.seasons[d.seasonIndex].episodes[d.episodeIndex];let c=r((t=>!!o(t)&&t[t.length-3]===i.show_id),ft.contextPath),p=r(((t,e)=>t&&e),c,ft.playback);$t.appendChild(tt("div").add(tt("div.content").add(re(i.title,void 0,["Show",it(a)],pt.forPoster(s(i.artwork)?void 0:`/files/${i.artwork.file_id}/?token=${Tt}`).set("style","padding-bottom: 150%"),tt("div.playback-button").add(Wt().bind("data-hide",p.addObserver((t=>t)))).add(Xt().bind("data-hide",p.addObserver((t=>!t)))).on("click",(t=>{p.getState()?ft.pause():c.getState()?ft.resume():ft.playShow(i)}))))).add(tt("div.content").add(s(d)||s(l)?void 0:ie("Suggested episodes",function(e,n){let i=e.title,a=["Episode",""+e.year,it(e.file.duration_ms),t(e.season.number,e.number)],d=r((t=>!!o(t)&&t[t.length-1]===e.episode_id),ft.contextPath),s=r(((t,e)=>t&&e),d,ft.playback);return tt("div.media-widget").on("click",(()=>{pe(`video/episodes/${e.episode_id}/`)})).add(tt("div.media-widget__artwork").set("style","padding-bottom: 56.25%;").add(tt("div.media-widget__images").add(tt("img.media-widget__image").set("src",`/media/stills/${e.file.file_id}/?token=${Tt}`))).add(tt("div.playback-button").add(Wt().bind("data-hide",s.addObserver((t=>t)))).add(Xt().bind("data-hide",s.addObserver((t=>!t)))).on("click",(t=>{s.getState()?ft.pause():d.getState()?ft.resume():n()})))).add(tt("div.media-widget__metadata").add(tt("div.media-widget__titles").add(tt("div.media-widget__title").add(et(i))).add(tt("div.media-widget__subtitle").add(ut.forShow(e.season.show)))).add(tt("div.media-widget__tags").add(...a.map(Kt))))}(l,(()=>{ft.playShow(i,d.seasonIndex,d.episodeIndex)}))))).add(...i.seasons.map(((t,e)=>tt("div.content").add(tt("div.playlist").add(tt("div.playlist__header").add(ae(et("Season "+t.number))).add(tt("div.playlist__tags").add(...function(t){return t.episodes.reduce(((t,e)=>(o(e.year)&&(t.includes(e.year)||t.push(e.year)),t)),[]).sort()}(t).map((t=>Kt(t.toString())))))).add(tt("div.playlist__content").add(...t.episodes.map(((t,n)=>tt("div.playlist-item").bind("data-playing",ft.contextPath.addObserver((e=>!s(e)&&e[e.length-2]===t.season.season_id&&e[e.length-1]===t.episode_id))).add(tt("div.playlist-item__title").add(et(t.title))).add(tt("div.playlist-item__subtitle").add(et(t.season.show.title))).add(s(t.last_stream_date)?void 0:tt("div.playlist-item__tags").add(("Watched",tt("div.media-tag.media-tag--accent").add(et("Watched"))))).on("click",(()=>{ft.playShow(i,e,n)})))))))))).render())}));else if(null!==(n=/^video[/]shows[/]/.exec(e)))St("/api/video/shows/?token="+Tt,{},((t,e)=>{let n=e.shows.map(se);$t.appendChild(tt("div").add(tt("div.content").add(ae(et("Shows")))).add(tt("div.content").add(ie(void 0,...n.map(((t,e)=>ee(t,(()=>{ft.playShow(t)}))))))).render())}));else if(null!==(n=/^video[/]episodes[/]([0-9a-f]{32})[/](?:([0-9]+)[/])?/.exec(e))){let e=n[1],i=o(n[2])?Number.parseInt(n[2])/1e3:void 0;St(`/api/video/episodes/${e}/?token=${Tt}`,{},((e,n)=>{let a=n.episode,d=a.season,s=d.show,l=r((t=>!!o(t)&&t[t.length-1]===a.episode_id),ft.contextPath),c=r(((t,e)=>t&&e),l,ft.playback);$t.appendChild(tt("div").add(tt("div.content").add(re(a.title,[ut.forShow(s)],["Episode",""+a.year,it(a.file.duration_ms),t(d.number,a.number)],pt.forVideo(`/media/stills/${a.file.file_id}/?token=${Tt}`).set("style","padding-bottom: 56.25%;"),tt("div.playback-button").add(Wt().bind("data-hide",c.addObserver((t=>t)))).add(Xt().bind("data-hide",c.addObserver((t=>!t)))).on("click",(()=>{c.getState()?ft.pause():o(i)?(l.getState()||ft.playEpisode(a),ft.seek(i)):l.getState()?ft.resume():ft.playEpisode(a)})),a.summary))).render())}))}else if(null!==(n=/^video[/]movies[/]([0-9a-f]{32})[/](?:([0-9]+)[/])?/.exec(e))){let t=n[1],e=o(n[2])?Number.parseInt(n[2])/1e3:void 0;St(`/api/video/movies/${t}/?token=${Tt}`,{},((t,n)=>{let i=n.movie,a=n.suggestions,d=r((t=>!!o(t)&&t[t.length-1]===i.movie_id),ft.contextPath),l=r(((t,e)=>t&&e),d,ft.playback);$t.appendChild(tt("div").add(tt("div.content").add(re(i.title,i.genres.map((t=>ut.forGenre(t))),["Movie",""+i.year,it(i.file.duration_ms)],pt.forPoster(s(i.artwork)?void 0:`/files/${i.artwork.file_id}/?token=${Tt}`).set("style","padding-bottom: 150%"),tt("div.playback-button").add(Wt().bind("data-hide",l.addObserver((t=>t)))).add(Xt().bind("data-hide",l.addObserver((t=>!t)))).on("click",(()=>{l.getState()?ft.pause():o(e)?(d.getState()||ft.playMovie(i),ft.seek(e)):d.getState()?ft.resume():ft.playMovie(i)})),i.summary))).add(tt("div.content").add(ie("Actors"))).add(0===a.length?void 0:tt("div.content").add(ie("Suggested movies",...a.map((t=>ne(t)))))).render())}))}else if(null!==(n=/^video[/]movies[/]/.exec(e))){let t=0,e=new a(!1),n=new a(!1),i=new d([]);Bt((()=>new Promise(((a,r)=>{e.getState()||n.getState()||(n.updateState(!0),St(`/api/video/movies/?offset=${t}&token=${Tt}`,{},((r,d)=>{for(let t of d.movies)i.append(t);t+=d.movies.length,0===d.movies.length&&e.updateState(!0),n.updateState(!1),a()})))})))),$t.appendChild(tt("div").add(tt("div.content").add(ae(et("Movies")))).add(tt("div.content").add(tt("div.media-grid__content").repeat(i,(t=>ne(t,(()=>ft.playMovie(t))))))).render())}else if(null!==(n=/^cues[/](.*)/.exec(e))){let e=decodeURIComponent(n[1]),i=document.createElement("div"),a=document.createElement("input");a.setAttribute("type","text"),a.setAttribute("placeholder","Search query..."),a.setAttribute("value",e),i.appendChild(a);let r=document.createElement("button");r.textContent="Search",i.appendChild(r);let d=document.createElement("div");i.appendChild(d);let s=()=>{let t=a.value;""!==t&&t!==e&&pe("cues/"+encodeURIComponent(t))};a.addEventListener("keyup",(t=>{13===t.keyCode&&s()})),r.addEventListener("click",(()=>{s()})),$t.appendChild(i),St("/api/cues/",{query:e},((e,n)=>{for(;null!==d.lastChild;)d.removeChild(d.lastChild);for(let e of n.cues){let n=document.createElement("div");if(n.classList.add("group"),e.subtitle.movie_part){let t=document.createElement("h2");t.style.setProperty("font-size","24px"),t.innerText=e.subtitle.movie_part.movie.title,n.appendChild(t);let i=document.createElement("h3");i.style.setProperty("font-size","12px"),i.innerText=""+e.subtitle.movie_part.movie.year,n.appendChild(i)}else if(e.subtitle.episode){let i=e.subtitle.episode,a=document.createElement("h2");a.style.setProperty("font-size","24px"),a.innerText=i.title,n.appendChild(a);let r=document.createElement("h3");r.style.setProperty("font-size","16px"),r.innerText=[i.season.show.title,t(i.season.number,i.number)].join(" · "),n.appendChild(r)}let i=document.createElement("pre");i.style.setProperty("font-size","16px"),i.innerText=""+e.lines.join("\n"),n.appendChild(i);let a=document.createElement("p");a.style.setProperty("font-size","12px"),a.innerText=it(e.start_ms),n.appendChild(a);let r=document.createElement("button");r.textContent="Go to video",r.addEventListener("click",(()=>{let t=e.subtitle.episode,n=e.subtitle.movie_part;null!=t?pe(`video/episodes/${t.episode_id}/${e.start_ms}/`):null!=n&&pe(`video/movies/${n.movie_id}/${e.start_ms}/`)})),n.appendChild(r);let s=document.createElement("button");s.textContent="Generate meme",s.addEventListener("click",(()=>{window.open("/media/gifs/"+e.cue_id+"/")})),n.appendChild(s),d.appendChild(n)}}))}else if(null!==(n=/^video[/]channels[/]([0-9]+)[/]/.exec(e))){let t=n[1];St(`/api/video/channels/${t}/?token=${Tt}`,{},((t,e)=>{let n=document.createElement("div");n.innerText="Channel",n.style.setProperty("font-size","24px"),$t.appendChild(n);let i=document.createElement("button");i.textContent="Play",i.addEventListener("click",(()=>{})),$t.appendChild(i);for(let t of e.segments){const e=t.movie;if(null!=e){for(let t of e.movie_parts){let n=document.createElement("div");n.style.setProperty("display","flex"),n.classList.add("group");let i=document.createElement("div");i.style.setProperty("width","25%");let a=document.createElement("img");a.setAttribute("src",`/files/${e.poster_file_id||""}/?token=${Tt}`),a.style.setProperty("width","100%"),i.appendChild(a);let r=document.createElement("div");r.style.setProperty("width","100%"),n.appendChild(i),n.appendChild(r);let d=document.createElement("h3");d.style.setProperty("font-size","16px"),d.textContent=e.title;let s=document.createElement("h4");s.style.setProperty("font-size","12px"),s.textContent="";let o=document.createElement("p");o.style.setProperty("font-size","16px"),o.textContent=e.summary;let l=document.createElement("p");l.style.setProperty("font-size","16px"),l.textContent=[e.year.toString().padStart(4,"0"),it(t.duration)].join(" · ");let c=document.createElement("button");c.textContent="Play",c.addEventListener("click",(()=>{})),r.appendChild(d),r.appendChild(s),r.appendChild(o),r.appendChild(l),r.appendChild(c),$t.appendChild(n)}continue}const n=t.episode;if(null==n);else{let t=document.createElement("div");t.classList.add("group");let e=document.createElement("h3");e.style.setProperty("font-size","16px"),e.textContent=n.season.show.title;let i=document.createElement("h4");e.style.setProperty("font-size","12px"),i.textContent="s"+n.season.number.toString().padStart(2,"0")+"e"+n.number.toString().padStart(2,"0")+": "+n.title;let a=document.createElement("p");a.style.setProperty("font-size","16px"),a.textContent=n.summary;let r=document.createElement("p");r.style.setProperty("font-size","16px"),r.textContent=[it(n.duration)].join(" · ");let d=document.createElement("button");d.textContent="Play",d.addEventListener("click",(()=>{})),t.appendChild(e),t.appendChild(i),t.appendChild(a),t.appendChild(r),t.appendChild(d),$t.appendChild(t)}}}))}else if(null!==(n=/^video[/]channels[/]/.exec(e)))St("/api/video/channels/",{},((t,e)=>{for(let t of e.channels){let e=document.createElement("div");e.classList.add("group");let n=document.createElement("h2");n.textContent="Channel "+t.channel_id,n.style.setProperty("font-size","24px"),e.appendChild(n);let i=document.createElement("p");i.style.setProperty("font-size","16px"),i.textContent=t.title,e.appendChild(i);let a=document.createElement("button");a.textContent="View",a.addEventListener("click",(()=>{pe(`video/channels/${t.channel_id}/`)})),e.appendChild(a),$t.appendChild(e)}}));else if(null!==(n=/^video[/]genres[/]([0-9a-f]{32})[/]/.exec(e)))St(`/api/video/genres/${n[1]}/?token=${Tt}`,{},((t,e)=>{let n=e.genre.shows.map(se),i=e.genre.movies.map(de);$t.appendChild(tt("div").add(tt("div.content").add(re(e.genre.title,void 0,["Video Genre"],pt.forSquare()))).add(0===n.length?void 0:tt("div.content").add(ie("Shows",...n.map(((t,e)=>ee(t,(()=>{ft.playShow(t)}))))))).add(0===i.length?void 0:tt("div.content").add(ie("Movies",...i.map(((t,e)=>ne(t,(()=>{ft.playMovie(t)}))))))).render())}));else if(null!==(n=/^video[/]genres[/]/.exec(e)))St("/api/video/genres/",{},((t,e)=>{let n=e.genres.map((t=>({genre_id:t.video_genre_id,title:t.title})));$t.appendChild(tt("div").add(tt("div.content").add(ae(et("Video Genres")))).add(tt("div.content").add(ie(void 0,...n.map(te)))).render())}));else if(null!==(n=/^video[/]/.exec(e)))$t.appendChild(tt("div").add(tt("div.content").add(ae(et("Video")))).add(tt("div.content").set("style","display: grid; gap: 32px;").add(ae(ut.for("video/shows/","Shows"))).add(ae(ut.for("video/movies/","Movies"))).add(ae(ut.for("video/genres/","Genres")))).render());else if(null!==(n=/^tokens[/]/.exec(e)))St("/api/tokens/?token="+Tt,{},((t,e)=>{$t.appendChild(tt("div.content").add(tt("div.playlist").add(tt("div.playlist__header").add(ae(et("Tokens")))).add(tt("div.playlist__content").add(...e.tokens.map((t=>function(t){let e=t.expires_ms-Date.now();return tt("div.access-token").add(tt("div.access-token__title").add(et((t.selector.match(/.{1,2}/g)||[]).join(":")))).add(tt("div.access-token__subtitle").add(et(`Expires in ${it(e)}.`)))}(t)))))).render())}));else if(null!==(n=/^search[/](.*)/.exec(e))){let t=decodeURIComponent(n[1]);{let e=document.createElement("input");e.setAttribute("placeholder","Search for content..."),e.setAttribute("type","text"),e.setAttribute("value",t),e.addEventListener("keyup",(n=>{if("Enter"===n.key){let n=e.value;""!==n&&n!==t&&pe("search/"+encodeURIComponent(n))}})),$t.appendChild(e)}{let t=document.createElement("div");$t.appendChild(t),St("/api/search/"+n[1],{},((e,n)=>{for(;null!==t.lastChild;)t.removeChild(t.lastChild);if(n.movies.length>0){{let e=document.createElement("h2");e.style.setProperty("font-size","24px"),e.textContent="Movies",t.appendChild(e)}for(let e of n.movies){let n=document.createElement("div");n.setAttribute("class","group");let i=document.createElement("p");i.style.setProperty("font-size","16px"),i.textContent=e.title;let a=document.createElement("button");a.textContent="View",a.addEventListener("click",(()=>{pe(`video/movies/${e.movie_id}/`)})),n.appendChild(i),n.appendChild(a),t.appendChild(n)}}if(n.episodes.length>0){{let e=document.createElement("h2");e.style.setProperty("font-size","24px"),e.textContent="Episodes",t.appendChild(e)}for(let e of n.episodes){let n=document.createElement("div");n.setAttribute("class","group");let i=document.createElement("p");i.style.setProperty("font-size","16px"),i.textContent=e.title;let a=document.createElement("button");a.textContent="View",a.addEventListener("click",(()=>{pe(`video/episodes/${e.episode_id}/`)})),n.appendChild(i),n.appendChild(a),t.appendChild(n)}}if(n.shows.length>0){{let e=document.createElement("h2");e.style.setProperty("font-size","24px"),e.textContent="Shows",t.appendChild(e)}for(let e of n.shows){let n=document.createElement("div");n.setAttribute("class","group");let i=document.createElement("p");i.style.setProperty("font-size","16px"),i.textContent=e.title;let a=document.createElement("button");a.textContent="View",a.addEventListener("click",(()=>{pe(`video/shows/${e.show_id}/`)})),n.appendChild(i),n.appendChild(a),t.appendChild(n)}}if(n.artists.length>0){{let e=document.createElement("h2");e.style.setProperty("font-size","24px"),e.textContent="Artists",t.appendChild(e)}for(let e of n.artists){let n=document.createElement("div");n.setAttribute("class","group");let i=document.createElement("p");i.style.setProperty("font-size","16px"),i.textContent=e.title;let a=document.createElement("button");a.textContent="View",a.addEventListener("click",(()=>{pe(`audio/artists/${e.artist_id}/`)})),n.appendChild(i),n.appendChild(a),t.appendChild(n)}}if(n.albums.length>0){{let e=document.createElement("h2");e.style.setProperty("font-size","24px"),e.textContent="Albums",t.appendChild(e)}for(let e of n.albums){let n=document.createElement("div");n.setAttribute("class","group");let i=document.createElement("p");i.style.setProperty("font-size","16px"),i.textContent=e.title;let a=document.createElement("button");a.textContent="View",a.addEventListener("click",(()=>{pe(`audio/albums/${e.album_id}/`)})),n.appendChild(i),n.appendChild(a),t.appendChild(n)}}if(n.tracks.length>0){{let e=document.createElement("h2");e.style.setProperty("font-size","24px"),e.textContent="Tracks",t.appendChild(e)}for(let e of n.tracks){let n=document.createElement("div");n.setAttribute("class","group");let i=document.createElement("p");i.style.setProperty("font-size","16px"),i.textContent=e.title;let a=document.createElement("button");a.textContent="View",a.addEventListener("click",(()=>{pe(`audio/albums/${e.disc.album.album_id}/`)})),n.appendChild(i),n.appendChild(a),t.appendChild(n)}}}))}}else $t.appendChild(tt("div").add(tt("div.content").add(ae(et("Home")))).add(tt("div.content").set("style","display: grid; gap: 32px;").add(ae(ut.for("audio/","Audio"))).add(ae(ut.for("video/","Video"))).add(ae(ut.for("search/","Search"))).add(ae(ut.for("cues/","Cues")))).render())};function pe(t){(function(){return ct(this,void 0,void 0,(function*(){return null==jt?new Promise(((t,e)=>{St("/api/auth/?token="+Tt,{},((e,n)=>{jt=e>=200&&e<300,jt||(localStorage.removeItem("token"),Tt=void 0),At.updateState(Tt),t(Tt)}))})):Tt}))})().then((e=>{null==e?Ct.updateState(!0):(null===window.history.state?window.history.replaceState({uri:t},"",t):t!==window.history.state.uri&&window.history.pushState({uri:t},"",t),ce(t))}))}pe(((t=window.location.pathname,e=(()=>{let t=document.head.querySelector("base[href]");if(null!==t){let e=t.getAttribute("href");if(null!==e)return e}return"/"})())=>{let n=t.split("/"),i=e.split("/"),a=0;for(;a<n.length&&a<i.length&&n[a]===i[a];)a++;return n.slice(a).join("/")})()),window.addEventListener("popstate",(t=>{pe(t.state.uri)}))})()})();